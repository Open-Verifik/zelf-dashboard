<div class="flex min-w-0 flex-auto flex-col">
	<!-- Main -->
	<div class="flex-auto p-6 sm:p-10">
		<!-- Header -->
		<div class="mb-8">
			<h1 class="text-3xl font-bold mb-2" style="color: var(--fuse-text)">{{ "tags.title" | transloco }}</h1>
			<p style="color: var(--fuse-text-secondary)">{{ "tags.subtitle" | transloco }}</p>
		</div>

		<!-- License Not Configured Message -->
		<div class="license-warning" *ngIf="!isLoadingLicense && !isLicenseConfigured">
			<div class="warning-card">
				<mat-icon class="warning-icon">warning</mat-icon>
				<div class="warning-content">
					<h2>{{ "tags.licenseWarning.title" | transloco }}</h2>
					<p>{{ "tags.licenseWarning.message" | transloco }}</p>
				</div>
			</div>
		</div>

		<!-- Search and Filter Bar -->
		<div class="search-filter-container" *ngIf="isLicenseConfigured && !isLoadingLicense">
			<div class="search-controls">
				<!-- Storage Filter Dropdown -->
				<mat-form-field appearance="outline" class="storage-filter-field">
					<mat-label>{{ "tags.filters.storage" | transloco }}</mat-label>
					<mat-select [(ngModel)]="selectedStorage" name="storage" (selectionChange)="onStorageChange()">
						<mat-option *ngFor="let storage of availableStorage" [value]="storage">
							{{ storage }}
						</mat-option>
					</mat-select>
				</mat-form-field>

				<!-- Search Type Dropdown -->
				<mat-form-field appearance="outline" class="search-type-field">
					<mat-label>{{ "tags.filters.filterBy" | transloco }}</mat-label>
					<mat-select [(ngModel)]="searchType" name="searchType">
						<mat-option value="all">{{ "tags.filters.all" | transloco }}</mat-option>
						<mat-option value="name">{{ "tags.filters.tagName" | transloco }}</mat-option>
						<mat-option value="blockdag">{{ "tags.filters.blockdagAddress" | transloco }}</mat-option>
						<mat-option value="eth">{{ "tags.filters.ethAddress" | transloco }}</mat-option>
						<mat-option value="solana">{{ "tags.filters.solanaAddress" | transloco }}</mat-option>
						<mat-option value="bitcoin">{{ "tags.filters.bitcoinAddress" | transloco }}</mat-option>
						<mat-option value="sui">{{ "tags.filters.suiAddress" | transloco }}</mat-option>
					</mat-select>
				</mat-form-field>

				<!-- Search Input -->
				<mat-form-field appearance="outline" class="search-input-field">
					<mat-label>{{ "tags.filters.searchPlaceholder" | transloco }}</mat-label>
					<input
						matInput
						[(ngModel)]="searchQuery"
						(input)="onSearchChange()"
						[placeholder]="'tags.filters.searchInputPlaceholder' | transloco"
					/>
					<mat-icon matSuffix *ngIf="!isSearching">search</mat-icon>
					<mat-icon matSuffix *ngIf="isSearching" class="animate-spin">hourglass_empty</mat-icon>
				</mat-form-field>

				<!-- Clear Filters Button -->
				<button mat-icon-button class="clear-filters-btn" (click)="clearFilters()" [matTooltip]="'tags.filters.clearAll' | transloco">
					<mat-icon>clear</mat-icon>
				</button>
			</div>

			<!-- Active Filters Display -->
			<div class="active-filters" *ngIf="hasActiveFilters()">
				<span class="filters-label">{{ "tags.filters.activeFilters" | transloco }}</span>
				<div class="filter-chips">
					<mat-chip *ngIf="selectedStorage !== 'IPFS'" class="filter-chip" (click)="removeStorageFilter()">
						{{ selectedStorage }}
						<mat-icon matChipRemove>close</mat-icon>
					</mat-chip>
					<mat-chip *ngIf="searchType !== 'all'" class="filter-chip" (click)="removeSearchTypeFilter()">
						{{ getSearchTypeLabel() | transloco }}
						<mat-icon matChipRemove>close</mat-icon>
					</mat-chip>
					<mat-chip *ngIf="searchQuery" class="filter-chip" (click)="clearSearchQuery()">
						"{{ searchQuery }}"
						<mat-icon matChipRemove>close</mat-icon>
					</mat-chip>
				</div>
			</div>
		</div>

		<!-- Purchase Message -->
		<div class="purchase-message" *ngIf="showPurchaseMessage && purchaseData">
			<div class="purchase-card">
				<div class="purchase-header">
					<mat-icon class="purchase-icon">shopping_cart</mat-icon>
					<h2>{{ "tags.purchase.title" | transloco }}</h2>
				</div>
				<div class="purchase-content">
					<div class="tag-info">
						<span class="tag-name">{{ purchaseData.tagName }}</span>
						<span class="domain-badge">{{ selectedDomain }}</span>
					</div>
					<div class="price-info">
						<div class="price-main">
							<span class="price">${{ purchaseData.price.price }}</span>
							<span class="currency">{{ purchaseData.price.currency }}</span>
						</div>
						<div class="price-details" *ngIf="purchaseData.price.discount > 0">
							<span class="original-price">${{ purchaseData.price.priceWithoutDiscount }}</span>
							<span class="discount">{{ purchaseData.price.discount }}% {{ "tags.purchase.off" | transloco }}</span>
						</div>
						<div class="reward-info">
							<span class="reward">+${{ purchaseData.price.reward }} {{ "tags.purchase.reward" | transloco }}</span>
						</div>
					</div>
					<div class="purchase-actions">
						<button mat-raised-button color="primary" class="purchase-btn">
							<mat-icon>shopping_cart</mat-icon>
							{{ "tags.purchase.purchaseButton" | transloco }}
						</button>
						<button mat-stroked-button class="cancel-btn" (click)="clearSearchQuery()">
							<mat-icon>close</mat-icon>
							{{ "tags.purchase.cancelButton" | transloco }}
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Table Container -->
		<div class="tags-container" [ngClass]="{ 'dark-mode': isDarkMode }" *ngIf="isLicenseConfigured && !showPurchaseMessage && !isLoadingLicense">
			<div class="table-container">
				<table mat-table [dataSource]="dataSource" class="mat-mdc-table">
					<!-- Name Column -->
					<ng-container matColumnDef="name">
						<th mat-header-cell *matHeaderCellDef>{{ "tags.table.tagName" | transloco }}</th>
						<td mat-cell *matCellDef="let record">
							<div class="flex items-center">
								<span
									class="status-indicator"
									[class.active]="record.name.includes('.hold')"
									[class.expired]="!record.name.includes('.hold')"
								></span>
								<span class="tag-name">{{ record.name }}</span>
							</div>
						</td>
					</ng-container>

					<!-- Domain Column -->
					<ng-container matColumnDef="domain">
						<th mat-header-cell *matHeaderCellDef>{{ "tags.table.domain" | transloco }}</th>
						<td mat-cell *matCellDef="let record">
							<span class="domain-chip">{{ licenseDomain || record.publicData?.domain }}</span>
						</td>
					</ng-container>

					<!-- Created Date Column -->
					<ng-container matColumnDef="created_at">
						<th mat-header-cell *matHeaderCellDef>{{ "tags.table.created" | transloco }}</th>
						<td mat-cell *matCellDef="let record">
							<span class="date-text">{{ formatDate(record.created_at) }}</span>
						</td>
					</ng-container>

					<!-- Size Column -->
					<ng-container matColumnDef="size">
						<th mat-header-cell *matHeaderCellDef>{{ "tags.table.size" | transloco }}</th>
						<td mat-cell *matCellDef="let record">
							<span class="size-text">{{ formatFileSize(record.size) }}</span>
						</td>
					</ng-container>

					<!-- Actions Column -->
					<ng-container matColumnDef="actions">
						<th mat-header-cell *matHeaderCellDef>{{ "tags.table.actions" | transloco }}</th>
						<td mat-cell *matCellDef="let record">
							<div class="action-buttons">
								<!-- QR Code Button -->
								<button
									mat-icon-button
									class="action-btn qr-btn"
									[matTooltip]="'tags.actions.previewQR' | transloco"
									(click)="openQRCodeModal(record)"
								>
									<mat-icon>qr_code</mat-icon>
								</button>

								<!-- Details Button -->
								<button
									mat-icon-button
									class="action-btn details-btn"
									[matTooltip]="'tags.actions.viewDetails' | transloco"
									(click)="openDetailsModal(record)"
								>
									<mat-icon>visibility</mat-icon>
								</button>

								<!-- Edit Button -->
								<!-- <button mat-icon-button class="action-btn edit-btn" matTooltip="Edit Lease" (click)="openEditModal(record)">
									<mat-icon>edit</mat-icon>
								</button> -->

								<!-- Delete Button -->
								<!-- <button
									mat-icon-button
									class="action-btn"
									[class.delete-btn]="canDelete(record)"
									[class.disabled]="!canDelete(record)"
									[matTooltip]="canDelete(record) ? 'Delete Tag' : 'Cannot delete - not a .hold tag'"
									[disabled]="!canDelete(record)"
									(click)="deleteRecord(record)"
								>
									<mat-icon>delete</mat-icon>
								</button> -->
							</div>
						</td>
					</ng-container>

					<tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
					<tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
				</table>
			</div>

			<!-- Pagination -->
			<div class="pagination-container">
				<div class="pagination-info">
					<span class="pagination-text"
						>{{ "tags.pagination.showing" | transloco }} {{ getStartItem() }}-{{ getEndItem() }} {{ "tags.pagination.of" | transloco }}
						{{ totalItems }} {{ "tags.pagination.results" | transloco }}</span
					>
				</div>
				<div class="pagination-controls">
					<button
						mat-icon-button
						class="pagination-btn"
						[disabled]="currentPage === 1"
						(click)="goToFirstPage()"
						[matTooltip]="'tags.pagination.firstPage' | transloco"
					>
						<mat-icon>first_page</mat-icon>
					</button>
					<button
						mat-icon-button
						class="pagination-btn"
						[disabled]="currentPage === 1"
						(click)="goToPreviousPage()"
						[matTooltip]="'tags.pagination.previousPage' | transloco"
					>
						<mat-icon>chevron_left</mat-icon>
					</button>

					<div class="page-numbers">
						<button
							*ngFor="let page of visiblePages"
							mat-icon-button
							class="pagination-btn page-number"
							[class.active]="page === currentPage"
							[disabled]="page === '...'"
							(click)="goToPage(page)"
						>
							{{ page }}
						</button>
					</div>

					<button
						mat-icon-button
						class="pagination-btn"
						[disabled]="currentPage === totalPages"
						(click)="goToNextPage()"
						[matTooltip]="'tags.pagination.nextPage' | transloco"
					>
						<mat-icon>chevron_right</mat-icon>
					</button>
					<button
						mat-icon-button
						class="pagination-btn"
						[disabled]="currentPage === totalPages"
						(click)="goToLastPage()"
						[matTooltip]="'tags.pagination.lastPage' | transloco"
					>
						<mat-icon>last_page</mat-icon>
					</button>
				</div>
				<div class="pagination-size">
					<mat-form-field appearance="outline" class="page-size-selector">
						<mat-label>{{ "tags.pagination.rowsPerPage" | transloco }}</mat-label>
						<mat-select [(ngModel)]="pageSize" (selectionChange)="onPageSizeChange()">
							<mat-option *ngFor="let size of pageSizeOptions" [value]="size">
								{{ size }}
							</mat-option>
						</mat-select>
					</mat-form-field>
				</div>
			</div>
		</div>
	</div>
</div>
