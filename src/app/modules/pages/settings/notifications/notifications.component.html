<div class="flex flex-col min-h-screen bg-gray-50/50 dark:bg-gray-900 w-full">
	<!-- Main Content Container -->
	<div class="flex-auto px-4 py-8 sm:px-6 sm:py-12 md:px-8 w-full max-w-4xl mx-auto">
		<!-- Loading State -->
		@if (isLoading) {
			<div class="flex flex-col items-center justify-center h-96">
				<mat-icon class="animate-spin text-4xl text-gray-400">refresh</mat-icon>
				<span class="mt-4 text-gray-500 font-medium">Loading settings...</span>
			</div>
		} @else {
			<form [formGroup]="notificationsForm">
				<!-- Notification Channels Card -->
				<div class="bg-white dark:bg-slate-800 rounded-3xl shadow-xl overflow-hidden mb-8 border border-gray-100 dark:border-gray-700/50">
					<div class="p-8 sm:p-10">
						<div class="flex items-center gap-3 mb-6">
							<div
								class="w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400"
							>
								<mat-icon class="icon-size-5">notifications</mat-icon>
							</div>
							<div>
								<h2 class="text-xl font-bold text-gray-900 dark:text-white">Notification Channels</h2>
								<p class="text-sm text-gray-500 dark:text-gray-400">Choose how you want to receive notifications</p>
							</div>
						</div>

						<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
							@for (channel of notificationChannels; track channel.key) {
								<div
									class="relative flex items-center justify-between p-5 rounded-2xl border border-gray-100 dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-all cursor-pointer group"
									(click)="notificationsForm.get(channel.key)?.setValue(!notificationsForm.get(channel.key)?.value)"
								>
									<div class="flex items-center gap-4">
										<div
											class="w-10 h-10 rounded-xl bg-gray-100 dark:bg-gray-800 flex items-center justify-center text-gray-500 group-hover:text-gray-700 dark:group-hover:text-gray-300 transition-colors"
										>
											<mat-icon [svgIcon]="channel.icon" class="icon-size-5"></mat-icon>
										</div>
										<div>
											<div class="font-semibold text-gray-900 dark:text-gray-200">{{ channel.label }}</div>
											<div class="text-xs text-gray-500 max-w-[180px]">{{ channel.description }}</div>
										</div>
									</div>
									<mat-slide-toggle
										[color]="'primary'"
										[formControlName]="channel.key"
										(click)="$event.stopPropagation()"
									></mat-slide-toggle>
								</div>
							}
						</div>
					</div>
				</div>

				<!-- Notification Categories -->
				@for (category of notificationCategories; track category.id) {
					<div class="bg-white dark:bg-slate-800 rounded-3xl shadow-xl overflow-hidden mb-8 border border-gray-100 dark:border-gray-700/50">
						<div class="p-8 sm:p-10">
							<!-- Category Header -->
							<div class="flex flex-col sm:flex-row sm:items-center justify-between gap-6 mb-8">
								<div class="flex items-center gap-3">
									<div
										class="w-10 h-10 rounded-full flex items-center justify-center"
										[ngClass]="{
											'bg-indigo-100 text-indigo-600 dark:bg-indigo-900/30 dark:text-indigo-400': category.color === 'primary',
											'bg-orange-100 text-orange-600 dark:bg-orange-900/30 dark:text-orange-400': category.color === 'warn',
											'bg-purple-100 text-purple-600 dark:bg-purple-900/30 dark:text-purple-400': category.color === 'accent',
										}"
									>
										<mat-icon [svgIcon]="category.icon" class="icon-size-5"></mat-icon>
									</div>
									<div>
										<h3 class="text-xl font-bold text-gray-900 dark:text-white">{{ category.title }}</h3>
										<p class="text-sm text-gray-500 dark:text-gray-400">{{ category.description }}</p>
									</div>
								</div>

								<!-- Actions -->
								<div class="flex items-center gap-3">
									<button
										type="button"
										(click)="enableCategory(category.id)"
										matTooltip="Enable all"
										class="p-2 rounded-lg text-gray-400 hover:text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20 transition-all"
									>
										<mat-icon class="icon-size-5">check_circle</mat-icon>
									</button>
									<button
										type="button"
										(click)="disableCategory(category.id)"
										matTooltip="Disable all"
										class="p-2 rounded-lg text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-all"
									>
										<mat-icon class="icon-size-5">block</mat-icon>
									</button>
								</div>
							</div>

							<!-- Settings List -->
							<div class="space-y-1">
								@for (setting of category.settings; track setting.key; let last = $last) {
									<div
										class="group flex items-center justify-between py-4 px-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors cursor-pointer"
										(click)="notificationsForm.get(setting.key)?.setValue(!notificationsForm.get(setting.key)?.value)"
										[class.border-b]="!last"
										class="border-gray-100 dark:border-gray-700/50"
									>
										<div class="pr-4">
											<div class="font-medium text-gray-900 dark:text-gray-200">{{ setting.label }}</div>
											<div class="text-sm text-gray-500 dark:text-gray-400 mt-0.5">{{ setting.description }}</div>
										</div>
										<mat-slide-toggle
											[color]="'primary'"
											[formControlName]="setting.key"
											(click)="$event.stopPropagation()"
										></mat-slide-toggle>
									</div>
								}
							</div>
						</div>
					</div>
				}

				<!-- Bottom Actions -->
				<div class="sticky bottom-6 z-10 mx-auto max-w-4xl">
					<div
						class="bg-gray-900/90 dark:bg-slate-800/90 backdrop-blur-md rounded-2xl shadow-2xl p-4 flex items-center justify-between border border-white/10"
					>
						<button
							(click)="resetToDefaults()"
							[disabled]="isSaving"
							class="px-4 py-2 text-gray-300 hover:text-white text-sm font-medium transition-colors"
						>
							Reset Defaults
						</button>
						<div class="flex items-center gap-3">
							<button class="px-4 py-2 text-gray-300 hover:text-white text-sm font-medium transition-colors" [disabled]="isSaving">
								Discard
							</button>
							<button
								(click)="saveSettings()"
								[disabled]="isSaving || notificationsForm.invalid"
								class="px-6 py-2 bg-white text-gray-900 rounded-xl text-sm font-bold hover:bg-gray-100 transition-colors shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
							>
								@if (isSaving) {
									<mat-icon class="icon-size-4 animate-spin">refresh</mat-icon>
									<span>Saving...</span>
								} @else {
									<span>Save Changes</span>
								}
							</button>
						</div>
					</div>
				</div>

				<!-- Footer Info -->
				<div class="mt-8 mb-12 p-6 rounded-2xl bg-blue-50/50 dark:bg-blue-900/10 border border-blue-100 dark:border-blue-800/30 flex gap-4">
					<mat-icon class="text-blue-600 dark:text-blue-400 shrink-0">info</mat-icon>
					<div class="text-sm text-blue-900 dark:text-blue-200">
						<p class="font-semibold mb-2">About Notifications</p>
						<ul class="space-y-1 opacity-80 list-disc list-inside">
							<li>Critical security alerts and payment failures are always sent via email.</li>
							<li>Push notifications require browser permission to function.</li>
							<li>SMS notifications are available on Premium and Enterprise plans.</li>
						</ul>
					</div>
				</div>
			</form>
		}
	</div>
</div>
