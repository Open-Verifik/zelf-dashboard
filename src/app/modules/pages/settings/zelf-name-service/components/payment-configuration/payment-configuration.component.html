<div class="bg-white dark:bg-slate-800 rounded-3xl shadow-xl overflow-hidden mb-8 border border-gray-100 dark:border-gray-700/50" *transloco="let t">
	<div class="p-8 sm:p-10" [formGroup]="formGroup">
		<div class="flex items-center gap-3 mb-6">
			<div class="w-10 h-10 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center text-green-600 dark:text-green-400">
				<mat-icon class="icon-size-5">payment</mat-icon>
			</div>
			<div>
				<h2 class="text-xl font-bold text-gray-900 dark:text-white">{{ t("license.payment_settings.title") }}</h2>
				<p class="text-sm text-gray-500 dark:text-gray-400">Methods and whitelisting</p>
			</div>
		</div>

		<div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
			<div>
				<h3 class="font-semibold text-gray-900 dark:text-white mb-4">{{ t("license.payment_settings.accepted_methods") }}</h3>
				<div class="space-y-3">
					<div
						class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-900/50 rounded-xl border border-gray-200 dark:border-gray-700"
					>
						<span class="font-medium text-gray-700 dark:text-gray-300">Coinbase</span>
						<mat-slide-toggle formControlName="coinbaseEnabled" color="primary"></mat-slide-toggle>
					</div>
					<div class="flex flex-col p-4 bg-gray-50 dark:bg-gray-900/50 rounded-xl border border-gray-200 dark:border-gray-700">
						<div class="flex items-center justify-between w-full">
							<span class="font-medium text-gray-700 dark:text-gray-300">Crypto (Native)</span>
							<mat-slide-toggle formControlName="cryptoEnabled" color="primary"></mat-slide-toggle>
						</div>

						<!-- Enabled Currencies List -->
						<div *ngIf="formGroup.get('cryptoEnabled')?.value" class="mt-3 pt-3 border-t border-gray-200 dark:border-gray-700">
							<div class="text-xs font-semibold text-gray-500 mb-2 uppercase tracking-wide">
								{{ t("license.payment_settings.supported_currencies") }}
							</div>

							<!-- Active/Enabled Currencies -->
							<div class="flex flex-wrap gap-2 mb-3" *ngIf="enabledCurrencies.length > 0">
								<div
									*ngFor="let curr of enabledCurrencies"
									class="group flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-bold border shadow-sm transition-all hover:shadow-md cursor-default"
									[ngClass]="curr.colorClass"
								>
									<span>{{ curr.code }}</span>
									<button
										type="button"
										(click)="removeCurrency(curr)"
										class="opacity-60 hover:opacity-100 transition-opacity p-0.5 rounded-full hover:bg-black/10 dark:hover:bg-white/10"
										[title]="'Remove ' + curr.code"
									>
										<mat-icon class="icon-size-3">close</mat-icon>
									</button>
								</div>
							</div>

							<!-- Empty State for Enabled -->
							<div *ngIf="enabledCurrencies.length === 0" class="text-sm text-gray-500 dark:text-gray-400 py-2 mb-2 italic">
								{{ t("license.payment_settings.no_currencies") }}
							</div>

							<!-- Available to Add -->
							<div *ngIf="availableCurrencies.length > 0" class="mt-2">
								<div class="text-[10px] font-semibold text-gray-400 mb-2 uppercase tracking-wide">
									{{ t("license.payment_settings.add_currency") }}
								</div>
								<div class="flex flex-wrap gap-2">
									<button
										type="button"
										*ngFor="let curr of availableCurrencies"
										(click)="addCurrency(curr)"
										class="flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium border border-dashed border-gray-300 dark:border-gray-600 text-gray-500 dark:text-gray-400 hover:border-gray-400 dark:hover:border-gray-500 hover:text-gray-700 dark:hover:text-gray-200 bg-gray-50/50 dark:bg-gray-800/50 transition-all hover:shadow-sm"
									>
										<mat-icon class="icon-size-3 text-green-500">add</mat-icon>
										<span>{{ curr.code }}</span>
									</button>
								</div>
							</div>

							<div
								*ngIf="availableCurrencies.length === 0 && enabledCurrencies.length > 0"
								class="mt-2 text-[10px] text-green-600/70 italic text-right"
							>
								{{ t("license.payment_settings.all_currencies_enabled") }}
							</div>
						</div>
					</div>
					<div
						class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-900/50 rounded-xl border border-gray-200 dark:border-gray-700"
					>
						<span class="font-medium text-gray-700 dark:text-gray-300">Stripe</span>
						<mat-slide-toggle formControlName="stripeEnabled" color="primary"></mat-slide-toggle>
					</div>
				</div>
			</div>

			<div>
				<h3 class="font-semibold text-gray-900 dark:text-white mb-4">{{ t("license.payment_settings.whitelist") }}</h3>
				<div class="bg-gray-50 dark:bg-gray-900/50 rounded-xl border border-gray-200 dark:border-gray-700 p-4">
					<div class="space-y-3 max-h-48 overflow-y-auto mb-4 pr-2">
						<div
							*ngFor="let item of whitelistItems; let i = index"
							class="flex items-center justify-between bg-white dark:bg-gray-800 p-3 rounded-lg shadow-sm"
						>
							<div>
								<div class="font-bold text-gray-900 dark:text-white">{{ item.domain }}</div>
								<div class="text-xs text-gray-500">{{ item.discount }} {{ getWhitelistTypeLabel(item.type) }} off</div>
							</div>
							<button type="button" (click)="removeWhitelistItem(i)" class="text-red-500 hover:text-red-700 transition-colors">
								<mat-icon class="icon-size-5">delete</mat-icon>
							</button>
						</div>
						<div *ngIf="whitelistItems.length === 0" class="text-center py-6 text-gray-500 text-sm">
							{{ t("license.payment_settings.no_whitelist") }}
						</div>
					</div>

					<div class="grid grid-cols-2 gap-2 mb-2">
						<input
							type="text"
							[(ngModel)]="newWhitelistItem.domain"
							[ngModelOptions]="{ standalone: true }"
							[placeholder]="t('license.payment_settings.domain_placeholder')"
							class="w-full bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-green-500"
						/>
						<div class="flex gap-2">
							<input
								type="number"
								[(ngModel)]="newWhitelistItem.discount"
								[ngModelOptions]="{ standalone: true }"
								placeholder="Val"
								class="w-full bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-green-500"
							/>
							<select
								[(ngModel)]="newWhitelistItem.type"
								[ngModelOptions]="{ standalone: true }"
								class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg px-1 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-green-500"
							>
								<option value="percentage">%</option>
								<option value="amount">$</option>
							</select>
						</div>
					</div>
					<button
						type="button"
						(click)="addWhitelistItem()"
						class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-2 rounded-lg transition-colors flex items-center justify-center gap-2"
					>
						<mat-icon class="icon-size-4">add</mat-icon>
						{{ t("license.payment_settings.add_to_whitelist") }}
					</button>
				</div>
			</div>
		</div>
	</div>
</div>
