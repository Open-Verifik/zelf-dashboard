<div class="w-full max-w-6xl">
	<!-- Alert Messages -->
	<div
		*ngIf="showAlert"
		class="mb-6 p-4 rounded-lg"
		[ngClass]="{
			'bg-green-100 text-green-800 border border-green-200': alertType === 'success',
			'bg-red-100 text-red-800 border border-red-200': alertType === 'error',
		}"
	>
		<div class="flex items-center">
			<mat-icon
				class="mr-2"
				[ngClass]="{
					'text-green-600': alertType === 'success',
					'text-red-600': alertType === 'error',
				}"
			>
				{{ alertType === "success" ? "check_circle" : "error" }}
			</mat-icon>
			<span>{{ alertMessage }}</span>
		</div>
	</div>

	<!-- Form -->
	<form [formGroup]="securityForm">
		<!-- Security Header -->
		<div class="mb-8">
			<h1 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Security Settings</h1>
			<p class="text-gray-600 dark:text-gray-300">Manage your account security and authentication settings</p>
		</div>

		<!-- API Keys Section -->
		<div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 mb-6">
			<div class="flex items-center mb-4">
				<mat-icon class="text-blue-600 dark:text-blue-400 mr-2">vpn_key</mat-icon>
				<h2 class="text-lg font-semibold text-gray-900 dark:text-white">API Keys & Tokens</h2>
			</div>

			<div class="space-y-4">
				<!-- API Key -->
				<div class="border border-gray-200 dark:border-gray-600 rounded-lg p-4">
					<div class="flex items-center justify-between mb-2">
						<div class="flex items-center">
							<mat-icon class="text-green-600 dark:text-green-400 mr-2">key</mat-icon>
							<h3 class="font-medium text-gray-900 dark:text-white">API Key</h3>
						</div>
						<button
							type="button"
							(click)="toggleApiKeyVisibility()"
							class="inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
						>
							<mat-icon class="text-sm mr-1">{{ showApiKey ? "visibility_off" : "visibility" }}</mat-icon>
							{{ showApiKey ? "Hide" : "Show" }}
						</button>
					</div>
					<div class="mt-2">
						<div *ngIf="!apiKey && !isLoadingApiKey" class="text-sm text-gray-500 dark:text-gray-400">
							Click "Load API Key" to retrieve your API key
						</div>
						<div *ngIf="isLoadingApiKey" class="flex items-center text-sm text-gray-500 dark:text-gray-400">
							<mat-spinner diameter="16" class="mr-2"></mat-spinner>
							Loading API key...
						</div>
						<div *ngIf="apiKey && !isLoadingApiKey" class="font-mono text-sm bg-gray-100 dark:bg-gray-700 p-2 rounded border">
							{{ showApiKey ? apiKey : "••••••••••••••••••••••••••••••••" }}
						</div>
						<button
							*ngIf="!apiKey && !isLoadingApiKey"
							type="button"
							(click)="loadApiKey()"
							class="mt-2 inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
						>
							<mat-icon class="text-sm mr-1">download</mat-icon>
							Load API Key
						</button>
					</div>
					<p class="text-sm text-gray-600 dark:text-gray-300 mt-2">
						Your API key is used to authenticate requests to the Zelf API. Keep it secure and never share it publicly.
					</p>
				</div>

				<!-- JWT Token -->
				<div class="border border-gray-200 dark:border-gray-600 rounded-lg p-4">
					<div class="flex items-center justify-between mb-2">
						<div class="flex items-center">
							<mat-icon class="text-purple-600 dark:text-purple-400 mr-2">security</mat-icon>
							<h3 class="font-medium text-gray-900 dark:text-white">JWT Token</h3>
						</div>
						<button
							type="button"
							(click)="toggleJwtVisibility()"
							class="inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
						>
							<mat-icon class="text-sm mr-1">{{ showJwt ? "visibility_off" : "visibility" }}</mat-icon>
							{{ showJwt ? "Hide" : "Show" }}
						</button>
					</div>
					<div class="mt-2">
						<div *ngIf="!jwtToken" class="text-sm text-gray-500 dark:text-gray-400">No JWT token found in localStorage</div>
						<div *ngIf="jwtToken" class="font-mono text-sm bg-gray-100 dark:bg-gray-700 p-2 rounded border break-all">
							{{ showJwt ? jwtToken : "••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••" }}
						</div>
					</div>
					<p class="text-sm text-gray-600 dark:text-gray-300 mt-2">
						Your JWT token provides secure access to your account. It's automatically managed by the system.
					</p>
				</div>
			</div>
		</div>

		<!-- Password Change Section -->
		<div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 mb-6">
			<div class="flex items-center mb-4">
				<mat-icon class="text-orange-600 dark:text-orange-400 mr-2">lock</mat-icon>
				<h2 class="text-lg font-semibold text-gray-900 dark:text-white">Change Password</h2>
			</div>

			<div class="mb-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">
				<div class="flex">
					<div class="flex-shrink-0">
						<mat-icon class="text-yellow-400">info</mat-icon>
					</div>
					<div class="ml-3">
						<h3 class="text-sm font-medium text-yellow-800 dark:text-yellow-200">Password Change Policy</h3>
						<div class="mt-2 text-sm text-yellow-700 dark:text-yellow-300">
							<p>You can only change your password twice within 24 hours for security reasons.</p>
						</div>
					</div>
				</div>
			</div>

			<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
				<div>
					<mat-form-field class="fuse-mat-emphasized-affix w-full" [subscriptSizing]="'dynamic'">
						<mat-label>Current Password</mat-label>
						<mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:key'" matPrefix></mat-icon>
						<input [formControlName]="'currentPassword'" type="password" matInput />
						<mat-error *ngIf="securityForm.get('currentPassword')?.hasError('required')"> Current password is required </mat-error>
					</mat-form-field>
				</div>

				<div>
					<mat-form-field class="fuse-mat-emphasized-affix w-full" [subscriptSizing]="'dynamic'">
						<mat-label>New Password</mat-label>
						<mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:key'" matPrefix></mat-icon>
						<input [formControlName]="'newPassword'" type="password" matInput />
						<mat-error *ngIf="securityForm.get('newPassword')?.hasError('required')"> New password is required </mat-error>
						<mat-error *ngIf="securityForm.get('newPassword')?.hasError('minlength')">
							Password must be at least 8 characters long
						</mat-error>
					</mat-form-field>
				</div>
			</div>

			<div class="mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
				<div class="flex">
					<div class="flex-shrink-0">
						<mat-icon class="text-blue-400">info</mat-icon>
					</div>
					<div class="ml-3">
						<h3 class="text-sm font-medium text-blue-800 dark:text-blue-200">Password Requirements</h3>
						<div class="mt-2 text-sm text-blue-700 dark:text-blue-300">
							<p>Minimum 8 characters. Must include numbers, letters and special characters.</p>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Actions -->
		<div class="flex items-center justify-end space-x-4">
			<button mat-stroked-button type="button" (click)="cancel()" [disabled]="isLoading">Cancel</button>
			<button mat-flat-button type="button" [color]="'primary'" (click)="savePassword()" [disabled]="isLoading || securityForm.invalid">
				<mat-spinner *ngIf="isLoading" diameter="20" class="mr-2"></mat-spinner>
				{{ isLoading ? "Processing..." : "Save Changes" }}
			</button>
		</div>
	</form>
</div>
