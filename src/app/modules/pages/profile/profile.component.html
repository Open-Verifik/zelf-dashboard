<div class="flex min-w-0 flex-auto flex-col">
	<!-- Alert Messages -->
	@if (showAlert) {
		<div class="mx-6 mt-6 mb-4">
			<div
				class="flex items-center justify-between p-4 rounded-lg"
				[class]="
					alertType === 'success' ? 'bg-green-50 text-green-800 border border-green-200' : 'bg-red-50 text-red-800 border border-red-200'
				"
			>
				<div class="flex items-center">
					<mat-icon class="mr-2">{{ alertType === "success" ? "check_circle" : "error" }}</mat-icon>
					<span>{{ alertMessage }}</span>
				</div>
				<button mat-icon-button (click)="clearAlert()" class="text-gray-400 hover:text-gray-600">
					<mat-icon class="icon-size-4">close</mat-icon>
				</button>
			</div>
		</div>
	}

	<!-- Loading State -->
	<div *ngIf="loading" class="flex items-center justify-center h-64">
		<mat-icon class="animate-spin text-4xl">refresh</mat-icon>
		<span class="ml-2">{{ "profile.loading" | transloco }}</span>
	</div>

	<!-- Header -->
	<div *ngIf="!loading" class="bg-card flex flex-col shadow">
		<!-- Cover image -->
		<div>
			<img class="h-40 object-cover lg:h-80" src="images/pages/profile/cover.jpg" alt="Cover image" />
		</div>

		<!-- User info -->
		<div class="bg-card mx-auto flex w-full max-w-5xl flex-0 flex-col items-center px-8 lg:h-18 lg:flex-row">
			<!-- Avatar -->
			<div class="-mt-26 rounded-full lg:-mt-22">
				<!-- Show photo if available, otherwise show initial -->
				<div *ngIf="userPhoto" class="ring-bg-card h-32 w-32 rounded-full ring-4 overflow-hidden">
					<img class="h-full w-full object-cover" [src]="userPhoto" [alt]="displayName + ' avatar'" />
				</div>
				<div
					*ngIf="!userPhoto && user?.name"
					class="ring-bg-card h-32 w-32 rounded-full ring-4 flex items-center justify-center bg-primary text-white text-4xl font-bold"
				>
					{{ user?.name?.[0] || displayName[0] }}
				</div>
			</div>

			<!-- Details -->
			<div class="mt-4 flex flex-col items-center lg:ml-8 lg:mt-0 lg:items-start">
				<div class="text-lg font-bold leading-none">{{ displayName }}</div>
				<div class="text-secondary">{{ displayCompany }}</div>
			</div>

			<!-- Separator -->
			<div class="mx-8 hidden h-8 border-l-2 lg:flex"></div>

			<!-- Stats -->
			<div class="mt-6 flex items-center space-x-6 lg:mt-0">
				<div class="flex flex-col items-center">
					<span class="font-bold">{{ accountStatus }}</span>
					<span class="text-secondary text-sm font-medium">{{ "profile.status" | transloco }}</span>
				</div>
				<div class="flex flex-col items-center">
					<span class="font-bold">{{ subscriptionType }}</span>
					<span class="text-secondary text-sm font-medium">{{ "profile.menu.license" | transloco }}</span>
				</div>
			</div>

			<!-- Menu -->
			<div class="mb-4 mt-8 flex items-center space-x-6 lg:m-0 lg:ml-auto">
				<a class="font-medium" [routerLink]="['/profile']">{{ "profile.menu.profile" | transloco }}</a>
				<a class="text-secondary" [routerLink]="['/settings']">{{ "profile.menu.settings" | transloco }}</a>
				<!-- <a class="text-secondary" [routerLink]="['/license']">{{ "profile.menu.license" | transloco }}</a> -->
				<!-- <a class="text-secondary" [routerLink]="['/support']">{{ "profile.menu.support" | transloco }}</a> -->
			</div>
		</div>
	</div>

	<!-- Main -->
	<div *ngIf="!loading" class="mx-auto flex w-full flex-auto justify-center p-6 sm:p-8">
		<!-- Column -->
		<div class="flex flex-col w-full md:w-1/2">
			<!-- Profile Information -->
			<fuse-card class="flex w-full flex-col p-8 pb-8 sm:p-10">
				<div class="text-xl font-semibold">{{ "profile.information.title" | transloco }}</div>
				<div class="mt-8 flex flex-col space-y-6">
					<!-- Personal Information -->
					<div class="flex flex-col space-y-6">
						<!-- Edit/Save buttons -->
						<div class="flex justify-end space-x-2">
							<button *ngIf="!isEditing" mat-stroked-button (click)="toggleEditMode()">
								<mat-icon class="icon-size-5">edit</mat-icon>
								<span class="ml-2">{{ "profile.edit" | transloco }}</span>
							</button>
							<button *ngIf="isEditing" mat-stroked-button (click)="toggleEditMode()">
								<mat-icon class="icon-size-5">close</mat-icon>
								<span class="ml-2">{{ "profile.cancel" | transloco }}</span>
							</button>
							<button *ngIf="isEditing && hasChanges" mat-flat-button color="primary" (click)="saveProfile()">
								<mat-icon class="icon-size-5">save</mat-icon>
								<span class="ml-2">{{ "profile.save" | transloco }}</span>
							</button>
						</div>

						<form [formGroup]="profileForm" class="space-y-6">
							<div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
								<mat-form-field class="w-full mb-4" [subscriptSizing]="'dynamic'">
									<mat-label>{{ "profile.information.name" | transloco }}</mat-label>
									<input
										matInput
										[placeholder]="'profile.information.name_placeholder' | transloco"
										formControlName="name"
										(input)="onFormChange()"
									/>
									@if (profileForm.get("name")?.hasError("required")) {
										<mat-error>{{ "profile.information.name_required" | transloco }}</mat-error>
									}
									@if (profileForm.get("name")?.hasError("minlength")) {
										<mat-error>{{ "profile.information.name_minlength" | transloco }}</mat-error>
									}
								</mat-form-field>
								<mat-form-field class="w-full mb-4" [subscriptSizing]="'dynamic'">
									<mat-label>{{ "profile.information.company" | transloco }}</mat-label>
									<input
										matInput
										[placeholder]="'profile.information.company_placeholder' | transloco"
										formControlName="company"
										(input)="onFormChange()"
									/>
									@if (profileForm.get("company")?.hasError("required")) {
										<mat-error>{{ "profile.information.company_required" | transloco }}</mat-error>
									}
								</mat-form-field>
							</div>
							<mat-form-field class="w-full mt-6 mb-4" [subscriptSizing]="'dynamic'">
								<mat-label>{{ "profile.information.email" | transloco }}</mat-label>
								<input
									matInput
									[placeholder]="'profile.information.email_placeholder' | transloco"
									formControlName="email"
									(input)="onFormChange()"
								/>
								@if (profileForm.get("email")?.hasError("required")) {
									<mat-error>{{ "profile.information.email_required" | transloco }}</mat-error>
								}
								@if (profileForm.get("email")?.hasError("email")) {
									<mat-error>{{ "profile.information.email_invalid" | transloco }}</mat-error>
								}
							</mat-form-field>

							<!-- Phone number fields -->
							<div class="flex w-full gap-4 relative mt-6">
								<!-- Country code field -->
								<mat-form-field class="w-40 country-code-field mb-4">
									<mat-label>{{ "profile.information.country" | transloco }}</mat-label>
									<!-- Searchable country code input -->
									<input
										matInput
										formControlName="countryCode"
										[(ngModel)]="countryCodeSearchTerm"
										(input)="filterCountryCodes(); onFormChange()"
										placeholder="Search countries..."
										class="text-sm"
									/>
									<!-- Clear search button -->
									@if (countryCodeSearchTerm) {
										<button
											mat-icon-button
											matSuffix
											type="button"
											(click)="clearCountryCodeSearch()"
											class="text-gray-400 hover:text-gray-600"
										>
											<mat-icon class="icon-size-4">clear</mat-icon>
										</button>
									}
									<!-- Dropdown arrow -->
									<button
										mat-icon-button
										matSuffix
										type="button"
										(click)="toggleCountryDropdown()"
										class="text-gray-400 hover:text-gray-600"
									>
										<mat-icon class="icon-size-4">keyboard_arrow_down</mat-icon>
									</button>
									@if (profileForm.get("countryCode").hasError("required")) {
										<mat-error>{{ "profile.information.country_required" | transloco }}</mat-error>
									}
								</mat-form-field>

								<!-- Country code dropdown (shown when searching) -->
								@if (showCountryDropdown && filteredCountryCodes.length > 0) {
									<div
										class="absolute z-50 w-40 mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-lg max-h-60 overflow-y-auto"
									>
										@for (country of filteredCountryCodes; track country.code + country.country) {
											<button
												type="button"
												(click)="selectCountryCode(country)"
												class="w-full px-3 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2"
											>
												<span>{{ country.flag }}</span>
												<span class="text-sm">{{ country.code }}</span>
												<span class="text-xs text-gray-500">{{ country.country }}</span>
											</button>
										}
									</div>
								}

								<!-- Phone number field -->
								<mat-form-field class="flex-1 mb-4">
									<mat-label>{{ "profile.information.phone" | transloco }}</mat-label>
									<input
										matInput
										type="tel"
										formControlName="phone"
										[placeholder]="'profile.information.phone_placeholder' | transloco"
										(input)="onFormChange()"
									/>
									@if (profileForm.get("phone").hasError("required")) {
										<mat-error>{{ "profile.information.phone_required" | transloco }}</mat-error>
									}
									@if (profileForm.get("phone").hasError("pattern")) {
										<mat-error>{{ "profile.information.phone_invalid" | transloco }}</mat-error>
									}
								</mat-form-field>
							</div>
						</form>
					</div>

					<mat-divider></mat-divider>

					<!-- Zelf License Information -->
					<!-- <div class="flex flex-col space-y-4">
						<h3 class="text-lg font-medium">Zelf License Information</h3>
						<mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
							<mat-label>License Type</mat-label>
							<mat-select value="premium">
								<mat-option value="basic">Basic</mat-option>
								<mat-option value="premium">Premium</mat-option>
								<mat-option value="enterprise">Enterprise</mat-option>
							</mat-select>
						</mat-form-field>
						<mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
							<mat-label>License Key</mat-label>
							<input matInput placeholder="Enter your license key" value="ZELF-2024-PREM-XXXX-XXXX" readonly />
						</mat-form-field>
						<div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
							<mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
								<mat-label>Expiry Date</mat-label>
								<input matInput placeholder="License expiry date" value="2025-12-31" readonly />
							</mat-form-field>
							<mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
								<mat-label>Status</mat-label>
								<input matInput placeholder="License status" value="Active" readonly />
							</mat-form-field>
						</div>
					</div> -->

					<!-- Preferences -->
					<!-- <div class="flex flex-col space-y-4">
						<h3 class="text-lg font-medium">Preferences</h3>
						<mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
							<mat-label>Language</mat-label>
							<mat-select value="en">
								<mat-option value="en">English</mat-option>
								<mat-option value="es">Spanish</mat-option>
								<mat-option value="fr">French</mat-option>
								<mat-option value="zh">Chinese</mat-option>
								<mat-option value="ja">Japanese</mat-option>
								<mat-option value="ko">Korean</mat-option>
							</mat-select>
						</mat-form-field>
						<mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
							<mat-label>Timezone</mat-label>
							<mat-select value="utc">
								<mat-option value="utc">UTC</mat-option>
								<mat-option value="est">Eastern Time</mat-option>
								<mat-option value="pst">Pacific Time</mat-option>
								<mat-option value="cet">Central European Time</mat-option>
							</mat-select>
						</mat-form-field>
					</div> -->

					<!-- Account Information -->
					<div class="flex flex-col space-y-4">
						<h3 class="text-lg font-medium">{{ "profile.account.title" | transloco }}</h3>
						<div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
							<div class="flex flex-col">
								<span class="text-secondary text-sm font-medium">{{ "profile.account.created_at" | transloco }}</span>
								<span class="mt-1 text-lg font-semibold">{{ accountCreatedAt }}</span>
							</div>
							<!-- <div class="flex flex-col">
								<span class="text-secondary text-sm font-medium">{{ "profile.account.subscription" | transloco }}</span>
								<span class="mt-1 text-lg font-semibold">{{ subscriptionType }}</span>
							</div> -->
						</div>
					</div>
				</div>
			</fuse-card>

			<!-- License Details -->
			<fuse-card class="mt-8 flex w-full max-w-140 flex-col p-6 pb-6 sm:p-8" *ngIf="isPremium">
				<div class="text-xl font-semibold">{{ "profile.license.title" | transloco }}</div>
				<div class="mt-8 flex flex-col space-y-6">
					<div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
						<div class="flex flex-col">
							<span class="text-secondary text-sm font-medium">{{ "profile.license.type" | transloco }}</span>
							<span class="mt-1 text-lg font-semibold">{{ subscriptionType }}</span>
						</div>
						<div class="flex flex-col">
							<span class="text-secondary text-sm font-medium">{{ "profile.license.status" | transloco }}</span>
							<span class="mt-1 text-lg font-semibold text-green-500">{{ accountStatus }}</span>
						</div>
						<div class="flex flex-col">
							<span class="text-secondary text-sm font-medium">{{ "profile.license.created" | transloco }}</span>
							<span class="mt-1 text-lg font-semibold">{{ accountCreatedAt }}</span>
						</div>
						<div class="flex flex-col">
							<span class="text-secondary text-sm font-medium">{{ "profile.license.features" | transloco }}</span>
							<span class="mt-1 text-lg font-semibold">{{ "profile.license.all_features" | transloco }}</span>
						</div>
					</div>
					<div class="flex flex-col space-y-2">
						<h4 class="font-medium">{{ "profile.license.included_features" | transloco }}:</h4>
						<ul class="text-secondary space-y-1 text-sm">
							<li>• {{ "profile.license.feature_analytics" | transloco }}</li>
							<li>• {{ "profile.license.feature_processing" | transloco }}</li>
							<li>• {{ "profile.license.feature_support" | transloco }}</li>
							<li>• {{ "profile.license.feature_api" | transloco }}</li>
							<li>• {{ "profile.license.feature_integrations" | transloco }}</li>
						</ul>
					</div>
					<div class="flex space-x-3">
						<button class="flex-1" mat-stroked-button>
							<mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:arrow-path'"></mat-icon>
							<span class="ml-2">{{ "profile.license.renew" | transloco }}</span>
						</button>
						<button class="flex-1" mat-stroked-button>
							<mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:document-arrow-down'"></mat-icon>
							<span class="ml-2">{{ "profile.license.download" | transloco }}</span>
						</button>
					</div>
				</div>
			</fuse-card>
		</div>
	</div>
</div>
