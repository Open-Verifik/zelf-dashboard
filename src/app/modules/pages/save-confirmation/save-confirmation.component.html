<div class="flex flex-col min-h-screen bg-gray-50/50 dark:bg-gray-900 w-full items-center justify-center p-4">
	<div class="w-full max-w-md animate-fade-in">
		<!-- Main Card -->
		<div class="bg-white dark:bg-slate-800 rounded-3xl shadow-xl overflow-hidden border border-gray-100 dark:border-gray-700/50">
			<!-- Header -->
			<div class="p-8 pb-0 text-center">
				<div
					class="w-16 h-16 mx-auto rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400 mb-6 shadow-sm"
				>
					<mat-icon class="icon-size-8 font-material-symbols-outlined">
						{{ saveData?.securityData ? "lock" : saveData?.themeData ? "palette" : "verified_user" }}
					</mat-icon>
				</div>
				<h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
					{{ saveData?.operation?.title || ("saving_operations.confirm_changes" | transloco) }}
				</h2>
				<p class="text-sm text-gray-500 dark:text-gray-400">
					{{ saveData?.operation?.description || ("saving_operations.enter_password_proceed" | transloco) }}
				</p>
			</div>

			<div class="p-8">
				<!-- Alert Messages -->
				@if (showAlert) {
					<div class="mb-6 animate-fade-in">
						<div
							class="flex items-center gap-3 p-4 rounded-2xl border transition-all duration-300"
							[class]="
								alertType === 'success'
									? 'bg-green-50 border-green-200 text-green-800 dark:bg-green-900/20 dark:border-green-800 dark:text-green-300'
									: 'bg-red-50 border-red-200 text-red-800 dark:bg-red-900/20 dark:border-red-800 dark:text-red-300'
							"
						>
							<mat-icon class="icon-size-5 shrink-0">{{ alertType === "success" ? "check_circle" : "error" }}</mat-icon>
							<span class="text-sm font-medium">{{ alertMessage }}</span>
						</div>
					</div>
				}

				<!-- Loading State -->
				@if (isLoading) {
					<div class="flex flex-col items-center justify-center py-8 space-y-4">
						<mat-spinner diameter="40" class="text-blue-600 dark:text-blue-400"></mat-spinner>
						<div class="text-center">
							<h3 class="font-semibold text-gray-900 dark:text-white">{{ "saving_operations.processing" | transloco }}</h3>
							<p class="text-sm text-gray-500 dark:text-gray-400">{{ "saving_operations.please_wait" | transloco }}</p>
						</div>
					</div>
				}

				<!-- Success State -->
				@if (isSuccess) {
					<div class="flex flex-col items-center justify-center py-8 space-y-4">
						<div
							class="w-12 h-12 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center text-green-600 dark:text-green-400"
						>
							<mat-icon class="icon-size-6">check</mat-icon>
						</div>
						<div class="text-center">
							<h3 class="font-semibold text-gray-900 dark:text-white">{{ "saving_operations.success" | transloco }}</h3>
							<p class="text-sm text-gray-500 dark:text-gray-400">{{ "saving_operations.redirecting" | transloco }}</p>
						</div>
					</div>
				}

				<!-- Content -->
				@if (!isLoading && !isSuccess && saveData) {
					<!-- Summary Info -->
					<div class="bg-gray-50 dark:bg-gray-900/50 rounded-2xl p-4 border border-gray-200 dark:border-gray-700 mb-6">
						<!-- Domain Config -->
						@if (saveData.domainConfig) {
							<div class="space-y-2">
								<div class="flex justify-between items-center">
									<span class="text-sm text-gray-500 dark:text-gray-400">{{ "saving_operations.domain" | transloco }}</span>
									<span class="text-sm font-semibold text-gray-900 dark:text-white">{{ saveData.domainConfig.name }}</span>
								</div>
								<div class="flex justify-between items-center">
									<span class="text-sm text-gray-500 dark:text-gray-400">{{ "saving_operations.status" | transloco }}</span>
									<span
										class="text-xs font-bold uppercase px-2 py-0.5 rounded bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300"
									>
										{{ saveData.domainConfig.status }}
									</span>
								</div>
							</div>
						}

						<!-- Security Data -->
						@if (saveData.securityData) {
							<div class="space-y-2">
								<div class="flex justify-between items-center">
									<span class="text-sm text-gray-500 dark:text-gray-400">{{ "saving_operations.action" | transloco }}</span>
									<span class="text-sm font-semibold text-gray-900 dark:text-white">
										{{
											saveData.securityData.operation === "loadApiKey"
												? ("saving_operations.load_api_key_label" | transloco)
												: ("saving_operations.change_password_label" | transloco)
										}}
									</span>
								</div>
							</div>
						}

						<!-- Staff Data -->
						@if (saveData.staffData) {
							<div class="space-y-2">
								<div class="flex justify-between items-center">
									<span class="text-sm text-gray-500 dark:text-gray-400">{{ "saving_operations.action" | transloco }}</span>
									<span class="text-sm font-semibold text-gray-900 dark:text-white capitalize">
										{{
											saveData.staffData.operation === "inviteStaff"
												? ("saving_operations.invite_member" | transloco)
												: saveData.staffData.operation === "removeStaff"
													? ("saving_operations.remove_member" | transloco)
													: ("saving_operations.update_role" | transloco)
										}}
									</span>
								</div>
								<div class="flex justify-between items-center">
									<span class="text-sm text-gray-500 dark:text-gray-400">{{ "saving_operations.name" | transloco }}</span>
									<span class="text-sm font-semibold text-gray-900 dark:text-white">{{ saveData.staffData.staffName }}</span>
								</div>
								<div class="flex justify-between items-center">
									<span class="text-sm text-gray-500 dark:text-gray-400">{{ "saving_operations.email" | transloco }}</span>
									<span class="text-sm font-semibold text-gray-900 dark:text-white">{{ saveData.staffData.staffEmail }}</span>
								</div>
								@if (saveData.staffData.operation === "inviteStaff" || saveData.staffData.operation === "updateRole") {
									<div class="flex justify-between items-center">
										<span class="text-sm text-gray-500 dark:text-gray-400">{{ "saving_operations.role" | transloco }}</span>
										<span
											class="text-xs font-bold uppercase px-2 py-0.5 rounded bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300"
										>
											{{ saveData.staffData.operation === "updateRole" ? saveData.staffData.newRole : saveData.staffData.role }}
										</span>
									</div>
								}
							</div>
						}
					</div>

					<!-- Passkey Login Option -->
					@if (hasPasskey) {
						<div class="mb-6">
							<button
								type="button"
								(click)="onPasskeyLogin()"
								class="w-full flex items-center justify-center gap-3 px-4 py-3 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 rounded-xl font-semibold hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors border border-blue-200 dark:border-blue-800"
							>
								<mat-icon class="icon-size-5">fingerprint</mat-icon>
								{{ "saving_operations.continue_with_passkey" | transloco }}
							</button>
							<div class="mt-4 flex items-center gap-3">
								<div class="h-px bg-gray-200 dark:bg-gray-700 flex-1"></div>
								<span class="text-xs font-medium text-gray-400 uppercase">{{ "saving_operations.or_use_password" | transloco }}</span>
								<div class="h-px bg-gray-200 dark:bg-gray-700 flex-1"></div>
							</div>
						</div>
					}

					<!-- Password Form -->
					<form (ngSubmit)="proceedToBiometric()">
						<div class="space-y-1.5 mb-6">
							<label class="text-sm font-semibold text-gray-700 dark:text-gray-300 ml-1">{{
								"saving_operations.master_password_label" | transloco
							}}</label>
							<div
								class="flex items-center w-full bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-xl px-4 focus-within:border-blue-500 dark:focus-within:border-blue-500 focus-within:ring-4 focus-within:ring-blue-500/10 transition-all"
							>
								<mat-icon class="text-gray-400 icon-size-5 mr-2">lock</mat-icon>
								<input
									[(ngModel)]="masterPassword"
									[type]="showPassword ? 'text' : 'password'"
									name="masterPassword"
									class="flex-1 bg-transparent border-none focus:ring-0 text-gray-900 dark:text-white py-3 font-medium placeholder-gray-400"
									[placeholder]="'saving_operations.enter_master_password' | transloco"
									required
								/>
								<button
									type="button"
									(click)="togglePasswordVisibility()"
									class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors ml-2"
								>
									<mat-icon class="icon-size-5">{{ showPassword ? "visibility_off" : "visibility" }}</mat-icon>
								</button>
							</div>
							<p class="text-xs text-gray-500 dark:text-gray-400 pl-1">
								{{
									"saving_operations.password_encrypt_data"
										| transloco: { itemName: saveData?.operation?.itemName || "configuration" }
								}}
							</p>
						</div>

						<div class="grid grid-cols-2 gap-4">
							<button
								type="button"
								(click)="goBack()"
								class="px-4 py-2.5 rounded-xl border border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300 font-semibold hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors"
							>
								{{ "saving_operations.cancel" | transloco }}
							</button>
							<button
								type="submit"
								[disabled]="!masterPassword.trim()"
								class="px-4 py-2.5 rounded-xl bg-gray-900 dark:bg-white text-white dark:text-gray-900 font-bold hover:bg-gray-800 dark:hover:bg-gray-100 transition-colors shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
							>
								{{ "saving_operations.continue" | transloco }}
							</button>
						</div>
					</form>
				}
			</div>
		</div>

		<!-- Biometric Verification Modal - Full Screen (Matches Sign In Style) -->
		@if (showBiometricModal) {
			<div
				class="fixed inset-0 bg-black/60 backdrop-blur-md flex items-center justify-center z-50 p-4 transition-opacity duration-300 animate-fade-in"
			>
				<div class="bg-white dark:bg-slate-900 rounded-3xl w-full max-w-4xl max-h-[90vh] overflow-hidden shadow-2xl flex flex-col">
					<!-- Header -->
					<div class="px-6 py-5 flex items-center justify-between shrink-0 border-b border-gray-100 dark:border-gray-800">
						<div class="flex flex-col">
							<h2 class="text-xl font-bold text-gray-900 dark:text-white leading-tight tracking-tight">
								{{ "save_confirmation.biometric_verification" | transloco }}
							</h2>
							<div class="flex items-center gap-1.5 mt-1">
								<div
									class="bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-full px-2 py-0.5 text-[11px] font-semibold uppercase tracking-wide flex items-center gap-1"
								>
									<mat-icon class="icon-size-3">lock</mat-icon>
									<span>SECURE</span>
								</div>
								<span class="text-xs font-medium text-gray-500 dark:text-gray-400">
									{{ saveData?.domainConfig?.name || saveData?.operation?.itemName || "configuration" }}
								</span>
							</div>
						</div>
						<button
							mat-icon-button
							(click)="onBiometricCancel()"
							class="w-8 h-8 flex items-center justify-center bg-gray-100 hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700 rounded-full transition-colors"
						>
							<mat-icon class="icon-size-4 text-gray-500 dark:text-gray-400">close</mat-icon>
						</button>
					</div>

					<div class="p-0 pt-4 pb-8 overflow-y-auto flex-1 flex flex-col justify-center items-center">
						<!-- Biometric Component -->
						<app-data-biometrics
							[userData]="{
								domain: saveData?.domainConfig?.name || saveData?.operation?.itemName,
								masterPassword: masterPassword,
							}"
							[isModalContext]="true"
							(biometricsSuccess)="onBiometricSuccess($event)"
							(biometricsCancel)="onBiometricCancel()"
						></app-data-biometrics>
					</div>
				</div>
			</div>
		}
	</div>
</div>
