import{a as de}from"./chunk-GW3KYM23.js";import{a as fe}from"./chunk-OQPZ6FEU.js";import{a as ue}from"./chunk-DAU7RZW4.js";import{a as R,c as O,d as $}from"./chunk-HO6TKSQT.js";import{a as me}from"./chunk-WYAM3YL7.js";import{a as le,b as pe}from"./chunk-FS32XSOZ.js";import"./chunk-JX43DB6F.js";import{b as se,c as ce}from"./chunk-JJWLRRW7.js";import{d as L,i as z,j as N}from"./chunk-N6LPVSL5.js";import{c as J}from"./chunk-TTLXDFBX.js";import{c as Q,d as U}from"./chunk-DXVBJCLH.js";import{A as oe,b as K,d as W,f as X,g as Y,l as Z,o as ee,q as te,s as ie,t as ae,y as ne,z as re}from"./chunk-QH2I47VF.js";import"./chunk-EBTKBAUO.js";import{ea as q,fa as G}from"./chunk-3CSJK4TT.js";import"./chunk-E6ENPQNB.js";import{c as H}from"./chunk-BXWN2EXF.js";import"./chunk-PIQLBEWE.js";import{b as j,d as D}from"./chunk-FXKMXYKD.js";import{j as M,r as T}from"./chunk-XX57SXRU.js";import{Ab as w,Hc as d,Ib as c,Ic as u,Sb as B,Tb as E,Ub as i,Vb as r,Wb as _,_b as b,ec as x,ga as P,gb as n,gc as p,hb as h,kc as I,lc as S,mc as C,ra as f,rc as s,sa as v,sc as y,tc as g,ub as V,uc as F}from"./chunk-FFNUM7ZM.js";import{g as A}from"./chunk-TSRGIXR5.js";var ge=["acceptInviteNgForm"],he=["biometricVerification"],xe=(a,m)=>m.code;function ye(a,m){if(a&1){let e=b();i(0,"div",17)(1,"div",18)(2,"div",19)(3,"div",20)(4,"h2",21),s(5),d(6,"transloco"),r(),i(7,"div",22)(8,"div",23)(9,"mat-icon",24),s(10,"lock"),r(),i(11,"span"),s(12,"SECURE"),r()(),i(13,"span",25),s(14),r()()(),i(15,"button",26),x("click",function(){f(e);let t=p();return v(t.onBiometricCancel())}),i(16,"mat-icon",27),s(17,"close"),r()()(),i(18,"div",28)(19,"app-data-biometrics",29,0),x("biometricsSuccess",function(t){f(e);let l=p();return v(l.onBiometricSuccess(t))})("biometricsCancel",function(){f(e);let t=p();return v(t.onBiometricCancel())}),r()()()()}if(a&2){let e=p();n(5),g(" ",u(6,4,"acceptInvite.faceVerification")," "),n(9),g(" ",(e.inviteData==null?null:e.inviteData.staffEmail)||(e.inviteData==null?null:e.inviteData.staffName)||"Verifying Account"," "),n(5),c("userData",e.inviteData)("isModalContext",!0)}}function _e(a,m){if(a&1){let e=b();i(0,"app-passkey-prompt-modal",30),x("onSave",function(){f(e);let t=p();return v(t.onPasskeySave())})("onCancel",function(){f(e);let t=p();return v(t.onPasskeyCancel())}),r()}}function be(a,m){if(a&1&&(i(0,"div",31)(1,"h1",32),s(2),d(3,"transloco"),r(),i(4,"p",33),s(5),d(6,"transloco"),i(7,"span",34),s(8),r()(),i(9,"div",35),s(10),r()()),a&2){let e=p();n(2),g(" ",u(3,4,"acceptInvite.title")," "),n(3),g(" ",u(6,6,"acceptInvite.invitedToJoin")," "),n(3),y(e.inviteData.ownerCompany),n(2),g(" ",e.inviteData.role," ")}}function ke(a,m){a&1&&(i(0,"div",36),_(1,"mat-progress-spinner",37),i(2,"div",38),s(3),d(4,"transloco"),r()()),a&2&&(n(3),g(" ",u(4,1,"acceptInvite.verifyingInvitation")," "))}function we(a,m){if(a&1&&(i(0,"fuse-alert",39)(1,"div",40),s(2),r()()),a&2){let e=p();c("type",e.alert.type)("appearance","soft"),n(2),y(e.alert.message)}}function Ie(a,m){if(a&1){let e=b();i(0,"div")(1,"form",41,1)(3,"div",42)(4,"label",43),s(5),d(6,"transloco"),r(),i(7,"mat-form-field",44),_(8,"input",45),i(9,"mat-icon",46),s(10,"lock"),r()()(),i(11,"button",47),x("click",function(){f(e);let t=p();return v(t.acceptInvite())}),i(12,"span"),s(13),d(14,"transloco"),r(),i(15,"mat-icon",48),s(16,"arrow_forward"),r()()(),i(17,"div",49)(18,"div",50)(19,"mat-icon",51),s(20,"verified_user"),r(),i(21,"span"),s(22),d(23,"transloco"),r()()()()}if(a&2){let e=p();n(),c("formGroup",e.acceptInviteForm),n(4),y(u(6,6,"acceptInvite.createMasterPassword")),n(3),c("formControlName","masterPassword"),n(3),c("disabled",e.acceptInviteForm.invalid),n(2),y(u(14,8,"acceptInvite.verifyIdentity")),n(9),y(u(23,10,"acceptInvite.biometricsProtected"))}}function Se(a,m){if(a&1&&(i(0,"option",16),s(1),r()),a&2){let e=m.$implicit;c("value",e.code),n(),F("",e.flag," ",e.name,"")}}var ve=(()=>{class a{constructor(e,o,t,l,k){this._authService=e,this._formBuilder=o,this._router=t,this._route=l,this._passkeyService=k,this.alert={type:"success",message:""},this.showAlert=!1,this.showBiometricVerification=!1,this.showPasskeyPrompt=!1,this.isLoading=!0,this.inviteData=null,this.token="",this.availableLanguages=[{code:"en",name:"English",flag:"\u{1F1FA}\u{1F1F8}"},{code:"es",name:"Espa\xF1ol",flag:"\u{1F1EA}\u{1F1F8}"},{code:"fr",name:"Fran\xE7ais",flag:"\u{1F1EB}\u{1F1F7}"},{code:"zh",name:"\u4E2D\u6587",flag:"\u{1F1E8}\u{1F1F3}"},{code:"ja",name:"\u65E5\u672C\u8A9E",flag:"\u{1F1EF}\u{1F1F5}"},{code:"ko",name:"\uD55C\uAD6D\uC5B4",flag:"\u{1F1F0}\u{1F1F7}"}],this.currentLanguage="en",this._translocoService=P(R)}ngOnInit(){if(this.currentLanguage=this._translocoService.getActiveLang()||"en",this.token=this._route.snapshot.queryParamMap.get("token"),!this.token){this.isLoading=!1,this.alert={type:"error",message:"Invalid invitation link. Token is missing."},this.showAlert=!0;return}this._authService.validateInvite(this.token).then(e=>{this.inviteData=e,e.isAlreadyRegistered&&e.invitationStatus,this.isLoading=!1}).catch(e=>{this.isLoading=!1,this.alert={type:"error",message:e.message||"Invalid or expired invitation link."},this.showAlert=!0}),this.acceptInviteForm=this._formBuilder.group({masterPassword:["",W.required]})}acceptInvite(){this.acceptInviteForm.invalid||(this.showBiometricVerification=!0,this.showAlert=!1)}onBiometricSuccess(e){this.acceptInviteForm.disable();let o={invitationToken:this.token,faceBase64:e.faceBase64,masterPassword:this.acceptInviteForm.get("masterPassword")?.value};this._authService.acceptInvite(o).then(t=>{t.data?.token&&(this._authService.setSession({zelfProof:t.data.zelfProof,zelfAccount:t.data.staffAccount}),this._authService.setAccessToken(t.data.token),this.showPasskeyPrompt=!0)}).catch(t=>{console.error("Accept invite error:",t),this.acceptInviteForm.enable(),this.showBiometricVerification=!1,this.alert={type:"error",message:t.message||"Failed to accept invitation."},this.showAlert=!0,this.biometricVerification&&(t.message?.includes("face")||t.message?.includes("biometric"))&&this.biometricVerification.handleApiError(t)})}onBiometricCancel(){this.showBiometricVerification=!1}onPasskeySave(){let e=this.inviteData?.staffEmail,o=this.acceptInviteForm.get("masterPassword")?.value;e&&o?this._passkeyService.register(e).then(t=>A(this,null,function*(){if(t){let l=yield this._passkeyService.encryptPassword(o,t.key);yield this._passkeyService.savePasskeyMetadata(e,{credentialId:t.credentialId,salt:this._passkeyService.bufferToBase64(t.salt),iv:l.iv,ciphertext:l.ciphertext})}this._router.navigateByUrl("/analytics")})).catch(t=>{console.error("Passkey error",t),this._router.navigateByUrl("/analytics")}):this._router.navigateByUrl("/analytics")}onPasskeyCancel(){this._router.navigateByUrl("/analytics")}onLanguageChange(e){this.currentLanguage=e,this._translocoService.setActiveLang(e)}static{this.\u0275fac=function(o){return new(o||a)(h(J),h(ne),h(D),h(j),h(fe))}}static{this.\u0275cmp=V({type:a,selectors:[["auth-accept-invite"]],viewQuery:function(o,t){if(o&1&&(I(ge,5),I(he,5)),o&2){let l;S(l=C())&&(t.acceptInviteNgForm=l.first),S(l=C())&&(t.biometricVerification=l.first)}},decls:16,vars:7,consts:[["biometricVerification",""],["acceptInviteNgForm","ngForm"],["class","fixed inset-0 bg-black/60 backdrop-blur-md flex items-center justify-center z-50 p-4 transition-opacity duration-300",4,"ngIf"],[3,"onSave","onCancel",4,"ngIf"],[1,"absolute","inset-0","flex","flex-col","items-center","justify-center","min-h-screen","bg-[#F3F4F6]","dark:bg-[#0F1115]","p-4","text-center","overflow-auto"],[1,"w-full","max-w-[440px]","bg-white","dark:bg-[#141414]","rounded-2xl","shadow-2xl","border","border-gray-200","dark:border-gray-800","overflow-hidden","relative","z-10"],[1,"p-8","sm:p-12"],[1,"flex","justify-center","mb-8"],[1,"w-20","h-20"],["src","images/logo/logo.svg","alt","Logo",1,"w-full","h-full","object-contain"],["class","mb-8",4,"ngIf"],["class","flex flex-col items-center justify-center py-12",4,"ngIf"],["class","mb-8 text-left",3,"type","appearance",4,"ngIf"],[4,"ngIf"],[1,"fixed","bottom-6","right-6","z-20"],[1,"px-3","py-2","text-sm","font-medium","text-gray-500","bg-white/80","dark:bg-gray-800/80","backdrop-blur","border","border-gray-200","dark:border-gray-700","rounded-lg","shadow-sm","hover:bg-white","dark:hover:bg-gray-800","focus:outline-none","focus:ring-2","focus:ring-primary-500","cursor-pointer","transition-all",3,"change","value"],[3,"value"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-md","flex","items-center","justify-center","z-50","p-4","transition-opacity","duration-300"],[1,"bg-white","dark:bg-slate-900","rounded-3xl","w-full","max-w-4xl","max-h-[90vh]","overflow-hidden","shadow-2xl","transform","transition-all","scale-100","flex","flex-col"],[1,"px-6","py-5","flex","items-center","justify-between","shrink-0","border-b","border-gray-100","dark:border-gray-800"],[1,"flex","flex-col"],[1,"text-xl","font-bold","text-gray-900","dark:text-white","leading-tight","tracking-tight"],[1,"flex","items-center","gap-1.5","mt-1"],[1,"bg-primary-50","dark:bg-primary-900/30","text-primary-600","dark:text-primary-400","rounded-full","px-2","py-0.5","text-[11px]","font-semibold","uppercase","tracking-wide","flex","items-center","gap-1"],[1,"icon-size-3"],[1,"text-xs","font-medium","text-gray-500","dark:text-gray-400"],["mat-icon-button","","title","Close",1,"w-8","h-8","flex","items-center","justify-center","bg-gray-100","hover:bg-gray-200","dark:bg-gray-800","dark:hover:bg-gray-700","rounded-full","transition-colors",3,"click"],[1,"icon-size-4","text-gray-500","dark:text-gray-400"],[1,"p-0","pt-4","pb-8","overflow-y-auto","flex-1","flex","flex-col","justify-center","items-center","w-full"],[3,"biometricsSuccess","biometricsCancel","userData","isModalContext"],[3,"onSave","onCancel"],[1,"mb-8"],[1,"text-2xl","font-bold","text-gray-900","dark:text-white","tracking-tight","mb-2"],[1,"text-base","text-gray-500","dark:text-gray-400"],[1,"font-semibold","text-gray-800","dark:text-gray-200"],[1,"mt-2","text-sm","text-primary-600","dark:text-primary-400","font-medium","bg-primary-50","dark:bg-primary-900/10","py-1","px-3","rounded-full","inline-block","border","border-primary-100","dark:border-primary-800"],[1,"flex","flex-col","items-center","justify-center","py-12"],["mode","indeterminate","diameter","40",1,"mb-6"],[1,"text-base","font-medium","text-gray-500","dark:text-gray-400","animate-pulse"],[1,"mb-8","text-left",3,"type","appearance"],[1,"break-words","text-sm"],[1,"space-y-6",3,"formGroup"],[1,"text-left","group"],[1,"block","text-xs","font-bold","text-gray-500","dark:text-gray-500","uppercase","tracking-wider","mb-2","ml-1","group-focus-within:text-primary-500","transition-colors"],["subscriptSizing","dynamic",1,"w-full","fuse-mat-dense","rounded-xl"],["matInput","","type","password","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",1,"text-lg",3,"formControlName"],["matPrefix","",1,"icon-size-5","mr-2","text-gray-400"],[1,"w-full","py-4","bg-gray-900","dark:bg-white","text-white","dark:text-gray-900","font-bold","rounded-xl","shadow-lg","hover:shadow-xl","hover:-translate-y-0.5","active:translate-y-0","active:shadow-md","transition-all","duration-200","flex","items-center","justify-center","gap-2","mt-4",3,"click","disabled"],[1,"icon-size-5"],[1,"mt-8","pt-6","border-t","border-gray-100","dark:border-gray-800"],[1,"flex","items-center","justify-center","gap-2","text-xs","text-gray-400","dark:text-gray-500"],[1,"icon-size-4"]],template:function(o,t){o&1&&(w(0,ye,21,6,"div",2)(1,_e,1,0,"app-passkey-prompt-modal",3),i(2,"div",4)(3,"div",5)(4,"div",6)(5,"div",7)(6,"div",8),_(7,"img",9),r()(),w(8,be,11,8,"div",10)(9,ke,5,3,"div",11)(10,we,3,3,"fuse-alert",12)(11,Ie,24,12,"div",13),r()(),i(12,"div",14)(13,"select",15),x("change",function(k){return t.onLanguageChange(k.target.value)}),B(14,Se,2,3,"option",16,xe),r()()()),o&2&&(c("ngIf",t.showBiometricVerification&&!t.showPasskeyPrompt),n(),c("ngIf",t.showPasskeyPrompt),n(7),c("ngIf",!t.isLoading&&t.inviteData),n(),c("ngIf",t.isLoading),n(),c("ngIf",t.showAlert),n(),c("ngIf",!t.isLoading&&t.inviteData),n(2),c("value",t.currentLanguage),n(),E(t.availableLanguages))},dependencies:[T,M,me,re,Z,ie,ae,K,X,Y,oe,ee,te,N,z,L,ce,se,U,Q,G,q,pe,le,ue,$,O,de],encapsulation:2,data:{animation:H}})}}return a})();var at=[{path:"",component:ve}];export{at as default};
