import{a as nt}from"./chunk-NQGU55SU.js";import{c as et}from"./chunk-KB4NZS6A.js";import{c as it}from"./chunk-OV7RV7RJ.js";import"./chunk-HJACV4SF.js";import"./chunk-2IP4ECES.js";import{a as tt}from"./chunk-P6DBL24N.js";import"./chunk-4T6RUIZT.js";import{c as X}from"./chunk-Y6ZYUQEE.js";import{j as H}from"./chunk-XNMNNTXN.js";import{a as L}from"./chunk-GKK3ZBTB.js";import{a as f}from"./chunk-E6ENPQNB.js";import"./chunk-QDYN4COV.js";import"./chunk-4NDVBZC3.js";import{a as V,d as A}from"./chunk-XFX2TJJI.js";import{A as Q,b as j,f as q,g as W,l as O,o as Y,q as Z,y as J,z as K}from"./chunk-HHFAS2AP.js";import{aa as D,ea as R,fa as G}from"./chunk-4GCD5IXU.js";import{h as $,v as N}from"./chunk-6CPQKJQE.js";import{Ab as x,Dc as U,Ib as c,Ob as I,Oc as M,Pb as m,Sb as E,Tb as w,Ub as i,Vb as n,Wb as d,_b as y,aa as k,ec as b,ga as B,gb as r,gc as p,hb as P,ra as S,rc as a,sa as C,sc as h,ta as T,tc as _,ub as F,uc as z}from"./chunk-BTAKDWI7.js";import{g}from"./chunk-TSRGIXR5.js";var at=(()=>{class e{constructor(){this._httpClient=B(N),this._httpWrapper=B(L)}getSubscriptionPlans(){return g(this,null,function*(){try{let t=new Promise((u,v)=>setTimeout(()=>v(new Error("Request timeout after 10 seconds")),1e4)),o=this._httpWrapper.sendRequest("get",`${f.apiUrl}${f.endpoints.subscriptionPlans.list}`);return(yield Promise.race([o,t])).data||[]}catch(t){throw t}})}getSubscriptionPlan(t){return g(this,null,function*(){try{return(yield this._httpWrapper.sendRequest("get",`${f.apiUrl}${f.endpoints.subscriptionPlans.getById}/${t}`)).data}catch(o){throw o}})}subscribe(t){return g(this,null,function*(){try{let o=yield this._httpWrapper.sendRequest("post",`${f.apiUrl}${f.endpoints.subscriptionPlans.subscribe}`,t);return o.data?o.data:o}catch(o){throw o}})}getMySubscription(){return g(this,null,function*(){try{return(yield this._httpWrapper.sendRequest("get",`${f.apiUrl}${f.endpoints.subscriptionPlans.mySubscription}`)).data}catch(t){throw t}})}createStripePortalSession(){return g(this,null,function*(){try{let t=yield this._httpWrapper.sendRequest("post",`${f.apiUrl}${f.endpoints.subscriptionPlans.createPortalSession}`);return t.data||t}catch(t){throw t}})}cancelSubscription(t){return g(this,null,function*(){try{let o=yield this._httpWrapper.sendRequest("post",`${f.apiUrl}${f.endpoints.subscriptionPlans.cancelSubscription}`,{subscriptionId:t});return o.data||o}catch(o){throw o}})}upgradeSubscription(t,o){return g(this,null,function*(){try{let s=yield this._httpWrapper.sendRequest("post",`${f.apiUrl}${f.endpoints.subscriptionPlans.upgradeSubscription}`,{subscriptionId:t,newPriceId:o});return s.data||s}catch(s){throw s}})}static{this.\u0275fac=function(o){return new(o||e)}}static{this.\u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var lt=(e,l)=>l.id,st=(e,l)=>({"ring-4 ring-primary":e,"hover:ring-2 hover:ring-primary/50":l});function ct(e,l){e&1&&a(0," Your Active Plan ")}function dt(e,l){e&1&&a(0," Choose your perfect plan ")}function mt(e,l){e&1&&(i(0,"div"),a(1,"Manage your subscription and billing."),n(),i(2,"div"),a(3,"Take control of your productivity."),n())}function pt(e,l){e&1&&(i(0,"div"),a(1,"Upgrade or downgrade your current plan."),n(),i(2,"div"),a(3,"Take control of your productivity."),n())}function ut(e,l){if(e&1&&(i(0,"div",6)(1,"h2",11),a(2,"SUBSCRIPTION MANAGEMENT"),n(),i(3,"div",12),x(4,ct,1,0)(5,dt,1,0),n(),i(6,"div",13),x(7,mt,4,0)(8,pt,4,0),n()()),e&2){let t=p();r(4),m(t.hasSubscription?4:5),r(3),m(t.hasSubscription?7:8)}}function gt(e,l){e&1&&(i(0,"div",7)(1,"div",14)(2,"mat-icon",15),a(3,"refresh"),n(),i(4,"div",11),a(5,"Loading subscription details..."),n(),i(6,"div",16),a(7,"Please wait while we fetch your plan information"),n()()())}function _t(e,l){if(e&1&&(i(0,"div",8)(1,"fuse-alert",17),a(2),n()()),e&2){let t=p();r(),c("appearance","outline")("type","error"),r(),_(" ",t.error," ")}}function ft(e,l){e&1&&(i(0,"div",42),d(1,"mat-icon",43),i(2,"span",44)(3,"b"),a(4,"50"),n(),a(5," active users"),n()(),i(6,"div",42),d(7,"mat-icon",43),i(8,"span",44)(9,"b"),a(10,"50"),n(),a(11," encryptions/month"),n()()),e&2&&(r(),c("svgIcon","heroicons_solid:check"),r(6),c("svgIcon","heroicons_solid:check"))}function xt(e,l){e&1&&(i(0,"div",42),d(1,"mat-icon",43),i(2,"span",44)(3,"b"),a(4,"500"),n(),a(5," active users"),n()(),i(6,"div",42),d(7,"mat-icon",43),i(8,"span",44)(9,"b"),a(10,"Unlimited"),n(),a(11," encryptions"),n()()),e&2&&(r(),c("svgIcon","heroicons_solid:check"),r(6),c("svgIcon","heroicons_solid:check"))}function ht(e,l){e&1&&(i(0,"div",42),d(1,"mat-icon",43),i(2,"span",44)(3,"b"),a(4,"1,250"),n(),a(5," active users"),n()(),i(6,"div",42),d(7,"mat-icon",43),i(8,"span",44)(9,"b"),a(10,"Unlimited"),n(),a(11," encryptions"),n()(),i(12,"div",42),d(13,"mat-icon",43),i(14,"span",44),a(15,"Priority support"),n()(),i(16,"div",42),d(17,"mat-icon",43),i(18,"span",44),a(19,"Advanced analytics"),n()()),e&2&&(r(),c("svgIcon","heroicons_solid:check"),r(6),c("svgIcon","heroicons_solid:check"),r(6),c("svgIcon","heroicons_solid:check"),r(4),c("svgIcon","heroicons_solid:check"))}function vt(e,l){e&1&&(i(0,"div",42),d(1,"mat-icon",43),i(2,"span",44)(3,"b"),a(4,"3,000"),n(),a(5," active users"),n()(),i(6,"div",42),d(7,"mat-icon",43),i(8,"span",44)(9,"b"),a(10,"Unlimited"),n(),a(11," encryptions"),n()(),i(12,"div",42),d(13,"mat-icon",43),i(14,"span",44),a(15,"Priority support"),n()(),i(16,"div",42),d(17,"mat-icon",43),i(18,"span",44),a(19,"Advanced analytics"),n()()),e&2&&(r(),c("svgIcon","heroicons_solid:check"),r(6),c("svgIcon","heroicons_solid:check"),r(6),c("svgIcon","heroicons_solid:check"),r(4),c("svgIcon","heroicons_solid:check"))}function St(e,l){e&1&&(i(0,"div",42),d(1,"mat-icon",43),i(2,"span",44)(3,"b"),a(4,"10,000"),n(),a(5," active users"),n()(),i(6,"div",42),d(7,"mat-icon",43),i(8,"span",44)(9,"b"),a(10,"Unlimited"),n(),a(11," encryptions"),n()(),i(12,"div",42),d(13,"mat-icon",43),i(14,"span",44)(15,"b"),a(16,"Dedicated"),n(),a(17," infrastructure"),n()(),i(18,"div",42),d(19,"mat-icon",43),i(20,"span",44),a(21,"24/7 support"),n()(),i(22,"div",42),d(23,"mat-icon",43),i(24,"span",44),a(25,"Advanced analytics"),n()()),e&2&&(r(),c("svgIcon","heroicons_solid:check"),r(6),c("svgIcon","heroicons_solid:check"),r(6),c("svgIcon","heroicons_solid:check"),r(6),c("svgIcon","heroicons_solid:check"),r(4),c("svgIcon","heroicons_solid:check"))}function Ct(e,l){if(e&1&&(i(0,"div",52)(1,"div",23),a(2),n(),i(3,"div",54),a(4),n()()),e&2){let t=p().$implicit,o=p(3);r(2),_(" ",o.formatPrice(o.getCheapestPrice(t).unit_amount,o.getCheapestPrice(t).currency)," "),r(2),_(" ",o.getCheapestPrice(t).recurring.interval," billing ")}}function bt(e,l){if(e&1){let t=y();i(0,"fuse-card",48),b("click",function(){let s=S(t).$implicit,u=p(3);return C(u.showUpgradeComparison(s))}),i(1,"div",49)(2,"div",14)(3,"h4",50),a(4),n(),i(5,"p",51),a(6),n(),x(7,Ct,5,2,"div",52),i(8,"div",52)(9,"button",53),b("click",function(){let s=S(t).$implicit,u=p(3);return C(u.upgradeToPlan(s))}),a(10),n()()()()()}if(e&2){let t=l.$implicit,o=p(3);r(4),h(o.getPlanDisplayName(t.metadata.zelfPlan)),r(2),h(t.description),r(),m(o.getCheapestPrice(t)?7:-1),r(2),c("color","primary"),r(),_(" Upgrade to ",o.getPlanDisplayName(t.metadata.zelfPlan)," ")}}function yt(e,l){if(e&1&&(i(0,"div",8)(1,"h3",45),a(2,"Available Upgrades"),n(),i(3,"div",46),E(4,bt,11,5,"fuse-card",47,I().trackByFn,!0),n()()),e&2){let t=p(2);r(4),w(t.getUpgradePlans())}}function Pt(e,l){if(e&1&&(i(0,"div",57)(1,"div",58)(2,"div",59),a(3),n(),i(4,"div",60),a(5),n(),i(6,"div",60),a(7),n()(),i(8,"div",25)(9,"div",61),a(10),n(),i(11,"span",62),a(12),n()()()),e&2){let t=l.$implicit,o=p(4);r(3),h(t.description),r(2),_("Invoice ID: ",t.id,""),r(2),_(" ",o.formatDate(t.date)," "),r(3),_(" ",o.formatPrice(t.amount,t.currency)," "),r(),c("ngClass",o.getStatusBadgeColor(t.status)),r(),_(" ",t.status.toUpperCase()," ")}}function Et(e,l){if(e&1&&(i(0,"div",55),E(1,Pt,13,6,"div",57,lt),n()),e&2){let t=p(3);r(),w(t.billingHistory)}}function wt(e,l){e&1&&(i(0,"div",56)(1,"mat-icon",63),a(2,"receipt_long"),n(),i(3,"p"),a(4,"No billing history available"),n()())}function Bt(e,l){if(e&1&&(i(0,"div",8)(1,"h3",45),a(2,"Billing History"),n(),i(3,"fuse-card")(4,"div",49),x(5,Et,3,0,"div",55)(6,wt,5,0,"div",56),n()()()),e&2){let t=p(2);r(5),m(t.billingHistory.length>0?5:6)}}function It(e,l){if(e&1){let t=y();i(0,"div",7)(1,"div",18)(2,"fuse-card",19)(3,"div",20)(4,"div",21)(5,"div")(6,"div",22)(7,"h3",23),a(8),n(),i(9,"span",24),a(10),n()(),i(11,"p",16),a(12),n()(),i(13,"div",25)(14,"div",26),a(15),n(),i(16,"div",27),a(17),n()()()(),i(18,"div",28)(19,"div",29)(20,"h4",30),a(21,"Plan Features"),n(),i(22,"div",31),x(23,ft,12,2)(24,xt,12,2)(25,ht,20,4)(26,vt,20,4)(27,St,26,5),n()(),i(28,"div",8)(29,"div",32)(30,"button",33),b("click",function(){S(t);let s=p();return C(s.openStripePortal())}),i(31,"mat-icon",34),a(32,"payment"),n(),a(33," Manage Billing "),n()()()()(),i(34,"fuse-card",35)(35,"div",28)(36,"h4",36),a(37,"Billing Information"),n(),i(38,"div",37)(39,"div",38)(40,"div",39),a(41,"Subscription ID"),n(),i(42,"div",40),a(43),n()(),i(44,"div",38)(45,"div",39),a(46,"Current Period"),n(),i(47,"div",41),a(48),n()(),i(49,"div",38)(50,"div",39),a(51,"Next Billing"),n(),i(52,"div",41),a(53),n()()()()(),x(54,yt,6,0,"div",8)(55,Bt,7,1,"div",8),n()()}if(e&2){let t=p();r(8),h(t.getCurrentPlan().name),r(),c("ngClass",t.getStatusBadgeColor(t.getCurrentSubscription().status)),r(),_(" ",t.getCurrentSubscription().status.toUpperCase()," "),r(2),h(t.getCurrentPlan().description),r(3),_(" ",t.formatPrice(t.getCurrentSubscription().plan.amount,t.getCurrentSubscription().plan.currency)," "),r(2),_("",t.getCurrentSubscription().plan.interval," billing"),r(6),m(t.getCurrentPlan().metadata.zelfPlan==="zelfBasic"?23:t.getCurrentPlan().metadata.zelfPlan==="zelfStartUp"?24:t.getCurrentPlan().metadata.zelfPlan==="zelfBusiness"?25:t.getCurrentPlan().metadata.zelfPlan==="zelfGold"?26:t.getCurrentPlan().metadata.zelfPlan==="zelfEnterprise"?27:-1),r(7),c("color","accent"),r(13),h(t.getCurrentSubscription().id),r(5),z(" ",t.formatDate(t.getCurrentSubscription().current_period_start)," - ",t.formatDate(t.getCurrentSubscription().current_period_end)," "),r(5),h(t.formatDate(t.getCurrentSubscription().current_period_end)),r(),m(t.showPlanComparison&&t.getUpgradePlans().length>0?54:-1),r(),m(t.billingHistory&&t.billingHistory.length>0?55:-1)}}function kt(e,l){if(e&1&&(i(0,"div",79)(1,"div",80),a(2),n(),i(3,"div",81),a(4),n()(),i(5,"div",82)(6,"div"),a(7),n()()),e&2){let t=p().$implicit,o=p(2);r(2),h(o.getCheapestPrice(t).currency.toUpperCase()),r(2),_(" ",o.formatPrice(o.getCheapestPrice(t).unit_amount,o.getCheapestPrice(t).currency)," "),r(3),_("",o.getCheapestPrice(t).recurring.interval," billing")}}function Tt(e,l){e&1&&(i(0,"div",74),a(1,"Contact"),n())}function Ft(e,l){e&1&&a(0," Core features, including: ")}function zt(e,l){e&1&&a(0," Personal features, plus: ")}function Ut(e,l){e&1&&a(0," Premium features, plus: ")}function Mt(e,l){e&1&&(i(0,"b"),a(1,"50"),n(),a(2," active users "))}function $t(e,l){e&1&&(i(0,"b"),a(1,"500"),n(),a(2," active users "))}function Nt(e,l){e&1&&(i(0,"b"),a(1,"1,250"),n(),a(2," active users "))}function Dt(e,l){e&1&&(i(0,"b"),a(1,"3,000"),n(),a(2," active users "))}function Ht(e,l){e&1&&(i(0,"b"),a(1,"10,000"),n(),a(2," active users "))}function Vt(e,l){e&1&&(i(0,"b"),a(1,"Unlimited"),n(),a(2," active users "))}function At(e,l){e&1&&(i(0,"b"),a(1,"50"),n(),a(2," encryptions/month "))}function Rt(e,l){e&1&&(i(0,"b"),a(1,"Unlimited"),n(),a(2," encryptions "))}function Gt(e,l){e&1&&(i(0,"div",77),d(1,"mat-icon",43),i(2,"div",78),a(3,"Priority support"),n()()),e&2&&(r(),c("svgIcon","heroicons_solid:check"))}function Lt(e,l){e&1&&(i(0,"div",77),d(1,"mat-icon",43),i(2,"div",78)(3,"b"),a(4,"Dedicated"),n(),a(5," infrastructure"),n()()),e&2&&(r(),c("svgIcon","heroicons_solid:check"))}function jt(e,l){e&1&&(i(0,"div",77),d(1,"mat-icon",43),i(2,"div",78),a(3,"Advanced analytics"),n()()),e&2&&(r(),c("svgIcon","heroicons_solid:check"))}function qt(e,l){e&1&&(i(0,"div",77),d(1,"mat-icon",43),i(2,"div",78),a(3,"24/7 support"),n()()),e&2&&(r(),c("svgIcon","heroicons_solid:check"))}function Wt(e,l){if(e&1){let t=y();i(0,"fuse-card",69),b("click",function(){let s=S(t).$implicit,u=p(2);return C(u.selectPlan(s.id))}),i(1,"div",70)(2,"div",71),a(3),n(),i(4,"div",72),a(5),n(),d(6,"div",73),x(7,kt,8,3)(8,Tt,2,0,"div",74),i(9,"div",75)(10,"div",59),x(11,Ft,1,0)(12,zt,1,0)(13,Ut,1,0),n(),i(14,"div",76)(15,"div",77),d(16,"mat-icon",43),i(17,"div",78),x(18,Mt,3,0)(19,$t,3,0)(20,Nt,3,0)(21,Dt,3,0)(22,Ht,3,0)(23,Vt,3,0),n()(),i(24,"div",77),d(25,"mat-icon",43),i(26,"div",78),x(27,At,3,0)(28,Rt,3,0),n()(),x(29,Gt,4,1,"div",77)(30,Lt,6,1,"div",77)(31,jt,4,1,"div",77)(32,qt,4,1,"div",77),n()()()()}if(e&2){let t=l.$implicit,o=p(2);c("ngClass",U(13,st,o.isPlanSelected(t.id),!o.isPlanSelected(t.id))),r(3),_(" ",o.getPlanDisplayName(t.metadata.zelfPlan)," "),r(2),_(" ",t.description||t.name," "),r(2),m(o.getCheapestPrice(t)?7:8),r(4),m(t.metadata.zelfPlan==="zelfBasic"?11:t.metadata.zelfPlan==="zelfGold"?12:13),r(5),c("svgIcon","heroicons_solid:check"),r(2),m(t.metadata.zelfPlan==="zelfBasic"?18:t.metadata.zelfPlan==="zelfStartUp"?19:t.metadata.zelfPlan==="zelfBusiness"?20:t.metadata.zelfPlan==="zelfGold"?21:t.metadata.zelfPlan==="zelfEnterprise"?22:23),r(7),c("svgIcon","heroicons_solid:check"),r(2),m(t.metadata.zelfPlan==="zelfBasic"?27:28),r(2),m(t.metadata.zelfPlan!=="zelfBasic"&&t.metadata.zelfPlan!=="zelfStartUp"?29:-1),r(),m(t.metadata.zelfPlan==="zelfEnterprise"?30:-1),r(),m(t.metadata.zelfPlan==="zelfGold"||t.metadata.zelfPlan==="zelfBusiness"||t.metadata.zelfPlan==="zelfEnterprise"?31:-1),r(),m(t.metadata.zelfPlan==="zelfEnterprise"?32:-1)}}function Ot(e,l){e&1&&(i(0,"mat-icon",83),a(1,"refresh"),n(),a(2," Creating Checkout Session... "))}function Yt(e,l){e&1&&a(0," Subscribe ")}function Zt(e,l){if(e&1){let t=y();i(0,"div",7)(1,"div",64)(2,"div",65),E(3,Wt,33,16,"fuse-card",66,I().trackByFn,!0),n()()(),i(5,"div",67)(6,"button",68),b("click",function(){S(t);let s=p();return C(s.onSubscribe())}),x(7,Ot,3,0)(8,Yt,1,0),n()()}if(e&2){let t,o=p();r(3),w(o.plans),r(3),c("color","primary")("disabled",!((t=o.planBillingForm.get("plan"))!=null&&t.value)||o.subscribing),r(),m(o.subscribing?7:8)}}function Jt(e,l){e&1&&(i(0,"div",9),a(1,"No subscription plans available."),n())}function Kt(e,l){if(e&1&&(i(0,"form",10),d(1,"input",84),n()),e&2){let t=p();c("formGroup",t.planBillingForm),r(),c("formControlName","plan")}}var he=(()=>{class e{constructor(t,o,s){this._formBuilder=t,this._subscriptionPlansService=o,this._cdr=s,this.plans=[],this.loading=!1,this.subscribing=!1,this.error=null,this.hasSubscription=!1,this.mySubscription=null,this.showPlanComparison=!1,this.selectedUpgradePlan=null,this.showBillingHistory=!1,this.billingHistory=[],this.initialLoading=!0}ngOnInit(){return g(this,null,function*(){this.checkSubscriptionStatus(),this.planBillingForm=this._formBuilder.group({plan:[""],cardHolder:["Brian Hughes"],cardNumber:[""],cardExpiration:[""],cardCVC:[""],country:["usa"],zip:[""]});try{yield this.loadMyPlan(),yield this.loadSubscriptionPlans()}finally{this.initialLoading=!1,this._cdr.detectChanges()}})}loadMyPlan(){return g(this,null,function*(){try{this.mySubscription=yield this._subscriptionPlansService.getMySubscription(),this.hasSubscription=this.mySubscription&&this.mySubscription.subscription&&this.mySubscription.subscription.status==="active",this._cdr.detectChanges()}catch(t){console.error("Failed to load subscription:",t),this.hasSubscription=!1}})}loadSubscriptionPlans(){return g(this,null,function*(){this.loading=!0,this.error=null;try{let t=yield this._subscriptionPlansService.getSubscriptionPlans();this.plans=t,t.length>0&&this.planBillingForm.patchValue({plan:t[0].id}),this._cdr.detectChanges()}catch(t){this.error=`Failed to load subscription plans: ${t.message||"Unknown error"}`}finally{this.loading=!1,this._cdr.detectChanges()}})}checkSubscriptionStatus(){try{let t=localStorage.getItem("subscription");this.hasSubscription=t!==null&&t!=="null"&&t!==""}catch{this.hasSubscription=!1}}trackByFn(t,o){return o.id||t}formatPrice(t,o){return new Intl.NumberFormat("en-US",{style:"currency",currency:o.toUpperCase()}).format(t/100)}getCheapestPrice(t){if(!t.prices||t.prices.length===0)return null;let o=t.prices.filter(s=>s.active&&s.unit_amount>0).sort((s,u)=>s.unit_amount-u.unit_amount);return o.length>0?o[0]:null}getPlanDisplayName(t){return{zelfBasic:"BASIC",ZelfGold:"GOLD",zelfBusiness:"BUSINESS",zelfStartUp:"STARTUP",zelfEnterprise:"ENTERPRISE"}[t]||t.toUpperCase()}selectPlan(t){this.planBillingForm.patchValue({plan:t}),this._cdr.detectChanges()}isPlanSelected(t){return this.planBillingForm.get("plan")?.value===t}onSubscribe(){return g(this,null,function*(){let t=this.planBillingForm.get("plan")?.value;if(!t)return;let o=this.plans.find(u=>u.id===t);if(!o)return;let s=this.getCheapestPrice(o);if(s){this.subscribing=!0,this.error=null,this._cdr.detectChanges();try{let u={productId:o.id,priceId:s.id,customerEmail:null},v=yield this._subscriptionPlansService.subscribe(u);if(v&&v.success&&v.url){window.location.href=v.url;return}throw new Error("Failed to create checkout session")}catch(u){this.error=`Failed to create checkout session: ${u.message||"Unknown error"}`}finally{this.subscribing=!1,this._cdr.detectChanges()}}})}getCurrentPlan(){return!this.mySubscription||!this.mySubscription.product?null:this.mySubscription.product}getCurrentSubscription(){return!this.mySubscription||!this.mySubscription.subscription?null:this.mySubscription.subscription}formatDate(t){return new Date(t*1e3).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}getStatusColor(t){switch(t){case"active":return"text-green-600";case"canceled":return"text-red-600";case"past_due":return"text-yellow-600";case"unpaid":return"text-red-600";default:return"text-gray-600"}}getStatusBadgeColor(t){switch(t){case"active":return"bg-green-100 text-green-800";case"canceled":return"bg-red-100 text-red-800";case"past_due":return"bg-yellow-100 text-yellow-800";case"unpaid":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}showUpgradeComparison(t){this.selectedUpgradePlan=t,this.showPlanComparison=!0,this._cdr.detectChanges()}hidePlanComparison(){this.showPlanComparison=!1,this.selectedUpgradePlan=null,this._cdr.detectChanges()}getUpgradePlans(){if(!this.mySubscription||!this.mySubscription.subscription)return this.plans;let t=this.mySubscription.subscription.plan.amount;return this.plans.filter(o=>{let s=this.getCheapestPrice(o);return s&&s.unit_amount>t})}openStripePortal(){return g(this,null,function*(){try{let t=yield this._subscriptionPlansService.createStripePortalSession();if(t&&t.success&&t.url){window.location.href=t.url;return}throw new Error("Failed to create portal session")}catch(t){this.error=`Failed to open billing portal: ${t.message||"Unknown error"}`,this._cdr.detectChanges()}})}cancelSubscription(){return g(this,null,function*(){if(confirm("Are you sure you want to cancel your subscription? This action cannot be undone."))try{let t=this.getCurrentSubscription();if(!t)throw new Error("No active subscription found");let o=yield this._subscriptionPlansService.cancelSubscription(t.id);if(o&&o.success)yield this.loadMyPlan(),alert("Subscription cancelled successfully.");else throw new Error(o?.message||"Failed to cancel subscription")}catch(t){this.error=`Failed to cancel subscription: ${t.message||"Unknown error"}`,this._cdr.detectChanges()}})}upgradeToPlan(t){return g(this,null,function*(){try{let o=this.getCurrentSubscription();if(!o)throw new Error("No active subscription found");let s=this.getCheapestPrice(t);if(!s)throw new Error("No valid price found for this plan");let u=yield this._subscriptionPlansService.upgradeSubscription(o.id,s.id);if(u&&u.success&&u.url){window.location.href=u.url;return}throw new Error("Failed to create upgrade session")}catch(o){this.error=`Failed to upgrade plan: ${o.message||"Unknown error"}`,this._cdr.detectChanges()}})}toggleBillingHistory(){this.showBillingHistory=!this.showBillingHistory,this.showBillingHistory&&this.billingHistory.length===0&&this.loadBillingHistory(),this._cdr.detectChanges()}loadBillingHistory(){return g(this,null,function*(){try{this.billingHistory=[{id:"in_1SIBhPFO6i3ofqGHMzmmHGNA",amount:99900,currency:"usd",status:"paid",date:1760461667,description:"Zelf Business - Monthly subscription"}],this._cdr.detectChanges()}catch(t){console.error("Failed to load billing history:",t)}})}getPlanUsage(){if(!this.mySubscription||!this.mySubscription.domainConfig)return null;let t=this.mySubscription.domainConfig;return{activeUsers:this.getActiveUserLimit(),encryptions:this.getEncryptionLimit(),storage:t.storage||{},features:t.features||[]}}getActiveUserLimit(){let t=this.getCurrentPlan();if(!t)return 0;switch(t.metadata.zelfPlan){case"zelfBasic":return 50;case"zelfStartUp":return 500;case"zelfBusiness":return 1250;case"zelfGold":return 3e3;case"zelfEnterprise":return 1e4;default:return 0}}getEncryptionLimit(){let t=this.getCurrentPlan();return t?t.metadata.zelfPlan==="zelfBasic"?50:"Unlimited":0}static{this.\u0275fac=function(o){return new(o||e)(P(J),P(at),P(M))}}static{this.\u0275cmp=F({type:e,selectors:[["settings-plan-billing"]],decls:13,vars:7,consts:[[1,"relative","flex","min-w-0","flex-auto","flex-col","overflow-hidden"],[1,"relative","overflow-hidden","px-2","pb-6","pt-4","sm:px-8","sm:pb-12","sm:pt-10"],["viewBox","0 0 960 540","width","100%","height","100%","preserveAspectRatio","xMidYMax slice","xmlns","http://www.w3.org/2000/svg",1,"-z-1","absolute","inset-0"],["fill","none","stroke","currentColor","stroke-width","100",1,"opacity-40","text-gray-200","dark:text-gray-800"],["r","234","cx","196","cy","23"],["r","234","cx","790","cy","491"],[1,"flex","flex-col","items-center"],[1,"mt-10","flex","justify-center","sm:mt-20"],[1,"mt-8"],[1,"mt-8","text-center","text-secondary"],[1,"hidden",3,"formGroup"],[1,"text-xl","font-semibold"],[1,"mt-1","text-center","text-4xl","font-extrabold","leading-tight","tracking-tight","sm:text-7xl"],[1,"text-secondary","mt-3","text-center","tracking-tight","sm:text-2xl"],[1,"text-center"],[1,"animate-spin","text-6xl","text-primary","mb-4"],[1,"text-secondary","mt-2"],[3,"appearance","type"],[1,"w-full","max-w-4xl"],[1,"relative","overflow-hidden"],[1,"bg-gradient-to-r","from-primary/10","to-accent/10","p-8"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"text-3xl","font-bold"],[1,"px-3","py-1","rounded-full","text-sm","font-medium",3,"ngClass"],[1,"text-right"],[1,"text-4xl","font-bold"],[1,"text-secondary"],[1,"p-8"],[1,"mb-8"],[1,"text-lg","font-semibold","mb-4"],[1,"space-y-3"],[1,"flex","flex-col","sm:flex-row","gap-3","mb-4"],["mat-flat-button","",1,"flex-1","px-6","py-3","text-base","font-medium",3,"click","color"],[1,"mr-2"],[1,"mt-6"],[1,"text-lg","font-semibold","mb-6"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"bg-gray-50","p-4","rounded-lg"],[1,"text-sm","text-secondary","mb-2"],[1,"font-mono","text-sm","break-all"],[1,"text-sm"],[1,"flex","items-center"],[1,"text-green-600","icon-size-5",3,"svgIcon"],[1,"ml-2"],[1,"text-2xl","font-bold","text-center","mb-6"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6"],[1,"relative","overflow-hidden","transition-all","duration-300","hover:shadow-lg","cursor-pointer","border-2","border-primary/20","hover:border-primary/50"],[1,"relative","overflow-hidden","transition-all","duration-300","hover:shadow-lg","cursor-pointer","border-2","border-primary/20","hover:border-primary/50",3,"click"],[1,"p-6"],[1,"text-xl","font-bold"],[1,"text-secondary","text-sm","mt-2"],[1,"mt-4"],["mat-flat-button","",1,"w-full",3,"click","color"],[1,"text-secondary","text-sm"],[1,"space-y-4"],[1,"text-center","text-secondary","py-8"],[1,"flex","items-center","justify-between","p-4","border","rounded-lg"],[1,"flex-1"],[1,"font-semibold"],[1,"text-sm","text-secondary"],[1,"font-bold","text-lg"],[1,"px-2","py-1","rounded-full","text-xs","font-medium",3,"ngClass"],[1,"text-6xl","mb-4"],[1,"w-full","max-w-sm","md:max-w-5xl"],[1,"grid","grid-cols-1","gap-8","md:grid-cols-2"],[1,"relative","flex","flex-col","overflow-hidden","transition-all","duration-300","hover:shadow-xl","cursor-pointer",3,"ngClass"],[1,"mt-8","flex","items-center","justify-center"],["mat-flat-button","","type","button",1,"px-12","py-3","text-lg","font-semibold","bg-primary","text-white",3,"click","color","disabled"],[1,"relative","flex","flex-col","overflow-hidden","transition-all","duration-300","hover:shadow-xl","cursor-pointer",3,"click","ngClass"],[1,"flex","flex-col","h-full","p-10"],[1,"text-4xl","font-bold","leading-tight","tracking-tight","text-center"],[1,"text-secondary","mt-4","text-center","text-base","leading-relaxed"],[1,"my-6","h-1","w-12","rounded","bg-accent","mx-auto"],[1,"text-6xl","font-semibold","leading-tight","tracking-tight","text-center"],[1,"mt-8","flex","flex-col"],[1,"mt-4","space-y-2"],[1,"flex"],[1,"ml-2","leading-5"],[1,"flex","items-baseline","whitespace-nowrap","justify-center"],[1,"mr-2","text-2xl"],[1,"text-6xl","font-semibold","leading-tight","tracking-tight"],[1,"text-secondary","mt-2","text-center"],[1,"animate-spin","mr-2"],["type","hidden",3,"formControlName"]],template:function(o,s){o&1&&(i(0,"div",0)(1,"div",1),T(),i(2,"svg",2)(3,"g",3),d(4,"circle",4)(5,"circle",5),n()(),x(6,ut,9,2,"div",6)(7,gt,8,0,"div",7)(8,_t,3,3,"div",8)(9,It,56,14,"div",7)(10,Zt,9,3)(11,Jt,2,0,"div",9)(12,Kt,2,2,"form",10),n()()),o&2&&(r(6),m(s.initialLoading?-1:6),r(),m(s.initialLoading?7:-1),r(),m(s.error?8:-1),r(),m(!s.initialLoading&&!s.error&&s.hasSubscription&&s.getCurrentPlan()?9:-1),r(),m(!s.initialLoading&&!s.error&&!s.hasSubscription&&s.plans.length>0?10:-1),r(),m(!s.initialLoading&&!s.error&&s.plans.length===0?11:-1),r(),m(!s.initialLoading&&!s.error&&s.plans.length>0?12:-1))},dependencies:[K,O,j,q,W,Q,Y,Z,tt,nt,et,$,G,R,H,X,it,D,A,V],encapsulation:2,changeDetection:0})}}return e})();export{he as SettingsPlanBillingComponent};
