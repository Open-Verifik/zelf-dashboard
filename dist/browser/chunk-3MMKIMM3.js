import{a as k}from"./chunk-EJQEG2NC.js";import{a as n}from"./chunk-E6ENPQNB.js";import{z as p}from"./chunk-RXE653LG.js";import{Y as g,aa as l,ga as c,h as d,l as i,m as f,q as m}from"./chunk-UOZRKCH4.js";var a=class{static isTokenExpired(r,e){if(!r||r==="")return!0;let t=this._getTokenExpirationDate(r);return e=e||0,t===null?!0:!(t.valueOf()>new Date().valueOf()+e*1e3)}static _b64decode(r){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t="";if(r=String(r).replace(/=+$/,""),r.length%4===1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let u=0,h,s,T=0;s=r.charAt(T++);~s&&(h=u%4?h*64+s:s,u++%4)?t+=String.fromCharCode(255&h>>(-2*u&6)):0)s=e.indexOf(s);return t}static _b64DecodeUnicode(r){return decodeURIComponent(Array.prototype.map.call(this._b64decode(r),e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))}static _urlBase64Decode(r){let e=r.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:{e+="==";break}case 3:{e+="=";break}default:throw Error("Illegal base64url string!")}return this._b64DecodeUnicode(e)}static decodeToken(r){if(!r)return null;let e=r.split(".");if(e.length!==3)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");let t=this._urlBase64Decode(e[1]);if(!t)throw new Error("Cannot decode the token.");return JSON.parse(t)}static _getTokenExpirationDate(r){let e=this.decodeToken(r);if(!e.hasOwnProperty("exp"))return null;let t=new Date(0);return t.setUTCSeconds(e.exp),t}};var S=(()=>{class o{constructor(){this._httpClient=c(p),this._user=new d(1)}set user(e){this._user.next(e)}get user$(){return this._user.asObservable()}get(){return this._httpClient.get("api/common/user").pipe(g(e=>{this._user.next(e)}))}update(e){return this._httpClient.patch("api/common/user",{user:e}).pipe(m(t=>{this._user.next(t)}))}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=l({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var D=(()=>{class o{constructor(){this._authenticated=!1,this._httpClient=c(p),this._userService=c(S),this._httpWrapper=c(k)}set accessToken(e){localStorage.setItem("accessToken",e)}get accessToken(){return localStorage.getItem("accessToken")??""}get isStaff(){let e=this.accessToken;if(!e)return!1;try{return a.decodeToken(e)?.accountType==="staff"}catch{return!1}}get ownerEmail(){let e=this.accessToken;if(!e)return"";try{let t=a.decodeToken(e);return t?.ownerEmail||t?.email||""}catch{return""}}get role(){let e=this.accessToken;if(!e)return"read";try{let t=a.decodeToken(e);return t?.accountType!=="staff"?"admin":t?.role||"read"}catch{return"read"}}get accountType(){let e=this.accessToken;if(!e)return"";try{return a.decodeToken(e)?.accountType||""}catch{return""}}get zelfProof(){return localStorage.getItem("zelfProof")??""}get zelfAccount(){let e=localStorage.getItem("zelfAccount");return e?JSON.parse(e):null}get wallet(){let e=localStorage.getItem("wallet");return e?JSON.parse(e):null}signIn(e){return this._authenticated?(f(()=>new Error("User is already logged in.")),Promise.resolve(!1)):this._httpWrapper.sendRequest("post",`${n.apiUrl}${n.endpoints.auth.signIn}`,e)}signOut(){return localStorage.removeItem("accessToken"),localStorage.removeItem("zelfProof"),localStorage.removeItem("zelfAccount"),localStorage.removeItem("license"),localStorage.removeItem("wallet"),localStorage.removeItem("sessionToken"),localStorage.removeItem("subscription"),localStorage.removeItem("domainNotificationSettings"),localStorage.removeItem("signedDataPrice"),this._authenticated=!1,i(!0)}signUp(e){return this._httpWrapper.sendRequest("post",`${n.apiUrl}${n.endpoints.auth.signUp}`,e)}validateInvite(e){return this._httpWrapper.sendRequest("get",`${n.apiUrl}/api/staff/validate-invite?token=${e}`)}acceptInvite(e){return this._httpWrapper.sendRequest("post",`${n.apiUrl}/api/staff/accept-invite`,e)}unlockSession(e){return this._httpClient.post(`${n.apiUrl}${n.endpoints.auth.unlockSession}`,e)}hasValidSession(){return!!(this.accessToken&&this.zelfProof&&this.zelfAccount)}check(){return this._authenticated?i(!0):this.hasValidSession()?a.isTokenExpired(this.accessToken)?i(!1):(this._authenticated=!0,i(!0)):i(!1)}setSession(e){localStorage.setItem("zelfProof",e.zelfProof),localStorage.setItem("zelfAccount",JSON.stringify(e.zelfAccount))}setAccessToken(e){localStorage.setItem("accessToken",e)}verifyClientExists(e){return this._httpClient.get(`${n.apiUrl}${n.endpoints.auth.verifyClientExists}`,{params:e})}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=l({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{a,S as b,D as c};
