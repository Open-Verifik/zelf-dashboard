import{a as ue}from"./chunk-MAKJP36O.js";import{a as ge}from"./chunk-ED3SGAEZ.js";import{a as me}from"./chunk-EQ7VHPH6.js";import{a as fe}from"./chunk-PW4YL34D.js";import{a as he}from"./chunk-Z7QGVRXE.js";import{a as pe}from"./chunk-EUY2YDGT.js";import{a as de}from"./chunk-HRO7TOJP.js";import{a as Y,c as G,d as H}from"./chunk-WSIB2RPJ.js";import{a as le,b as ce}from"./chunk-CO7OKFRW.js";import{c as se}from"./chunk-IKJPJXAX.js";import{j as $}from"./chunk-LBFYWZ5R.js";import{c as X}from"./chunk-3MMKIMM3.js";import{c as q,d as W}from"./chunk-KS2LTHLY.js";import{b as Z,f as ee,g as te,h as ae,k as ie,l as ne,w as oe,z as re}from"./chunk-3KGOJ26K.js";import{a as Q}from"./chunk-EJQEG2NC.js";import{ca as K,da as J}from"./chunk-A67USOKJ.js";import{a as w}from"./chunk-E6ENPQNB.js";import"./chunk-PQGDOZGZ.js";import"./chunk-BP572ZWP.js";import{b as R,d as F}from"./chunk-KC6B5M5P.js";import{s as U}from"./chunk-RXE653LG.js";import{Ab as P,Bc as L,Cc as j,Gc as l,Hc as c,Ib as k,Ic as V,Mb as T,Pb as g,Ub as n,Vb as o,W as O,Wb as D,_b as M,ec as S,f as B,gb as i,gc as p,hb as _,ra as y,rc as s,sa as C,sc as d,tc as u,ub as I,uc as E,wc as z,xc as N,yc as A}from"./chunk-UOZRKCH4.js";import{a as x,b,g as m}from"./chunk-TSRGIXR5.js";var Ce=r=>({itemName:r}),we=(r,f)=>({domain:r,masterPassword:f});function Pe(r,f){if(r&1&&(n(0,"div",9)(1,"div",12)(2,"mat-icon",13),s(3),o(),n(4,"span",14),s(5),o()()()),r&2){let e=p();i(),T(e.alertType==="success"?"bg-green-50 border-green-200 text-green-800 dark:bg-green-900/20 dark:border-green-800 dark:text-green-300":"bg-red-50 border-red-200 text-red-800 dark:bg-red-900/20 dark:border-red-800 dark:text-red-300"),i(2),d(e.alertType==="success"?"check_circle":"error"),i(2),d(e.alertMessage)}}function Se(r,f){r&1&&(n(0,"div",10),D(1,"mat-spinner",15),n(2,"div",16)(3,"h3",17),s(4),l(5,"transloco"),o(),n(6,"p",7),s(7),l(8,"transloco"),o()()()),r&2&&(i(4),d(c(5,2,"saving_operations.processing")),i(3),d(c(8,4,"saving_operations.please_wait")))}function ke(r,f){r&1&&(n(0,"div",10)(1,"div",18)(2,"mat-icon",19),s(3,"check"),o()(),n(4,"div",16)(5,"h3",17),s(6),l(7,"transloco"),o(),n(8,"p",7),s(9),l(10,"transloco"),o()()()),r&2&&(i(6),d(c(7,2,"saving_operations.success")),i(3),d(c(10,4,"saving_operations.redirecting")))}function De(r,f){if(r&1&&(n(0,"div",33)(1,"div",35)(2,"span",36),s(3),l(4,"transloco"),o(),n(5,"span",37),s(6),o()(),n(7,"div",35)(8,"span",36),s(9),l(10,"transloco"),o(),n(11,"span",38),s(12),o()()()),r&2){let e=p(3);i(3),d(c(4,4,"saving_operations.domain")),i(3),d(e.saveData.domainConfig.name),i(3),d(c(10,6,"saving_operations.status")),i(3),u(" ",e.saveData.domainConfig.status," ")}}function Me(r,f){if(r&1&&(n(0,"div",33)(1,"div",35)(2,"span",36),s(3),l(4,"transloco"),o(),n(5,"span",37),s(6),l(7,"transloco"),l(8,"transloco"),o()()()),r&2){let e=p(3);i(3),d(c(4,2,"saving_operations.action")),i(3),u(" ",e.saveData.securityData.operation==="loadApiKey"?c(7,4,"saving_operations.load_api_key_label"):c(8,6,"saving_operations.change_password_label")," ")}}function Oe(r,f){if(r&1&&(n(0,"div",40)(1,"span",36),s(2),l(3,"transloco"),o(),n(4,"span",41),s(5),o()()),r&2){let e=p(4);i(2),d(c(3,2,"saving_operations.role")),i(3),u(" ",e.saveData.staffData.operation==="updateRole"?e.saveData.staffData.newRole:e.saveData.staffData.role," ")}}function Ee(r,f){if(r&1&&(n(0,"div",33)(1,"div",35)(2,"span",36),s(3),l(4,"transloco"),o(),n(5,"span",39),s(6),l(7,"transloco"),l(8,"transloco"),l(9,"transloco"),o()(),n(10,"div",40)(11,"span",36),s(12),l(13,"transloco"),o(),n(14,"span",37),s(15),o()(),n(16,"div",35)(17,"span",36),s(18),l(19,"transloco"),o(),n(20,"span",37),s(21),o()(),P(22,Oe,6,4,"div",40),o()),r&2){let e=p(3);i(3),d(c(4,7,"saving_operations.action")),i(3),u(" ",e.saveData.staffData.operation==="inviteStaff"?c(7,9,"saving_operations.invite_member"):e.saveData.staffData.operation==="removeStaff"?c(8,11,"saving_operations.remove_member"):c(9,13,"saving_operations.update_role")," "),i(6),d(c(13,15,"saving_operations.name")),i(3),d(e.saveData.staffData.staffName),i(3),d(c(19,17,"saving_operations.email")),i(3),d(e.saveData.staffData.staffEmail),i(),g(e.saveData.staffData.operation==="inviteStaff"||e.saveData.staffData.operation==="updateRole"?22:-1)}}function Be(r,f){if(r&1&&(n(0,"div",40)(1,"span",36),s(2),l(3,"transloco"),o(),n(4,"span",42),s(5),o()()),r&2){let e=p(4);i(2),d(c(3,2,"saving_operations.company")),i(3),d(e.saveData.profileData.company)}}function Ie(r,f){r&1&&(n(0,"div",35)(1,"span",43),s(2),l(3,"transloco"),o(),n(4,"span",44),s(5),l(6,"transloco"),o()()),r&2&&(i(2),d(c(3,2,"profile.photo")),i(3),u(" ",c(6,4,"saving_operations.updated")," "))}function Te(r,f){if(r&1&&(n(0,"div",33)(1,"div",35)(2,"span",36),s(3),l(4,"transloco"),o(),n(5,"span",37),s(6),o()(),n(7,"div",35)(8,"span",36),s(9),l(10,"transloco"),o(),n(11,"span",37),s(12),o()(),n(13,"div",35)(14,"span",36),s(15),l(16,"transloco"),o(),n(17,"span",37),s(18),o()(),P(19,Be,6,4,"div",40)(20,Ie,7,6,"div",35),o()),r&2){let e=p(3);i(3),d(c(4,9,"saving_operations.name")),i(3),d(e.saveData.profileData.name||e.saveData.profileData.staffName),i(3),d(c(10,11,"saving_operations.email")),i(3),d(e.saveData.profileData.email||e.saveData.profileData.staffEmail),i(3),d(c(16,13,"saving_operations.phone")),i(3),E(" ",e.saveData.profileData.countryCode||e.saveData.profileData.staffCountryCode," ",e.saveData.profileData.phone||e.saveData.profileData.staffPhone," "),i(),g(e.saveData.profileData.company?19:-1),i(),g(e.saveData.profileData.staffPhoto?20:-1)}}function ze(r,f){if(r&1&&(n(0,"div",34)(1,"div",35)(2,"span",43),s(3),l(4,"transloco"),o(),n(5,"span",42),s(6),o()(),n(7,"div",35)(8,"span",43),s(9),l(10,"transloco"),o(),n(11,"span",41),s(12),l(13,"transloco"),l(14,"transloco"),o()()()),r&2){let e=p(3);i(3),d(c(4,5,"saving_operations.tag")),i(3),E("",e.saveData.tagExtensionData.tagName,".",e.saveData.tagExtensionData.domain,""),i(3),d(c(10,7,"saving_operations.duration")),i(3),u(" ",e.saveData.tagExtensionData.duration==="lifetime"?c(13,9,"saving_operations.lifetime"):e.saveData.tagExtensionData.duration+" "+c(14,11,"saving_operations.years")," ")}}function Ne(r,f){if(r&1&&(n(0,"div",20),P(1,De,13,8,"div",33)(2,Me,9,8,"div",33)(3,Ee,23,19,"div",33)(4,Te,21,15,"div",33)(5,ze,15,13,"div",34),o()),r&2){let e=p(2);i(),g(e.saveData.domainConfig?1:-1),i(),g(e.saveData.securityData?2:-1),i(),g(e.saveData.staffData?3:-1),i(),g(e.saveData.profileData?4:-1),i(),g(e.saveData.tagExtensionData?5:-1)}}function Ae(r,f){if(r&1){let e=M();n(0,"div",9)(1,"button",45),S("click",function(){y(e);let a=p(2);return C(a.onPasskeyLogin())}),n(2,"mat-icon",28),s(3,"fingerprint"),o(),s(4),l(5,"transloco"),o(),n(6,"div",46),D(7,"div",47),n(8,"span",48),s(9),l(10,"transloco"),o(),D(11,"div",47),o()()}r&2&&(i(4),u(" ",c(5,2,"saving_operations.continue_with_passkey")," "),i(5),d(c(10,4,"saving_operations.or_use_password")))}function Le(r,f){if(r&1){let e=M();P(0,Ne,6,5,"div",20)(1,Ae,12,6,"div",9),n(2,"form",21),S("ngSubmit",function(){y(e);let a=p();return C(a.proceedToBiometric())}),n(3,"div",22)(4,"label",23),s(5),l(6,"transloco"),o(),n(7,"div",24)(8,"mat-icon",25),s(9,"lock"),o(),n(10,"input",26),l(11,"transloco"),A("ngModelChange",function(a){y(e);let h=p();return N(h.masterPassword,a)||(h.masterPassword=a),C(a)}),o(),n(12,"button",27),S("click",function(){y(e);let a=p();return C(a.togglePasswordVisibility())}),n(13,"mat-icon",28),s(14),o()()(),n(15,"p",29),s(16),l(17,"transloco"),o()(),n(18,"div",30)(19,"button",31),S("click",function(){y(e);let a=p();return C(a.goBack())}),s(20),l(21,"transloco"),o(),n(22,"button",32),s(23),l(24,"transloco"),o()()()}if(r&2){let e=p();g(e.saveData.domainConfig||e.saveData.securityData||e.saveData.staffData||e.saveData.profileData||e.saveData.tagExtensionData?0:-1),i(),g(e.hasPasskey?1:-1),i(4),d(c(6,11,"saving_operations.master_password_label")),i(5),z("ngModel",e.masterPassword),k("type",e.showPassword?"text":"password")("placeholder",c(11,13,"saving_operations.enter_master_password")),i(4),d(e.showPassword?"visibility_off":"visibility"),i(2),u(" ",V(17,15,"saving_operations.password_encrypt_data",L(22,Ce,(e.saveData==null||e.saveData.operation==null?null:e.saveData.operation.itemName)||"configuration"))," "),i(4),u(" ",c(21,18,"saving_operations.cancel")," "),i(2),k("disabled",!e.masterPassword.trim()),i(),u(" ",c(24,20,"saving_operations.continue")," ")}}function je(r,f){if(r&1){let e=M();n(0,"div",11)(1,"div",49)(2,"div",50)(3,"div",51)(4,"h2",52),s(5),l(6,"transloco"),o(),n(7,"div",53)(8,"div",54)(9,"mat-icon",55),s(10,"lock"),o(),n(11,"span"),s(12,"SECURE"),o()(),n(13,"span",56),s(14),o()()(),n(15,"button",57),S("click",function(){y(e);let a=p();return C(a.onBiometricCancel())}),n(16,"mat-icon",58),s(17,"close"),o()()(),n(18,"div",59)(19,"app-data-biometrics",60),S("biometricsSuccess",function(a){y(e);let h=p();return C(h.onBiometricSuccess(a))})("biometricsCancel",function(){y(e);let a=p();return C(a.onBiometricCancel())}),o()()()()}if(r&2){let e=p();i(5),u(" ",c(6,4,"save_confirmation.biometric_verification")," "),i(9),u(" ",(e.saveData==null||e.saveData.domainConfig==null?null:e.saveData.domainConfig.name)||(e.saveData==null||e.saveData.operation==null?null:e.saveData.operation.itemName)||"configuration"," "),i(5),k("userData",j(6,we,(e.saveData==null||e.saveData.domainConfig==null?null:e.saveData.domainConfig.name)||(e.saveData==null||e.saveData.operation==null?null:e.saveData.operation.itemName),e.masterPassword))("isModalContext",!0)}}var pt=(()=>{class r{constructor(e,t,a,h,v,ve,_e,xe,be,ye){this.saveConfirmationService=e,this.httpWrapper=t,this.authService=a,this.router=h,this.route=v,this.translocoService=ve,this.passkeyService=_e,this.staffService=xe,this.clientService=be,this.tagsService=ye,this.destroy$=new B,this.masterPassword="",this.showPassword=!1,this.hasPasskey=!1,this.showBiometricModal=!1,this.isLoading=!1,this.isSuccess=!1,this.showAlert=!1,this.alertMessage="",this.alertType="success",this.saveData=null,this.redirectUrl="/settings/license"}ngOnInit(){this.route.queryParams.pipe(O(this.destroy$)).subscribe(t=>{t.redirect&&(this.redirectUrl=t.redirect)}),this.saveConfirmationService.saveData$.pipe(O(this.destroy$)).subscribe(t=>{if(t){this.saveData=t,t.redirectUrl&&(this.redirectUrl=t.redirectUrl);return}this.router.navigate([this.redirectUrl])});let e=this.authService.zelfAccount?.publicData?.accountEmail||this.authService.zelfAccount?.publicData?.staffEmail;e&&this.passkeyService.getPasskeyMetadata(e).then(t=>{t&&(this.hasPasskey=!0)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}togglePasswordVisibility(){this.showPassword=!this.showPassword}onPasskeyLogin(){return m(this,null,function*(){this.isLoading=!0;try{let e=this.authService.zelfAccount?.publicData?.accountEmail||this.authService.zelfAccount?.publicData?.staffEmail;if(!e)throw new Error("No user email found");let t=yield this.passkeyService.getPasskeyMetadata(e);if(!t)throw new Error("No passkey metadata found");let a=yield this.passkeyService.authenticate(t.credentialId,this.passkeyService.base64ToBuffer(t.salt));if(a){let h=yield this.passkeyService.decryptPassword(t.ciphertext,t.iv,a);if(h){this.masterPassword=h,this.isLoading=!1,this.proceedToBiometric();return}}throw new Error("Passkey authentication failed")}catch(e){console.error("Passkey login error:",e),this.showError("Passkey login failed. Please use your master password."),this.isLoading=!1}})}proceedToBiometric(){if(!this.masterPassword.trim()){this.showError("Please enter your master password");return}if(!this.saveData){this.showError("No save data available");return}this.showBiometricModal=!0}onBiometricSuccess(e){if(this.showBiometricModal=!1,this.isLoading||(this.isLoading=!0),!this.saveData){this.showError("No save data available"),this.isLoading=!1;return}this.saveData.securityData?this.handleSecurityOperation(e):this.saveData.themeData?this.handleThemeOperation(e):this.saveData.domainConfig&&!this.saveData.domain?this.handleLicenseOperation(e):this.saveData.domainConfig?this.handleDomainConfigOperation(e):this.saveData.profileData?this.handleProfileOperation(e):this.saveData.staffData?this.handleStaffOperation(e):this.saveData.tagExtensionData?this.handleTagExtensionOperation(e):(this.showError("Invalid operation data"),this.isLoading=!1)}onBiometricCancel(){this.showBiometricModal=!1}goBack(){this.saveConfirmationService.clearSaveData(),this.router.navigate([this.redirectUrl])}handleSecurityOperation(e){return m(this,null,function*(){if(!this.saveData?.securityData){this.showError("No security data available"),this.isLoading=!1;return}try{let t=b(x({},this.saveData.securityData),{faceBase64:e.faceBase64,masterPassword:e.password||this.masterPassword});t.operation==="loadApiKey"?yield this.loadApiKey(t):t.operation==="changePassword"?yield this.changePassword(t):(this.showError("Unknown security operation"),this.isLoading=!1)}catch{let a=this.saveData?.securityData?.operation==="loadApiKey"?"load API key":"change password";this.showError(`Failed to ${a}. Please try again.`)}finally{this.isLoading=!1}})}handleThemeOperation(e){return m(this,null,function*(){if(!this.saveData?.themeData){this.showError("No theme data available"),this.isLoading=!1;return}try{let t=b(x({},this.saveData.themeData),{faceBase64:e.faceBase64,masterPassword:e.password||this.masterPassword});t.operation==="updateThemeSettings"?yield this.updateThemeSettings(t):(this.showError("Unknown theme operation"),this.isLoading=!1)}catch{this.showError("Failed to update theme settings. Please try again.")}finally{this.isLoading=!1}})}handleLicenseOperation(e){return m(this,null,function*(){if(!this.saveData?.domainConfig){this.showError("No license data available"),this.isLoading=!1;return}try{let t={domain:this.saveData.domainConfig.name,domainConfig:this.saveData.domainConfig,faceBase64:e.faceBase64,masterPassword:e.password||this.masterPassword};yield this.createLicense(t)}catch{this.showError("Failed to save license. Please try again.")}finally{this.isLoading=!1}})}handleDomainConfigOperation(e){return m(this,null,function*(){if(!this.saveData?.domainConfig){this.showError("No domain config data available"),this.isLoading=!1;return}try{let t={domain:this.saveData.domain,domainConfig:this.saveData.domainConfig,faceBase64:e.faceBase64,masterPassword:e.password||this.masterPassword};yield this.createLicense(t)}catch{this.showError("Failed to update license configuration. Please try again.")}finally{this.isLoading=!1}})}handleProfileOperation(e){return m(this,null,function*(){if(!this.saveData?.profileData){this.showError("No profile data available"),this.isLoading=!1;return}try{let t=b(x({},this.saveData.profileData),{faceBase64:e.faceBase64,masterPassword:e.password||this.masterPassword});yield this.updateProfile(t)}catch(t){let a="Failed to update profile. Please try again.";t?.message&&(t.message.includes("error_decrypting_zelf_account")?a="Biometric verification failed. Please check your face image and master password.":t.message.includes("zelf_account_not_found")||t.message.includes("404")?a="Account not found. Please contact support.":t.message.includes("409")?a="Verification failed. Please try again.":a=t.message),this.showError(a)}finally{this.isLoading=!1}})}handleStaffOperation(e){return m(this,null,function*(){if(!this.saveData?.staffData){this.showError("No staff data available"),this.isLoading=!1;return}try{let t=b(x({},this.saveData.staffData),{faceBase64:e.faceBase64,masterPassword:e.password||this.masterPassword});switch(t.operation){case"inviteStaff":yield this.inviteStaff(t);break;case"removeStaff":yield this.removeStaff(t);break;case"updateRole":yield this.updateStaffRole(t);break;default:throw new Error("Unknown staff operation")}}catch(t){let a="Failed to complete staff operation. Please try again.";t?.message&&(t.message.includes("FACE IS NOT CENTRAL")?a="Face is not central. Please use an image with a central face.":t.message.includes("error_decrypting_zelf_account")?a="Biometric verification failed. Please check your face image and master password.":t.message.includes("staff_already_exists")?a="This staff member already exists.":t.message.includes("staff_not_found")?a="Staff member not found.":t.message.includes("verification_failed")?a="Verification failed. Please try again.":a=t.message),this.showError(a)}finally{this.isLoading=!1}})}loadApiKey(e){return m(this,null,function*(){try{let a=this.authService.zelfAccount?.publicData?.accountEmail,h=b(x({},e),{email:a,identificationMethod:"email"}),v=yield this.httpWrapper.sendRequest("post",`${w.apiUrl}${w.endpoints.security.loadApiKey}`,h);if(v&&v.data&&v.data.apiKey)sessionStorage.setItem("apiKey",v.data.apiKey),v.data.token&&localStorage.setItem("accessToken",v.data.token),v.data.zelfAccount&&localStorage.setItem("zelfAccount",JSON.stringify(v.data.zelfAccount)),v.data.zelfProof&&localStorage.setItem("zelfProof",v.data.zelfProof),this.showSuccess(this.translocoService.translate("saving_operations.api_key_loaded_successfully",{itemName:this.saveData?.operation?.itemName||"API Key"}));else throw new Error("No API key received from server");setTimeout(()=>{this.saveConfirmationService.clearSaveData(),this.router.navigate([this.redirectUrl])},2e3)}catch(t){throw t}})}changePassword(e){return m(this,null,function*(){try{let t=b(x({},e),{identificationMethod:"email"}),a=yield this.httpWrapper.sendRequest("put",`${w.apiUrl}${w.endpoints.security.changePassword}`,t);a&&a.data&&(this.showSuccess(this.translocoService.translate("saving_operations.password_changed_successfully",{itemName:this.saveData?.operation?.itemName||"Password"})),setTimeout(()=>{this.saveConfirmationService.clearSaveData(),this.router.navigate([this.redirectUrl])},2e3))}catch(t){throw t}})}updateThemeSettings(e){return m(this,null,function*(){try{let t=b(x({},e),{identificationMethod:"email"}),a=yield this.httpWrapper.sendRequest("post",`${w.apiUrl}/api/license/theme`,t);a&&a.data&&(this.showSuccess(this.translocoService.translate("saving_operations.theme_settings_updated_successfully",{itemName:this.saveData?.operation?.itemName||"Theme Settings"})),setTimeout(()=>{this.saveConfirmationService.clearSaveData(),this.router.navigate([this.redirectUrl])},2e3))}catch(t){throw t}})}createLicense(e){return m(this,null,function*(){try{let t=yield this.httpWrapper.sendRequest("post",`${w.apiUrl}${w.endpoints.license.create}`,e),a=me.fromAPIResponseWithWrapper(t);localStorage.setItem("license",JSON.stringify(a.toJSON())),this.showSuccess(this.translocoService.translate("saving_operations.created_successfully",{itemName:this.saveData?.operation?.itemName||"Configuration"})),setTimeout(()=>{this.saveConfirmationService.clearSaveData(),this.router.navigate([this.redirectUrl])},2e3)}catch(t){throw t}})}updateProfile(e){return m(this,null,function*(){try{let t=x({},e),a;if(this.authService.zelfAccount?.publicData?.accountType==="staff_account"?a=yield this.staffService.updateProfile(t):a=yield this.clientService.updateProfile(t),a&&a.data)a.data.zelfAccount&&(localStorage.setItem("zelfAccount",JSON.stringify(a.data.zelfAccount)),this.authService.setSession({zelfProof:a.data.zelfProof||this.authService.zelfProof,zelfAccount:a.data.zelfAccount})),a.data.zelfProof&&localStorage.setItem("zelfProof",a.data.zelfProof),this.showSuccess(this.translocoService.translate("saving_operations.updated_successfully",{itemName:this.saveData?.operation?.itemName||"Profile"})),setTimeout(()=>{this.saveConfirmationService.clearSaveData(),this.router.navigate([this.redirectUrl])},2e3);else throw new Error("No response data received from server")}catch(t){throw t}})}showSuccess(e){this.isSuccess=!0,this.alertMessage=e,this.alertType="success",this.showAlert=!0,setTimeout(()=>{this.showAlert=!1},5e3)}inviteStaff(e){return m(this,null,function*(){let t=yield this.staffService.inviteStaff({staffEmail:e.staffEmail,staffPhone:e.staffPhone,staffCountryCode:e.staffCountryCode,staffName:e.staffName,role:e.role,faceBase64:e.faceBase64,masterPassword:e.masterPassword,isResend:e.isResend});this.showSuccess("Invitation sent successfully!"),setTimeout(()=>{this.router.navigate([this.saveData?.redirectUrl||"/settings/team"])},2e3)})}removeStaff(e){return m(this,null,function*(){yield this.staffService.removeStaff({staffEmail:e.staffEmail,faceBase64:e.faceBase64,masterPassword:e.masterPassword}),this.showSuccess("Staff member removed successfully!"),setTimeout(()=>{this.router.navigate([this.saveData?.redirectUrl||"/settings/team"])},2e3)})}updateStaffRole(e){return m(this,null,function*(){yield this.staffService.updateRole({staffEmail:e.staffEmail,newRole:e.newRole,faceBase64:e.faceBase64,masterPassword:e.masterPassword}),this.showSuccess("Role updated successfully!"),setTimeout(()=>{this.router.navigate([this.saveData?.redirectUrl||"/settings/team"])},2e3)})}showError(e){this.alertMessage=e,this.alertType="error",this.showAlert=!0,setTimeout(()=>{this.showAlert=!1},5e3)}handleTagExtensionOperation(e){return m(this,null,function*(){if(!this.saveData?.tagExtensionData){this.showError("No tag extension data available"),this.isLoading=!1;return}try{let t=b(x({},this.saveData.tagExtensionData),{faceBase64:e.faceBase64,password:e.password||this.masterPassword});yield this.tagsService.extendLicenseForOwner(t),this.showSuccess("License extended successfully!"),setTimeout(()=>{this.saveConfirmationService.clearSaveData(),this.router.navigate([this.redirectUrl])},2e3)}catch(t){let a="Failed to extend license. Please try again.";t?.message&&(t.message.includes("domain_not_owned")?a="You do not own this domain.":t.message.includes("license_not_found")?a="License not found. Please verify your credentials.":t.message.includes("tag_not_found")?a="Tag not found.":t.message.includes("error_decrypting")?a="Biometric verification failed. Please check your face image and master password.":a=t.message),this.showError(a)}finally{this.isLoading=!1}})}static{this.\u0275fac=function(t){return new(t||r)(_(fe),_(Q),_(X),_(F),_(R),_(Y),_(pe),_(ge),_(ue),_(he))}}static{this.\u0275cmp=I({type:r,selectors:[["app-save-confirmation"]],decls:19,vars:12,consts:[[1,"flex","flex-col","min-h-screen","bg-gray-50/50","dark:bg-gray-900","w-full","items-center","justify-center","p-4"],[1,"w-full","max-w-md","animate-fade-in"],[1,"bg-white","dark:bg-slate-800","rounded-3xl","shadow-xl","overflow-hidden","border","border-gray-100","dark:border-gray-700/50"],[1,"p-8","pb-0","text-center"],[1,"w-16","h-16","mx-auto","rounded-full","icon-holder","flex","items-center","justify-center","text-blue-600","dark:text-blue-400","mb-6","shadow-sm"],[1,"icon-size-8","font-material-symbols-outlined"],[1,"text-2xl","font-bold","text-gray-900","dark:text-white","mb-2","tracking-tight"],[1,"text-sm","text-gray-500","dark:text-gray-400","font-medium"],[1,"p-8"],[1,"mb-6","animate-fade-in"],[1,"flex","flex-col","items-center","justify-center","py-8","space-y-4"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-md","flex","items-center","justify-center","z-50","p-4","transition-opacity","duration-300","animate-fade-in"],[1,"flex","items-center","gap-3","p-4","rounded-2xl","border","transition-all","duration-300","shadow-sm"],[1,"icon-size-5","shrink-0"],[1,"text-sm","font-semibold"],["diameter","40",1,"text-blue-600","dark:text-blue-400"],[1,"text-center"],[1,"font-bold","text-gray-900","dark:text-white"],[1,"w-14","h-14","rounded-full","bg-green-100","dark:bg-green-900/30","flex","items-center","justify-center","text-green-600","dark:text-green-400","shadow-inner"],[1,"icon-size-7"],[1,"summary-card","bg-gray-50","dark:bg-gray-900/50","rounded-2xl","p-5","border","mb-6","transition-all","duration-300"],[1,"animate-fade-in",3,"ngSubmit"],[1,"space-y-2","mb-8"],[1,"text-xs","font-black","text-gray-400","dark:text-gray-500","ml-1","uppercase","tracking-widest"],[1,"input-wrapper","flex","items-center","w-full","bg-gray-50","dark:bg-gray-900/50","border","border-gray-200","dark:border-gray-700","rounded-xl","px-4","transition-all"],[1,"text-gray-400","icon-size-5","mr-3"],["name","masterPassword","required","",1,"flex-1","bg-transparent","border-none","focus:ring-0","text-gray-900","dark:text-white","py-4","font-bold","placeholder-gray-400","text-base",3,"ngModelChange","ngModel","type","placeholder"],["type","button",1,"text-gray-400","hover:text-gray-600","dark:hover:text-gray-300","transition-colors","ml-2",3,"click"],[1,"icon-size-5"],[1,"text-[11px]","text-gray-400","dark:text-gray-500","font-medium","pl-1","leading-relaxed"],[1,"grid","grid-cols-2","gap-4"],["type","button",1,"btn-secondary","px-6","py-3.5","rounded-xl","border","border-gray-200","dark:border-gray-700","text-gray-600","dark:text-gray-400","font-bold","tracking-tight",3,"click"],["type","submit",1,"btn-primary","px-6","py-3.5","rounded-xl","text-white","font-bold","tracking-tight","shadow-lg","disabled:opacity-30","disabled:grayscale","disabled:cursor-not-allowed",3,"disabled"],[1,"space-y-3"],[1,"space-y-2"],[1,"flex","justify-between","items-center"],[1,"text-xs","font-bold","uppercase","tracking-wider","text-gray-400","dark:text-gray-500"],[1,"text-sm","font-bold","text-gray-900","dark:text-white"],[1,"text-[10px]","font-black","uppercase","px-2","py-0.5","rounded","bg-green-100","text-green-700","dark:bg-green-900/30","dark:text-green-300","tracking-widest"],[1,"text-sm","font-bold","text-gray-900","dark:text-white","capitalize"],[1,"flex","justify-between","items-center","pt-2","border-t","border-gray-100","dark:border-gray-800"],[1,"text-[10px]","font-black","uppercase","px-2","py-0.5","rounded","bg-blue-100","text-blue-700","dark:bg-blue-900/30","dark:text-blue-300","tracking-widest"],[1,"text-sm","font-semibold","text-gray-900","dark:text-white"],[1,"text-sm","text-gray-500","dark:text-gray-400"],[1,"text-xs","font-bold","uppercase","px-2","py-0.5","rounded","bg-green-100","text-green-700","dark:bg-green-900/30","dark:text-green-300"],["type","button",1,"btn-passkey","w-full","flex","items-center","justify-center","gap-3","px-4","py-3.5","bg-blue-50/50","dark:bg-blue-900/10","text-blue-700","dark:text-blue-300","rounded-xl","font-bold","shadow-sm",3,"click"],[1,"mt-5","flex","items-center","gap-3"],[1,"h-px","bg-gray-100","dark:bg-gray-800","flex-1"],[1,"text-[10px]","font-black","text-gray-400","dark:text-gray-500","uppercase","tracking-widest"],[1,"bg-white","dark:bg-slate-900","rounded-3xl","w-full","max-w-4xl","max-h-[90vh]","overflow-hidden","shadow-2xl","flex","flex-col"],[1,"px-6","py-5","flex","items-center","justify-between","shrink-0","border-b","border-gray-100","dark:border-gray-800"],[1,"flex","flex-col"],[1,"text-xl","font-bold","text-gray-900","dark:text-white","leading-tight","tracking-tight"],[1,"flex","items-center","gap-1.5","mt-1"],[1,"bg-blue-50","dark:bg-blue-900/30","text-blue-600","dark:text-blue-400","rounded-full","px-2","py-0.5","text-[11px]","font-semibold","uppercase","tracking-wide","flex","items-center","gap-1"],[1,"icon-size-3"],[1,"text-xs","font-medium","text-gray-500","dark:text-gray-400"],["mat-icon-button","",1,"w-8","h-8","flex","items-center","justify-center","bg-gray-100","hover:bg-gray-200","dark:bg-gray-800","dark:hover:bg-gray-700","rounded-full","transition-colors",3,"click"],[1,"icon-size-4","text-gray-500","dark:text-gray-400"],[1,"p-0","pt-4","pb-8","overflow-y-auto","flex-1","flex","flex-col","justify-center","items-center"],[3,"biometricsSuccess","biometricsCancel","userData","isModalContext"]],template:function(t,a){t&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"mat-icon",5),s(6),o()(),n(7,"h2",6),s(8),l(9,"transloco"),o(),n(10,"p",7),s(11),l(12,"transloco"),o()(),n(13,"div",8),P(14,Pe,6,4,"div",9)(15,Se,9,6,"div",10)(16,ke,11,6,"div",10)(17,Le,25,24),o()(),P(18,je,20,9,"div",11),o()()),t&2&&(i(6),u(" ",a.saveData!=null&&a.saveData.securityData?"lock":a.saveData!=null&&a.saveData.themeData?"palette":a.saveData!=null&&a.saveData.tagExtensionData?"timer":"verified_user"," "),i(2),u(" ",(a.saveData==null||a.saveData.operation==null?null:a.saveData.operation.title)||c(9,8,"saving_operations.confirm_changes")," "),i(3),u(" ",(a.saveData==null||a.saveData.operation==null?null:a.saveData.operation.description)||c(12,10,"saving_operations.enter_password_proceed")," "),i(3),g(a.showAlert?14:-1),i(),g(a.isLoading?15:-1),i(),g(a.isSuccess?16:-1),i(),g(!a.isLoading&&!a.isSuccess&&a.saveData?17:-1),i(),g(a.showBiometricModal?18:-1))},dependencies:[U,re,ne,Z,ee,te,oe,ie,ae,W,q,$,se,J,K,ce,le,de,H,G],styles:[".fixed[_ngcontent-%COMP%]{position:fixed!important;z-index:99999!important}.icon-holder[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f61a,#2563eb1a);border:1px solid rgba(59,130,246,.1);box-shadow:0 10px 20px -5px #3b82f626}.dark-mode[_ngcontent-%COMP%]   .icon-holder[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f633,#2563eb33);border-color:#3b82f64d}.summary-card[_ngcontent-%COMP%]{transition:all .3s cubic-bezier(.4,0,.2,1);border:1px solid rgba(226,232,240,.8)}.summary-card[_ngcontent-%COMP%]:hover{border-color:#3b82f633;background-color:#f8fafcf2}.dark-mode[_ngcontent-%COMP%]   .summary-card[_ngcontent-%COMP%]{border-color:#33415580;background-color:#0f172a80}.dark-mode[_ngcontent-%COMP%]   .summary-card[_ngcontent-%COMP%]:hover{border-color:#3b82f64d;background-color:#1e293b99}.input-wrapper[_ngcontent-%COMP%]{transition:all .2s ease}.input-wrapper[_ngcontent-%COMP%]:focus-within{border-color:#3b82f6;box-shadow:0 0 0 4px #3b82f61a}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#111827,#1f2937);transition:all .3s cubic-bezier(.4,0,.2,1);box-shadow:0 4px 12px #0000001a}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#000,#111827);transform:translateY(-1px);box-shadow:0 6px 20px #00000026}.btn-primary[_ngcontent-%COMP%]:active:not(:disabled){transform:translateY(0)}.dark-mode[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fff,#f3f4f6);color:#111827}.dark-mode[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#f9fafb,#fff);box-shadow:0 6px 20px #ffffff1a}.btn-secondary[_ngcontent-%COMP%]{transition:all .2s ease}.btn-secondary[_ngcontent-%COMP%]:hover{background-color:#f1f5f9}.dark-mode[_ngcontent-%COMP%]   .btn-secondary[_ngcontent-%COMP%]:hover{background-color:#1e293b}.btn-passkey[_ngcontent-%COMP%]{transition:all .3s ease;border:1px solid rgb(191,219,254)}.btn-passkey[_ngcontent-%COMP%]:hover{border-color:#3b82f6;background-color:#dbeafe80}.dark-mode[_ngcontent-%COMP%]   .btn-passkey[_ngcontent-%COMP%]{border-color:#1e3a8a80}.dark-mode[_ngcontent-%COMP%]   .btn-passkey[_ngcontent-%COMP%]:hover{border-color:#3b82f6;background-color:#1e3a8a4d}.dark[_ngcontent-%COMP%]   .bg-gray-50[_ngcontent-%COMP%]{background-color:#111827}.dark[_ngcontent-%COMP%]   .bg-gray-800[_ngcontent-%COMP%]{background-color:#1f2937}.dark[_ngcontent-%COMP%]   .text-gray-900[_ngcontent-%COMP%]{color:#f9fafb}.dark[_ngcontent-%COMP%]   .text-gray-600[_ngcontent-%COMP%]{color:#d1d5db}.dark[_ngcontent-%COMP%]   .text-gray-400[_ngcontent-%COMP%]{color:#9ca3af}mat-form-field[_ngcontent-%COMP%]{width:100%}button[mat-flat-button][_ngcontent-%COMP%]{background-color:#3b82f6;color:#fff}button[mat-flat-button][_ngcontent-%COMP%]:hover:not(:disabled){background-color:#2563eb}button[mat-flat-button][_ngcontent-%COMP%]:disabled{background-color:#9ca3af;color:#6b7280}button[mat-stroked-button][_ngcontent-%COMP%]{border-color:#d1d5db;color:#374151}button[mat-stroked-button][_ngcontent-%COMP%]:hover:not(:disabled){background-color:#f9fafb}button[mat-stroked-button][_ngcontent-%COMP%]:disabled{border-color:#e5e7eb;color:#9ca3af}.mx-auto[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto}.h-12[_ngcontent-%COMP%]{height:3rem}.w-12[_ngcontent-%COMP%]{width:3rem}.h-6[_ngcontent-%COMP%]{height:1.5rem}.w-6[_ngcontent-%COMP%]{width:1.5rem}.text-3xl[_ngcontent-%COMP%]{font-size:1.875rem;line-height:2.25rem}.font-extrabold[_ngcontent-%COMP%]{font-weight:800}.text-sm[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.25rem}.space-y-8[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-top:2rem}.space-y-6[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-top:1.5rem}.space-y-2[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-top:.5rem}.space-x-4[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-left:1rem}.mt-6[_ngcontent-%COMP%]{margin-top:1.5rem}.mt-2[_ngcontent-%COMP%]{margin-top:.5rem}.mt-8[_ngcontent-%COMP%]{margin-top:2rem}.mb-4[_ngcontent-%COMP%]{margin-bottom:1rem}.mr-2[_ngcontent-%COMP%]{margin-right:.5rem}.p-4[_ngcontent-%COMP%]{padding:1rem}.p-6[_ngcontent-%COMP%]{padding:1.5rem}.flex[_ngcontent-%COMP%]{display:flex}.items-center[_ngcontent-%COMP%]{align-items:center}.justify-center[_ngcontent-%COMP%]{justify-content:center}.justify-between[_ngcontent-%COMP%]{justify-content:space-between}.flex-1[_ngcontent-%COMP%]{flex:1 1 0%}.max-w-md[_ngcontent-%COMP%]{max-width:28rem}.w-full[_ngcontent-%COMP%]{width:100%}.min-h-screen[_ngcontent-%COMP%]{min-height:100vh}.bg-blue-100[_ngcontent-%COMP%]{background-color:#dbeafe}.bg-green-50[_ngcontent-%COMP%]{background-color:#f0fdf4}.bg-red-50[_ngcontent-%COMP%]{background-color:#fef2f2}.bg-white[_ngcontent-%COMP%]{background-color:#fff}.bg-gray-50[_ngcontent-%COMP%]{background-color:#f9fafb}.bg-gray-800[_ngcontent-%COMP%]{background-color:#1f2937}.bg-gray-900[_ngcontent-%COMP%]{background-color:#111827}.text-blue-600[_ngcontent-%COMP%]{color:#2563eb}.text-blue-400[_ngcontent-%COMP%]{color:#60a5fa}.text-green-800[_ngcontent-%COMP%]{color:#166534}.text-red-800[_ngcontent-%COMP%]{color:#991b1b}.text-gray-900[_ngcontent-%COMP%]{color:#111827}.text-gray-600[_ngcontent-%COMP%]{color:#4b5563}.text-gray-500[_ngcontent-%COMP%]{color:#6b7280}.text-gray-400[_ngcontent-%COMP%]{color:#9ca3af}.text-white[_ngcontent-%COMP%]{color:#fff}.border-green-200[_ngcontent-%COMP%]{border-color:#bbf7d0}.border-red-200[_ngcontent-%COMP%]{border-color:#fecaca}.border-gray-200[_ngcontent-%COMP%]{border-color:#e5e7eb}.border-gray-700[_ngcontent-%COMP%]{border-color:#374151}.rounded-full[_ngcontent-%COMP%]{border-radius:9999px}.rounded-lg[_ngcontent-%COMP%]{border-radius:.5rem}.rounded-md[_ngcontent-%COMP%]{border-radius:.375rem}.border[_ngcontent-%COMP%]{border-width:1px}.border-b[_ngcontent-%COMP%]{border-bottom-width:1px}.shadow[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f}.shadow-2xl[_ngcontent-%COMP%]{box-shadow:0 25px 50px -12px #00000040}.z-50[_ngcontent-%COMP%]{z-index:50}@media (max-width: 640px){.max-w-md[_ngcontent-%COMP%]{max-width:100%}.p-4[_ngcontent-%COMP%]{padding:.75rem}.p-6[_ngcontent-%COMP%]{padding:1rem}}"]})}}return r})();export{pt as SaveConfirmationComponent};
