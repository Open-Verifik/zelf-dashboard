import{a as se,b as oe}from"./chunk-3ITT7UKH.js";import{a as ae}from"./chunk-NXPVZPNL.js";import{a as z}from"./chunk-EQ7VHPH6.js";import{a as re}from"./chunk-RWHW4F27.js";import{b as ne}from"./chunk-YE475IAC.js";import{a as A,b as j,d as Z}from"./chunk-HO6TKSQT.js";import{A as ie,b as J,d as h,f as B,g as K,i as E,l as q,o as G,q as H,r as U,s as Q,t as X,y as ee,z as te}from"./chunk-QH2I47VF.js";import{a as R}from"./chunk-EBTKBAUO.js";import{ea as O,fa as V}from"./chunk-3CSJK4TT.js";import"./chunk-E6ENPQNB.js";import{d as Y}from"./chunk-FXKMXYKD.js";import{j as M,r as W}from"./chunk-XX57SXRU.js";import{Ab as _,Ib as m,Mb as I,Pb as L,Pc as D,Ub as s,Vb as r,Wb as p,_b as T,ec as w,gb as a,gc as g,hb as f,ra as v,rc as o,sa as x,sc as c,tc as k,ub as P}from"./chunk-FFNUM7ZM.js";import{g as $}from"./chunk-TSRGIXR5.js";function ce(d,y){if(d&1&&(s(0,"div",3)(1,"div",50)(2,"div",46)(3,"div",51)(4,"mat-icon",9),o(5),r()(),s(6,"span",52),o(7),r()()()()),d&2){let e=g(2);a(),I(e.alertType==="success"?"bg-green-50 border-green-200 text-green-800 dark:bg-green-900/20 dark:border-green-800 dark:text-green-300":"bg-red-50 border-red-200 text-red-800 dark:bg-red-900/20 dark:border-red-800 dark:text-red-300"),a(2),I(e.alertType==="success"?"bg-green-100 text-green-600 dark:bg-green-800 dark:text-green-200":"bg-red-100 text-red-600 dark:bg-red-800 dark:text-red-200"),a(2),c(e.alertType==="success"?"check":"priority_high"),a(2),c(e.alertMessage)}}function me(d,y){if(d&1&&(s(0,"span",53),o(1),r()),d&2){let e=g().$implicit;a(),k(" ",e("license.basic_information.domain_required")," ")}}function ue(d,y){if(d&1&&(s(0,"span",53),o(1),r()),d&2){let e=g().$implicit;a(),k(" ",e("license.basic_information.domain_pattern_error")," ")}}function pe(d,y){if(d&1&&(s(0,"div",33)(1,"div",7)(2,"span",54)(3,"mat-icon",55),o(4,"vpn_key"),r(),o(5," ZelfKeys "),r(),p(6,"div",56),r(),s(7,"div",57)(8,"div",6)(9,"div",7)(10,"div",8)(11,"mat-icon",9),o(12,"vpn_key"),r()(),s(13,"div")(14,"h2",10),o(15),r(),s(16,"p",11),o(17,"Key storage settings"),r()()(),s(18,"div",58)(19,"div",59)(20,"div",60)(21,"span",61),o(22,"IPFS"),r(),p(23,"mat-slide-toggle",62),r()(),s(24,"div",59)(25,"div",60)(26,"span",61),o(27,"Arweave"),r(),p(28,"mat-slide-toggle",62),r()(),s(29,"div",59)(30,"div",60)(31,"span",61),o(32,"Walrus"),r(),p(33,"mat-slide-toggle",62),r()()(),s(34,"div",63)(35,"label",14),o(36),r(),p(37,"input",64),r()()()()),d&2){let e=g().$implicit;a(15),k(" ",e("license.storage_options.title")," (ZelfKeys) "),a(8),m("formControlName","zelfkeysIpfsEnabled"),a(5),m("formControlName","zelfkeysArweaveEnabled"),a(5),m("formControlName","zelfkeysWalrusEnabled"),a(3),c(e("license.storage_options.key_prefix")),a(),m("formControlName","zelfkeysKeyPrefix")}}function he(d,y){if(d&1&&(s(0,"mat-icon",65),o(1,"refresh"),r(),s(2,"span"),o(3),r()),d&2){let e=g().$implicit;a(3),c(e("license.actions.processing"))}}function ge(d,y){if(d&1&&(s(0,"span"),o(1),r()),d&2){let e=g().$implicit;a(),c(e("license.actions.save_configuration"))}}function fe(d,y){if(d&1){let e=T();s(0,"div",1)(1,"div",2),_(2,ce,8,6,"div",3),s(3,"form",4)(4,"div",5)(5,"div",6)(6,"div",7)(7,"div",8)(8,"mat-icon",9),o(9,"info"),r()(),s(10,"div")(11,"h2",10),o(12),r(),s(13,"p",11),o(14,"General domain settings"),r()()(),s(15,"div",12)(16,"div",13)(17,"label",14),o(18),r(),s(19,"div",15)(20,"span",16),o(21,"johndoe"),r(),s(22,"span",17),o(23,"."),r(),p(24,"input",18),r(),s(25,"div",19),_(26,me,2,1,"span",20)(27,ue,2,1,"span",20),r()(),s(28,"div",13)(29,"label",14),o(30),r(),p(31,"input",21),r(),s(32,"div",13)(33,"label",14),o(34),r(),p(35,"input",22),r(),s(36,"div",13)(37,"label",23),o(38),s(39,"span",24),o(40,"System"),r()(),p(41,"input",25),r(),s(42,"div",13)(43,"label",23),o(44),s(45,"span",24),o(46,"System"),r()(),p(47,"input",25),r(),s(48,"div",26)(49,"label",14),o(50),r(),p(51,"textarea",27),r()()()(),s(52,"div",5)(53,"div",6)(54,"div",7)(55,"div",28)(56,"mat-icon",9),o(57,"extension"),r()(),s(58,"div")(59,"h2",10),o(60),r(),s(61,"p",11),o(62,"Enable services"),r()()(),s(63,"div",29)(64,"div",30),w("click",function(){let i;v(e);let n=g();return x((i=n.accountForm.get("znsEnabled"))==null?null:i.setValue(!((i=n.accountForm.get("znsEnabled"))!=null&&i.value)))}),s(65,"div")(66,"h3",31),o(67),r(),s(68,"p",11),o(69),r()(),s(70,"mat-slide-toggle",32),w("click",function(i){return v(e),x(i.stopPropagation())}),r()(),s(71,"div",30),w("click",function(){let i;v(e);let n=g();return x((i=n.accountForm.get("zelfkeysEnabled"))==null?null:i.setValue(!((i=n.accountForm.get("zelfkeysEnabled"))!=null&&i.value)))}),s(72,"div")(73,"h3",31),o(74),r(),s(75,"p",11),o(76),r()(),s(77,"mat-slide-toggle",32),w("click",function(i){return v(e),x(i.stopPropagation())}),r()()()()(),_(78,pe,38,6,"div",33),s(79,"div",5)(80,"div",6)(81,"div",7)(82,"div",34)(83,"mat-icon",9),o(84,"description"),r()(),s(85,"div")(86,"h2",10),o(87),r(),s(88,"p",11),o(89,"Additional information"),r()()(),s(90,"div",12)(91,"div",13)(92,"label",14),o(93),r(),p(94,"input",35),r(),s(95,"div",13)(96,"label",14),o(97),r(),p(98,"input",36),r(),s(99,"div",13)(100,"label",14),o(101),r(),p(102,"input",36),r(),s(103,"div",13)(104,"label",14),o(105),r(),s(106,"div",37)(107,"select",38)(108,"option",39),o(109),r(),s(110,"option",40),o(111),r(),s(112,"option",41),o(113),r()(),s(114,"mat-icon",42),o(115,"expand_more"),r()()()()()(),s(116,"div",43)(117,"div",44)(118,"button",45),w("click",function(){v(e);let i=g();return x(i.cancel())}),o(119),r(),s(120,"div",46)(121,"button",47),o(122," Reset "),r(),s(123,"button",48),w("click",function(){v(e);let i=g();return x(i.saveLicense())}),_(124,he,4,1)(125,ge,2,1,"span"),r()()()(),p(126,"div",49),r()()()}if(d&2){let e,t,i,n=y.$implicit,l=g();a(2),L(l.showAlert?2:-1),a(),m("formGroup",l.accountForm),a(9),c(n("license.basic_information.title")),a(6),c(n("license.basic_information.domain_name")),a(6),m("formControlName","domain")("placeholder",n("license.basic_information.domain_placeholder")),a(2),m("ngIf",((e=l.accountForm.get("domain"))==null?null:e.hasError("required"))&&((e=l.accountForm.get("domain"))==null?null:e.touched)),a(),m("ngIf",((t=l.accountForm.get("domain"))==null?null:t.hasError("pattern"))&&((t=l.accountForm.get("domain"))==null?null:t.touched)),a(3),c(n("license.basic_information.status")),a(),m("formControlName","status"),a(3),c(n("license.basic_information.owner")),a(),m("formControlName","owner")("placeholder",n("license.basic_information.owner_placeholder")),a(3),k(" ",n("license.basic_information.start_date")," "),a(3),m("formControlName","startDate"),a(3),k(" ",n("license.basic_information.end_date")," "),a(3),m("formControlName","endDate"),a(3),c(n("license.basic_information.description")),a(),m("formControlName","description")("placeholder",n("license.basic_information.description_placeholder")),a(9),c(n("license.features.title")),a(7),c(n("license.features.zns_title")),a(2),c(n("license.features.zns_description")),a(),m("formControlName","znsEnabled"),a(4),c(n("license.features.zelfkeys_title")),a(2),c(n("license.features.zelfkeys_description")),a(),m("formControlName","zelfkeysEnabled"),a(),L((i=l.accountForm.get("zelfkeysEnabled"))!=null&&i.value?78:-1),a(9),c(n("license.metadata.title")),a(6),c(n("license.metadata.launch_date")),a(),m("formControlName","launchDate"),a(3),c(n("license.metadata.version")),a(),m("formControlName","version"),a(3),c(n("license.metadata.documentation_url")),a(),m("formControlName","documentation"),a(3),c(n("license.metadata.support_level")),a(2),m("formControlName","support"),a(2),c(n("license.metadata.support_standard")),a(2),c(n("license.metadata.support_premium")),a(2),c(n("license.metadata.support_enterprise")),a(5),m("disabled",l.isLoading),a(),k(" ",n("license.actions.cancel")," "),a(2),m("disabled",l.isLoading),a(2),m("disabled",l.isLoading||l.accountForm.invalid),a(),L(l.isLoading?124:125)}}var Te=(()=>{class d{constructor(e,t,i,n,l,u,b){this._formBuilder=e,this._router=t,this._saveConfirmationService=i,this._translocoService=n,this._cdr=l,this._licenseService=u,this._httpWrapper=b,this.alertMessage="",this.alertType="success",this.currentLicense=null,this.isLoading=!1,this.pricingTableRows=[],this.reservedWords=["www","api","admin","support","help"],this.showAlert=!1,this.whitelistItems=[],this.zelfkeysPlans=[],this.inappropriateWords=["dick","vagina","porn","sex","fuck","shit","bitch","ass","damn","hell","crap","piss","bastard","whore","slut","fag","nigger","retard","idiot","stupid","moron","dumb","hate","kill","die","death","murder","suicide"]}get networksFormGroup(){return this.accountForm.get("networks")}ngOnInit(){this.initializeWhitelistItems(),this.initializePricingTable(),this.createEmptyForm()}ngAfterViewInit(){this.loadLicense().then(()=>{this.populateFormFromLicense()})}createEmptyForm(){this.accountForm=this._formBuilder.group({domain:["",[h.required,h.pattern(/^[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9]$/)]],status:[{value:"active",disabled:!0}],owner:["zelf-team",h.required],description:["Official Zelf domain",h.required],znsEnabled:[!0],zelfkeysEnabled:[!0],minLength:[3,[h.required,h.min(1)]],maxLength:[27,[h.required,h.min(1),h.max(27)]],holdSuffix:[".hold",h.required],contentFilterEnabled:[!0],ipfsEnabled:[!0],arweaveEnabled:[!0],walrusEnabled:[!0],keyPrefix:["tagName",h.required],zelfkeysIpfsEnabled:[!0],zelfkeysArweaveEnabled:[!0],zelfkeysWalrusEnabled:[!0],zelfkeysKeyPrefix:["tagName",h.required],coinbaseEnabled:[!0],cryptoEnabled:[!0],stripeEnabled:[!0],networks:this.createNetworksFormGroup(),startDate:[{value:"",disabled:!0}],endDate:[{value:"",disabled:!0}],launchDate:["2023-01-01"],version:["1.0.0",h.required],documentation:["https://docs.zelf.world"],community:[""],enterprise:[""],support:["standard"]}),this.addWhitelistFormControls()}getSimplifiedNetworks(e){let t={};return Object.keys(e).forEach(i=>{t[i]={enabled:!!e[i].enabled}}),t}createNetworksFormGroup(e=null){let t=this._formBuilder.group({}),i=z.createEmpty("temp"),n=e||i.getNetworks();return Object.keys(n).forEach(l=>{let u=n[l];l.startsWith("other_")||t.addControl(l,this._formBuilder.group({enabled:[u.enabled],nativeCurrency:this._formBuilder.group({enabled:[u.nativeCurrency.enabled],code:[u.nativeCurrency.code]}),altCoins:u.altCoins?this._formBuilder.group({enabled:[u.altCoins.enabled],standard:[u.altCoins.standard]}):null}))}),t}initializeWhitelistItems(){this.whitelistItems=[{domain:"",discount:"",type:"percentage"}]}addWhitelistFormControls(){this.whitelistItems.forEach((e,t)=>{this.accountForm.get(`whitelistDomain_${t}`)||this.accountForm.addControl(`whitelistDomain_${t}`,new E(e.domain)),this.accountForm.get(`whitelistDiscount_${t}`)||this.accountForm.addControl(`whitelistDiscount_${t}`,new E(e.discount)),this.accountForm.get(`whitelistType_${t}`)||this.accountForm.addControl(`whitelistType_${t}`,new E(e.type))})}removeWhitelistFormControls(){this.whitelistItems.forEach((e,t)=>{this.accountForm.removeControl(`whitelistDomain_${t}`),this.accountForm.removeControl(`whitelistDiscount_${t}`),this.accountForm.removeControl(`whitelistType_${t}`)})}addReservedWord(e){e&&e.trim()&&!this.reservedWords.includes(e.trim())&&this.reservedWords.push(e.trim())}removeReservedWord(e){let t=this.reservedWords.indexOf(e);t>-1&&this.reservedWords.splice(t,1)}togglePaymentMethod(e){this.getPaymentMethods().includes(e)?e==="coinbase"?this.accountForm.get("coinbaseEnabled")?.setValue(!1):e==="crypto"?this.accountForm.get("cryptoEnabled")?.setValue(!1):e==="stripe"&&this.accountForm.get("stripeEnabled")?.setValue(!1):e==="coinbase"?this.accountForm.get("coinbaseEnabled")?.setValue(!0):e==="crypto"?this.accountForm.get("cryptoEnabled")?.setValue(!0):e==="stripe"&&this.accountForm.get("stripeEnabled")?.setValue(!0)}isPaymentMethodEnabled(e){return this.getPaymentMethods().includes(e)}addWhitelistItem(){let e={domain:"",discount:"",type:"percentage"};this.whitelistItems.push(e);let t=this.whitelistItems.length-1;this.accountForm.addControl(`whitelistDomain_${t}`,new E("")),this.accountForm.addControl(`whitelistDiscount_${t}`,new E("")),this.accountForm.addControl(`whitelistType_${t}`,new E("percentage"))}trackByWhitelistItem(e,t){return e}removeWhitelistItem(e){this.whitelistItems.length>1&&(this.accountForm.removeControl(`whitelistDomain_${e}`),this.accountForm.removeControl(`whitelistDiscount_${e}`),this.accountForm.removeControl(`whitelistType_${e}`),this.whitelistItems.splice(e,1),this.removeWhitelistFormControls(),this.addWhitelistFormControls())}validateDomainName(e){if(!this.accountForm.get("contentFilterEnabled")?.value)return!0;let t=e.toLowerCase();return!this.inappropriateWords.some(i=>t.includes(i))}getPaymentMethods(){let e=[];return this.accountForm.get("coinbaseEnabled")?.value&&e.push("coinbase"),this.accountForm.get("cryptoEnabled")?.value&&e.push("crypto"),this.accountForm.get("stripeEnabled")?.value&&e.push("stripe"),e}getDefaultPricingTable(){return{1:{1:240,2:432,3:612,4:768,5:900,lifetime:3600},2:{1:120,2:216,3:306,4:384,5:450,lifetime:1800},3:{1:72,2:130,3:184,4:230,5:270,lifetime:1080},4:{1:36,2:65,3:92,4:115,5:135,lifetime:540},5:{1:30,2:54,3:76,4:96,5:112,lifetime:450},"6-15":{1:24,2:43,3:61,4:77,5:90,lifetime:360},16:{1:23,2:41,3:59,4:74,5:86,lifetime:345},17:{1:22,2:40,3:56,4:70,5:82,lifetime:330},18:{1:21,2:38,3:54,4:67,5:79,lifetime:315},19:{1:20,2:36,3:51,4:64,5:75,lifetime:300},20:{1:19,2:34,3:48,4:61,5:72,lifetime:285},21:{1:18,2:32,3:46,4:58,5:68,lifetime:270},22:{1:17,2:31,3:43,4:54,5:64,lifetime:255},23:{1:16,2:29,3:41,4:51,5:60,lifetime:240},24:{1:15,2:27,3:38,4:48,5:56,lifetime:225},25:{1:14,2:25,3:36,4:45,5:53,lifetime:210},26:{1:13,2:23,3:33,4:42,5:49,lifetime:195},27:{1:12,2:22,3:31,4:38,5:45,lifetime:180}}}hasLicenseChanges(e){if(!this.currentLicense)return!0;let t=this.accountForm.value,i=this.currentLicense.domainConfig;if(this.currentLicense.domain!==e||i.name!==e||i.holdSuffix!==t.holdSuffix||i.status!==t.status||i.owner!==t.owner||i.description!==t.description)return!0;let n=!0,l=!0;if(n!==t.znsEnabled||l!==t.zelfkeysEnabled||i.tags?.minLength!==t.minLength||i.tags?.maxLength!==t.maxLength||i.tags?.storage?.keyPrefix!==t.keyPrefix||i.tags?.storage?.ipfsEnabled!==t.ipfsEnabled||i.tags?.storage?.arweaveEnabled!==t.arweaveEnabled||i.tags?.storage?.walrusEnabled!==t.walrusEnabled||i.zelfkeys?.storage?.keyPrefix!==t.zelfkeysKeyPrefix||i.zelfkeys?.storage?.ipfsEnabled!==t.zelfkeysIpfsEnabled||i.zelfkeys?.storage?.arweaveEnabled!==t.zelfkeysArweaveEnabled||i.zelfkeys?.storage?.walrusEnabled!==t.zelfkeysWalrusEnabled)return!0;let u=i.tags?.payment?.methods||[],b=this.getPaymentMethods();if(JSON.stringify(u.sort())!==JSON.stringify(b.sort()))return!0;let S=i.tags?.payment?.networks||this.currentLicense.getNetworks(),F=t.networks;if(JSON.stringify(S)!==JSON.stringify(F))return!0;let C=i.tags?.payment?.whitelist||{},N=this.buildWhitelistFromForm();if(JSON.stringify(C)!==JSON.stringify(N))return!0;let le=i.tags?.payment?.pricingTable||{},de=this.getPricingTableFromRows();return JSON.stringify(le)!==JSON.stringify(de)||i.metadata.launchDate!==t.launchDate||i.metadata.version!==t.version||i.metadata.documentation!==t.documentation||i.metadata.community!==t.community||i.metadata.enterprise!==t.enterprise||i.metadata.support!==t.support}getLicenseChanges(e){if(!this.currentLicense)return["Creating new license"];let t=[],i=this.accountForm.value,n=this.currentLicense.domainConfig;return this.getBasicInfoChanges(n,e,i,t),this.getFeatureChanges(i,t),this.getValidationChanges(n,i,t),this.getStorageChanges(n,i,t),this.getPaymentChanges(n,i,t),this.getMetadataChanges(n,i,t),t}getBasicInfoChanges(e,t,i,n){this.currentLicense?.domain!==t&&n.push(`Domain: ${this.currentLicense?.domain} \u2192 ${t}`),e.name!==t&&n.push(`Name: ${e.name} \u2192 ${t}`),e.holdSuffix!==i.holdSuffix&&n.push(`Hold Suffix: ${e.holdSuffix} \u2192 ${i.holdSuffix}`),e.status!==i.status&&n.push(`Status: ${e.status} \u2192 ${i.status}`),e.owner!==i.owner&&n.push(`Owner: ${e.owner} \u2192 ${i.owner}`),e.description!==i.description&&n.push(`Description: ${e.description} \u2192 ${i.description}`)}getFeatureChanges(e,t){e.znsEnabled!==!0&&t.push(`ZNS Feature: true \u2192 ${e.znsEnabled}`),e.zelfkeysEnabled!==!0&&t.push(`Zelfkeys Feature: true \u2192 ${e.zelfkeysEnabled}`)}getValidationChanges(e,t,i){e.tags?.minLength!==t.minLength&&i.push(`Min Length: ${e.tags?.minLength} \u2192 ${t.minLength}`),e.tags?.maxLength!==t.maxLength&&i.push(`Max Length: ${e.tags?.maxLength} \u2192 ${t.maxLength}`)}getStorageChanges(e,t,i){e.tags?.storage?.keyPrefix!==t.keyPrefix&&i.push(`ZNS Key Prefix: ${e.tags?.storage?.keyPrefix} \u2192 ${t.keyPrefix}`),e.tags?.storage?.ipfsEnabled!==t.ipfsEnabled&&i.push(`ZNS IPFS Enabled: ${e.tags?.storage?.ipfsEnabled} \u2192 ${t.ipfsEnabled}`),e.tags?.storage?.arweaveEnabled!==t.arweaveEnabled&&i.push(`ZNS Arweave Enabled: ${e.tags?.storage?.arweaveEnabled} \u2192 ${t.arweaveEnabled}`),e.tags?.storage?.walrusEnabled!==t.walrusEnabled&&i.push(`ZNS Walrus Enabled: ${e.tags?.storage?.walrusEnabled} \u2192 ${t.walrusEnabled}`),e.zelfkeys?.storage?.keyPrefix!==t.zelfkeysKeyPrefix&&i.push(`ZelfKeys Key Prefix: ${e.zelfkeys?.storage?.keyPrefix} \u2192 ${t.zelfkeysKeyPrefix}`),e.zelfkeys?.storage?.ipfsEnabled!==t.zelfkeysIpfsEnabled&&i.push(`ZelfKeys IPFS Enabled: ${e.zelfkeys?.storage?.ipfsEnabled} \u2192 ${t.zelfkeysIpfsEnabled}`),e.zelfkeys?.storage?.arweaveEnabled!==t.zelfkeysArweaveEnabled&&i.push(`ZelfKeys Arweave Enabled: ${e.zelfkeys?.storage?.arweaveEnabled} \u2192 ${t.zelfkeysArweaveEnabled}`),e.zelfkeys?.storage?.walrusEnabled!==t.zelfkeysWalrusEnabled&&i.push(`ZelfKeys Walrus Enabled: ${e.zelfkeys?.storage?.walrusEnabled} \u2192 ${t.zelfkeysWalrusEnabled}`)}getPaymentChanges(e,t,i){let n=e.tags?.payment?.methods||[],l=this.getPaymentMethods();JSON.stringify(n.sort())!==JSON.stringify(l.sort())&&i.push(`Payment Methods: ${n.join(", ")} \u2192 ${l.join(", ")}`);let u=e.tags?.payment?.networks||this.currentLicense?.getNetworks(),b=t.networks;JSON.stringify(u)!==JSON.stringify(b)&&i.push("Networks configuration updated");let S=e.tags?.payment?.whitelist||{},F=this.buildWhitelistFromForm();JSON.stringify(S)!==JSON.stringify(F)&&i.push(`Whitelist: ${Object.keys(S).length} \u2192 ${Object.keys(F).length} entries`);let C=e.tags?.payment?.pricingTable||{},N=this.getPricingTableFromRows();JSON.stringify(C)!==JSON.stringify(N)&&i.push("Pricing Table: Updated")}getMetadataChanges(e,t,i){e.metadata.launchDate!==t.launchDate&&i.push(`Launch Date: ${e.metadata.launchDate} \u2192 ${t.launchDate}`),e.metadata.version!==t.version&&i.push(`Version: ${e.metadata.version} \u2192 ${t.version}`),e.metadata.documentation!==t.documentation&&i.push(`Documentation: ${e.metadata.documentation} \u2192 ${t.documentation}`),e.metadata.community!==t.community&&i.push(`Community: ${e.metadata.community} \u2192 ${t.community}`),e.metadata.enterprise!==t.enterprise&&i.push(`Enterprise: ${e.metadata.enterprise} \u2192 ${t.enterprise}`),e.metadata.support!==t.support&&i.push(`Support: ${e.metadata.support} \u2192 ${t.support}`)}buildWhitelistFromForm(){let e={};return this.whitelistItems.forEach(t=>{let i=t.domain?.trim(),n=t.discount?.toString().trim(),l=t.type?.trim();if(i&&n&&l){let u=l==="percentage"?"%":l==="fixed"?"$":l;e[i]=`${n}${u}`}}),e}cleanupInvalidData(){let e=this.getPaymentMethods(),t=e.filter(i=>["coinbase","crypto","stripe"].includes(i));if(t.length!==e.length){let i=e.filter(n=>!["coinbase","crypto","stripe"].includes(n));this.accountForm.get("coinbaseEnabled")?.setValue(t.includes("coinbase")),this.accountForm.get("cryptoEnabled")?.setValue(t.includes("crypto")),this.accountForm.get("stripeEnabled")?.setValue(t.includes("stripe")),i.length>0&&this.showError(`Removed invalid payment methods: ${i.join(", ")}. These are no longer supported.`)}}validateDataBeforeSend(){let e=[],i=this.getPaymentMethods().filter(n=>!["coinbase","crypto","stripe"].includes(n));return i.length>0&&e.push(`Invalid payment methods: ${i.join(", ")}. Allowed: coinbase, crypto, stripe`),{valid:e.length===0,errors:e}}buildDomainConfig(){let e=this.accountForm.value,t=this.validateDataBeforeSend();if(!t.valid)throw this.showError(`Validation failed: ${t.errors.join(", ")}`),new Error(`Validation failed: ${t.errors.join(", ")}`);let i=this.buildWhitelistFromForm();return{name:e.domain,holdSuffix:e.holdSuffix,status:this.accountForm.get("status")?.value||"active",owner:e.owner,description:e.description,tags:{minLength:e.minLength,maxLength:e.maxLength,allowedChars:/^[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9]$/,reserved:this.reservedWords,customRules:[],payment:{methods:this.getPaymentMethods(),networks:e.networks,discounts:{yearly:.1,lifetime:.2},rewardPrice:10,whitelist:i,pricingTable:this.getPricingTableFromRows()},storage:{keyPrefix:e.keyPrefix,ipfsEnabled:e.ipfsEnabled,arweaveEnabled:e.arweaveEnabled,walrusEnabled:e.walrusEnabled},wallet:{networks:this.getSimplifiedNetworks(e.networks||{})}},zelfkeys:{plans:this.zelfkeysPlans,payment:{whitelist:{},pricingTable:{}},storage:{keyPrefix:e.zelfkeysKeyPrefix,ipfsEnabled:e.zelfkeysIpfsEnabled,arweaveEnabled:e.zelfkeysArweaveEnabled,walrusEnabled:e.zelfkeysWalrusEnabled}},metadata:{launchDate:e.launchDate,version:e.version,documentation:e.documentation,community:e.community||void 0,enterprise:e.enterprise||void 0,support:e.support}}}loadCurrentLicense(){let e=localStorage.getItem("license");if(e)try{let t=JSON.parse(e);this.currentLicense=z.fromJSON(t)}catch(t){console.error("Error parsing stored license:",t)}}fetchLicenseFromBackend(){return $(this,null,function*(){try{this.isLoading=!0,this._cdr.detectChanges();let e=yield this._licenseService.getMyLicense(!0);if(!e||!e.data||!e.data.myLicense)return;this.currentLicense=z.fromAPIResponseWithWrapper(e.data.myLicense.domainConfig),localStorage.setItem("license",JSON.stringify(this.currentLicense.toJSON()))}catch(e){console.error("Error fetching license from backend:",e),this.showAlert=!0,this.alertMessage="Failed to fetch license from server",this.alertType="error"}finally{this.isLoading=!1,this._cdr.detectChanges()}})}loadLicense(){return $(this,null,function*(){this.currentLicense?.domain||(yield this.fetchLicenseFromBackend())})}populateFormFromLicense(){let e=this.currentLicense?.domainConfig;e&&(this.populateBasicInfo(e),this.populateFeatures(e),this.populateValidationRules(e),this.populateStorageOptions(e),this.populatePaymentSettings(e),this.populateMetadata(e)),this.cleanupInvalidData(),this._cdr.detectChanges()}populateBasicInfo(e){this.accountForm.get("domain")?.setValue(e.name||""),this.accountForm.get("status")?.setValue(e.status||"active"),this.accountForm.get("owner")?.setValue(e.owner||"zelf-team"),this.accountForm.get("description")?.setValue(e.description||"Official Zelf domain"),this.accountForm.get("startDate")?.setValue(e.startDate||""),this.accountForm.get("endDate")?.setValue(e.endDate||"")}populateFeatures(e){this.accountForm.get("znsEnabled")?.setValue(!0),this.accountForm.get("zelfkeysEnabled")?.setValue(!0)}populateValidationRules(e){this.accountForm.get("minLength")?.setValue(e.tags?.minLength||3),this.accountForm.get("maxLength")?.setValue(e.tags?.maxLength||50),this.accountForm.get("holdSuffix")?.setValue(e.holdSuffix||".hold"),e.tags?.reserved&&(this.reservedWords=[...e.tags.reserved])}populateStorageOptions(e){this.accountForm.get("ipfsEnabled")?.setValue(e.tags?.storage?.ipfsEnabled??!0),this.accountForm.get("arweaveEnabled")?.setValue(e.tags?.storage?.arweaveEnabled??!0),this.accountForm.get("walrusEnabled")?.setValue(e.tags?.storage?.walrusEnabled??!0),this.accountForm.get("keyPrefix")?.setValue(e.tags?.storage?.keyPrefix||"tagName"),this.accountForm.get("zelfkeysIpfsEnabled")?.setValue(e.zelfkeys?.storage?.ipfsEnabled??!0),this.accountForm.get("zelfkeysArweaveEnabled")?.setValue(e.zelfkeys?.storage?.arweaveEnabled??!0),this.accountForm.get("zelfkeysWalrusEnabled")?.setValue(e.zelfkeys?.storage?.walrusEnabled??!0),this.accountForm.get("zelfkeysKeyPrefix")?.setValue(e.zelfkeys?.storage?.keyPrefix||"tagName")}populatePaymentSettings(e){if(this.accountForm.get("coinbaseEnabled")?.setValue(e.tags?.payment?.methods?.includes("coinbase")??!0),this.accountForm.get("cryptoEnabled")?.setValue(e.tags?.payment?.methods?.includes("crypto")??!0),this.accountForm.get("stripeEnabled")?.setValue(e.tags?.payment?.methods?.includes("stripe")??!0),this.currentLicense){let t=this.currentLicense.getNetworks();this.accountForm.setControl("networks",this.createNetworksFormGroup(t))}e.tags?.payment?.pricingTable&&this.loadPricingTableFromConfig(e.tags.payment.pricingTable),this.populateWhitelist(e),e.zelfkeys?.plans&&(this.zelfkeysPlans=[...e.zelfkeys.plans])}populateWhitelist(e){e.tags?.payment?.whitelist&&(this.whitelistItems=Object.entries(e.tags.payment.whitelist).map(([t,i])=>{let n=i,l=n.match(/^(\d+(?:\.\d+)?)([%$])$/);if(l){let u=l[2],b=u==="%"?"percentage":u==="$"?"fixed":u;return{domain:t,discount:l[1],type:b}}return{domain:t,discount:n,type:"percentage"}})),this.whitelistItems.forEach((t,i)=>{this.accountForm.get(`whitelistDomain_${i}`)?.setValue(t.domain),this.accountForm.get(`whitelistDiscount_${i}`)?.setValue(t.discount),this.accountForm.get(`whitelistType_${i}`)?.setValue(t.type)})}populateMetadata(e){this.accountForm.get("launchDate")?.setValue(e.metadata?.launchDate||"2023-01-01"),this.accountForm.get("version")?.setValue(e.metadata?.version||"1.0.0"),this.accountForm.get("documentation")?.setValue(e.metadata?.documentation||"https://docs.zelf.world"),this.accountForm.get("community")?.setValue(e.metadata?.community||""),this.accountForm.get("enterprise")?.setValue(e.metadata?.enterprise||""),this.accountForm.get("support")?.setValue(e.metadata?.support||"standard")}saveLicense(){if(this.accountForm.invalid){this.showError("Please fill in all required fields correctly");return}let e=this.accountForm.get("domain")?.value;if(!e){this.showError("Domain is required");return}if(!this.validateDomainName(e)){this.showError("Domain name contains inappropriate content. Please choose a different name.");return}if(this.currentLicense&&!this.hasLicenseChanges(e)){this.showError("No changes detected. Please modify at least one field before saving.");return}let t=this.buildDomainConfig();this._saveConfirmationService.setSaveData({domain:t.name,domainConfig:t,redirectUrl:"/settings/license",operation:{title:this._translocoService.translate("saving_operations.license_configuration.title"),description:this._translocoService.translate("saving_operations.license_configuration.description"),action:this._translocoService.translate("saving_operations.license_configuration.action"),itemName:this._translocoService.translate("saving_operations.license_configuration.itemName")}}),this._router.navigate(["/save-confirmation"],{queryParams:{redirect:"/settings/license"}})}showSuccess(e){this.alertMessage=e,this.alertType="success",this.showAlert=!0,setTimeout(()=>{this.showAlert=!1},5e3)}showError(e){this.alertMessage=e,this.alertType="error",this.showAlert=!0,setTimeout(()=>{this.showAlert=!1},5e3)}cancel(){this.loadCurrentLicense()}getCurrentLicense(){return this.currentLicense}isLicenseActive(){return this.currentLicense?.isActive()||!1}licenseSupportsFeature(e){return this.currentLicense?.supportsFeature(e)||!1}getTagPrice(e,t="1",i=""){return this.currentLicense?.getPrice(e,t,i)||null}validateTagName(e){return this.currentLicense?.validateTagName(e)||{valid:!1,error:"No license found"}}generateHoldDomain(e){return this.currentLicense?.generateHoldDomain(e)||""}initializePricingTable(){let e=this.getDefaultPricingTable();this.pricingTableRows=[];for(let i=1;i<=5;i++){let n=e[i]||{1:0,2:0,3:0,4:0,5:0,lifetime:0};this.pricingTableRows.push({length:i.toString(),oneYear:n[1]||0,twoYears:n[2]||0,threeYears:n[3]||0,fourYears:n[4]||0,fiveYears:n[5]||0,lifetime:n.lifetime||0})}let t=e["6-15"]||{1:0,2:0,3:0,4:0,5:0,lifetime:0};this.pricingTableRows.push({length:"6-15",oneYear:t[1]||0,twoYears:t[2]||0,threeYears:t[3]||0,fourYears:t[4]||0,fiveYears:t[5]||0,lifetime:t.lifetime||0});for(let i=16;i<=27;i++){let n=e[i]||{1:0,2:0,3:0,4:0,5:0,lifetime:0};this.pricingTableRows.push({length:i.toString(),oneYear:n[1]||0,twoYears:n[2]||0,threeYears:n[3]||0,fourYears:n[4]||0,fiveYears:n[5]||0,lifetime:n.lifetime||0})}}resetPricingTable(){this.initializePricingTable()}trackByPricingRow(e,t){return t.length}getPricingTableFromRows(){let e={};return this.pricingTableRows.forEach(t=>{e[t.length]={1:t.oneYear||0,2:t.twoYears||0,3:t.threeYears||0,4:t.fourYears||0,5:t.fiveYears||0,lifetime:t.lifetime||0}}),e}loadPricingTableFromConfig(e){if(!e){this.initializePricingTable();return}this.pricingTableRows=[];for(let i=1;i<=5;i++){let n=e[i]||{1:0,2:0,3:0,4:0,5:0,lifetime:0};this.pricingTableRows.push({length:i.toString(),oneYear:n[1]||0,twoYears:n[2]||0,threeYears:n[3]||0,fourYears:n[4]||0,fiveYears:n[5]||0,lifetime:n.lifetime||0})}let t=e["6-15"]||{1:0,2:0,3:0,4:0,5:0,lifetime:0};this.pricingTableRows.push({length:"6-15",oneYear:t[1]||0,twoYears:t[2]||0,threeYears:t[3]||0,fourYears:t[4]||0,fiveYears:t[5]||0,lifetime:t.lifetime||0});for(let i=16;i<=27;i++){let n=e[i]||{1:0,2:0,3:0,4:0,5:0,lifetime:0};this.pricingTableRows.push({length:i.toString(),oneYear:n[1]||0,twoYears:n[2]||0,threeYears:n[3]||0,fourYears:n[4]||0,fiveYears:n[5]||0,lifetime:n.lifetime||0})}}static{this.\u0275fac=function(t){return new(t||d)(f(ee),f(Y),f(re),f(A),f(D),f(ae),f(R))}}static{this.\u0275cmp=P({type:d,selectors:[["settings-license"]],decls:1,vars:0,consts:[["class","flex flex-col min-h-screen bg-gray-50/50 dark:bg-gray-900 w-full",4,"transloco"],[1,"flex","flex-col","min-h-screen","bg-gray-50/50","dark:bg-gray-900","w-full"],[1,"flex-auto","px-4","py-8","sm:px-6","sm:py-12","md:px-8","w-full","max-w-4xl","mx-auto"],[1,"mb-6","animate-fade-in"],[3,"formGroup"],[1,"bg-white","dark:bg-slate-800","rounded-3xl","shadow-xl","overflow-hidden","mb-8","border","border-gray-100","dark:border-gray-700/50"],[1,"p-8","sm:p-10"],[1,"flex","items-center","gap-3","mb-6"],[1,"w-10","h-10","rounded-full","bg-blue-100","dark:bg-blue-900/30","flex","items-center","justify-center","text-blue-600","dark:text-blue-400"],[1,"icon-size-5"],[1,"text-xl","font-bold","text-gray-900","dark:text-white"],[1,"text-sm","text-gray-500","dark:text-gray-400"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"space-y-1.5"],[1,"text-sm","font-semibold","text-gray-700","dark:text-gray-300","ml-1"],[1,"flex","items-center","w-full","bg-gray-50","dark:bg-gray-900/50","border","border-gray-200","dark:border-gray-700","rounded-xl","px-4","focus-within:border-gray-400","dark:focus-within:border-gray-500","focus-within:ring-4","focus-within:ring-gray-100","dark:focus-within:ring-gray-800","transition-all"],[1,"text-gray-500","font-medium","select-none","text-base"],[1,"text-gray-400","dark:text-gray-500","font-medium","select-none","mx-0.5"],[1,"flex-1","bg-transparent","border-none","focus:ring-0","text-gray-900","dark:text-white","py-3","font-semibold","text-base","placeholder-gray-400",3,"formControlName","placeholder"],[1,"h-4","pl-1"],["class","text-xs text-red-500 font-medium",4,"ngIf"],["readonly","",1,"w-full","bg-gray-100","dark:bg-gray-800","text-gray-500","dark:text-gray-400","border","border-gray-200","dark:border-gray-700","rounded-xl","px-4","py-3","cursor-not-allowed","font-medium","uppercase",3,"formControlName"],[1,"w-full","bg-gray-50","dark:bg-gray-900/50","text-gray-900","dark:text-white","border","border-gray-200","dark:border-gray-700","rounded-xl","px-4","py-3","focus:outline-none","focus:ring-2","focus:ring-gray-900","dark:focus:ring-gray-100","transition-all","font-medium",3,"formControlName","placeholder"],[1,"text-sm","font-semibold","text-gray-700","dark:text-gray-300","ml-1","flex","items-center","justify-between"],[1,"text-xs","font-normal","text-orange-500","bg-orange-50","dark:bg-orange-900/20","px-2","py-0.5","rounded-full"],["type","date","readonly","",1,"w-full","bg-gray-100","dark:bg-gray-800","text-gray-500","dark:text-gray-400","border","border-gray-200","dark:border-gray-700","rounded-xl","px-4","py-3","cursor-not-allowed","font-medium",3,"formControlName"],[1,"md:col-span-2","space-y-1.5"],["rows","3",1,"w-full","bg-gray-50","dark:bg-gray-900/50","text-gray-900","dark:text-white","border","border-gray-200","dark:border-gray-700","rounded-xl","px-4","py-3","focus:outline-none","focus:ring-2","focus:ring-gray-900","dark:focus:ring-gray-100","transition-all","font-medium","resize-none",3,"formControlName","placeholder"],[1,"w-10","h-10","rounded-full","bg-green-100","dark:bg-green-900/30","flex","items-center","justify-center","text-green-600","dark:text-green-400"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"flex","items-center","justify-between","p-5","rounded-2xl","border","border-gray-100","dark:border-gray-700/50","hover:bg-gray-50","dark:hover:bg-gray-700/30","transition-all","cursor-pointer",3,"click"],[1,"font-semibold","text-gray-900","dark:text-white"],[3,"click","formControlName"],[1,"mb-8","animate-fade-in","pl-4","border-l-2","border-blue-500"],[1,"w-10","h-10","rounded-full","bg-cyan-100","dark:bg-cyan-900/30","flex","items-center","justify-center","text-cyan-600","dark:text-cyan-400"],["type","date",1,"w-full","bg-gray-50","dark:bg-gray-900/50","text-gray-900","dark:text-white","border","border-gray-200","dark:border-gray-700","rounded-xl","px-4","py-3","focus:outline-none","focus:ring-2","focus:ring-cyan-500","transition-all","font-medium",3,"formControlName"],[1,"w-full","bg-gray-50","dark:bg-gray-900/50","text-gray-900","dark:text-white","border","border-gray-200","dark:border-gray-700","rounded-xl","px-4","py-3","focus:outline-none","focus:ring-2","focus:ring-cyan-500","transition-all","font-medium",3,"formControlName"],[1,"relative"],[1,"w-full","bg-gray-50","dark:bg-gray-900/50","text-gray-900","dark:text-white","border","border-gray-200","dark:border-gray-700","rounded-xl","px-4","py-3","focus:outline-none","focus:ring-2","focus:ring-cyan-500","transition-all","font-medium","appearance-none",3,"formControlName"],["value","standard"],["value","premium"],["value","enterprise"],[1,"absolute","right-4","top-1/2","-translate-y-1/2","icon-size-4","text-gray-500","pointer-events-none"],[1,"sticky","bottom-6","z-10","mx-auto","max-w-4xl"],[1,"bg-gray-900/90","dark:bg-slate-800/90","backdrop-blur-md","rounded-2xl","shadow-2xl","p-4","flex","items-center","justify-between","border","border-white/10"],[1,"px-4","py-2","text-gray-300","hover:text-white","text-sm","font-medium","transition-colors",3,"click","disabled"],[1,"flex","items-center","gap-3"],[1,"px-4","py-2","text-gray-300","hover:text-white","text-sm","font-medium","transition-colors",3,"disabled"],[1,"px-6","py-2","bg-white","text-gray-900","rounded-xl","text-sm","font-bold","hover:bg-gray-100","transition-colors","shadow-lg","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],[1,"h-12"],[1,"flex","items-center","justify-between","p-4","rounded-2xl","shadow-sm","border","transaction-all","duration-300"],[1,"w-8","h-8","rounded-full","flex","items-center","justify-center","shrink-0"],[1,"font-medium","text-sm"],[1,"text-xs","text-red-500","font-medium"],[1,"px-4","py-1.5","bg-blue-100","dark:bg-blue-900/30","text-blue-700","dark:text-blue-300","rounded-full","text-sm","font-bold","border","border-blue-200","dark:border-blue-800","flex","items-center","gap-2","shadow-sm"],[1,"icon-size-4"],[1,"h-px","bg-blue-200","dark:bg-blue-800/50","flex-1"],[1,"bg-white","dark:bg-slate-800","rounded-3xl","shadow-xl","overflow-hidden","border","border-gray-100","dark:border-gray-700/50"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-6"],[1,"p-4","rounded-xl","border","border-gray-200","dark:border-gray-700","hover:bg-gray-50","dark:hover:bg-gray-900/20"],[1,"flex","justify-between","items-center","mb-2"],[1,"font-medium","text-gray-900","dark:text-white"],[3,"formControlName"],[1,"space-y-1.5","max-w-md"],[1,"w-full","bg-gray-50","dark:bg-gray-900/50","text-gray-900","dark:text-white","border","border-gray-200","dark:border-gray-700","rounded-xl","px-4","py-3","focus:outline-none","focus:ring-2","focus:ring-blue-500","transition-all","font-medium",3,"formControlName"],[1,"icon-size-4","animate-spin"]],template:function(t,i){t&1&&_(0,fe,127,45,"div",0)},dependencies:[W,M,te,q,Q,X,J,U,B,K,ie,G,H,V,O,oe,se,ne,Z,j],encapsulation:2,changeDetection:0})}}return d})();export{Te as SettingsLicenseComponent};
