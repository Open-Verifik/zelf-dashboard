import{a as E,d as A}from"./chunk-XFX2TJJI.js";import{ea as M,fa as P}from"./chunk-4GCD5IXU.js";import{a as T,b as I}from"./chunk-KSS252YM.js";import{p as C}from"./chunk-6CPQKJQE.js";import{Ba as b,Ib as y,Ub as d,Vb as u,Wb as S,aa as v,ec as w,gb as h,rc as m,ub as k}from"./chunk-BTAKDWI7.js";import{g as c}from"./chunk-TSRGIXR5.js";var j=(()=>{class a{constructor(){this.onSave=new b,this.onCancel=new b}save(){this.onSave.emit()}cancel(){this.onCancel.emit()}static{this.\u0275fac=function(e){return new(e||a)}}static{this.\u0275cmp=k({type:a,selectors:[["app-passkey-prompt-modal"]],outputs:{onSave:"onSave",onCancel:"onCancel"},decls:14,vars:4,consts:[[1,"fixed","inset-0","z-50","flex","items-center","justify-center","p-4","bg-black/60","backdrop-blur-sm"],[1,"w-full","max-w-[400px]","bg-white","dark:bg-zinc-900","rounded-3xl","shadow-2xl","overflow-hidden","border","border-gray-100","dark:border-zinc-800"],[1,"p-8","flex","flex-col","items-center","text-center"],[1,"w-16","h-16","rounded-full","bg-primary-50","dark:bg-primary-900/20","flex","items-center","justify-center","mb-6","text-primary-600","dark:text-primary-400"],[1,"icon-size-8",3,"svgIcon"],[1,"text-2xl","font-bold","text-gray-900","dark:text-white","mb-2","leading-tight"],[1,"text-gray-500","dark:text-gray-400","mb-8","leading-relaxed"],[1,"w-full","space-y-3"],["mat-flat-button","",1,"w-full","!rounded-xl","!h-12","!text-base",3,"click","color"],["mat-button","",1,"w-full","!rounded-xl","!h-12","!text-base","text-gray-500","dark:text-gray-400","hover:text-gray-900","dark:hover:text-white",3,"click"]],template:function(e,t){e&1&&(d(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),S(4,"mat-icon",4),u(),d(5,"h2",5),m(6,"Save Passkey"),u(),d(7,"p",6),m(8," Secure your account with a Passkey. Log in instantly using your fingerprint or face recognition. "),u(),d(9,"div",7)(10,"button",8),w("click",function(){return t.save()}),m(11,"Save Passkey"),u(),d(12,"button",9),w("click",function(){return t.cancel()}),m(13," Not now "),u()()()()()),e&2&&(y("@fadeIn",!0),h(),y("@zoomIn",!0),h(3),y("svgIcon","heroicons_outline:finger-print"),h(6),y("color","primary"))},dependencies:[C,A,E,P,M],encapsulation:2,data:{animation:[T,I]}})}}return a})();var q=(()=>{class a{constructor(){this.STORAGE_KEY="zelf_passkeys"}isSupported(){return c(this,null,function*(){return!!window.PublicKeyCredential})}register(r){return c(this,null,function*(){try{let e=crypto.getRandomValues(new Uint8Array(32)),t=crypto.getRandomValues(new Uint8Array(16)),n=crypto.getRandomValues(new Uint8Array(32)),i={publicKey:{challenge:e,rp:{name:"Zelf Dashboard",id:window.location.hostname},user:{id:t,name:r,displayName:r},pubKeyCredParams:[{alg:-7,type:"public-key"},{alg:-257,type:"public-key"}],timeout:6e4,authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required",residentKey:"required"},extensions:{prf:{eval:{first:n}}}}},o=yield navigator.credentials.create(i);if(!o)return null;let s=o.getClientExtensionResults(),p;if(s.prf&&s.prf.results&&s.prf.results.first)p=new Uint8Array(s.prf.results.first);else{console.warn("PRF extension not supported or enabled. falling back to HKDF using Credential ID.");let x=new TextEncoder().encode(o.id);p=new Uint8Array(32);for(let f=0;f<32;f++)p[f]=x[f%x.length]^n[f%n.length]}let g=yield this.importKey(p);return{credentialId:o.id,key:g,salt:n}}catch(e){return console.error("Error creating passkey:",e),null}})}authenticate(r,e){return c(this,null,function*(){try{let n={publicKey:{challenge:crypto.getRandomValues(new Uint8Array(32)),timeout:6e4,userVerification:"required",allowCredentials:[{id:this.base64UrlToBuffer(r),type:"public-key"}],extensions:{prf:{eval:{first:e}}}}},i=yield navigator.credentials.get(n);if(!i)return null;let o=i.getClientExtensionResults(),s;if(o.prf&&o.prf.results&&o.prf.results.first)s=new Uint8Array(o.prf.results.first);else{console.warn("PRF extension not supported in Auth. Using fallback derivation.");let g=new TextEncoder().encode(i.id);s=new Uint8Array(32);for(let l=0;l<32;l++)s[l]=g[l%g.length]^e[l%e.length]}return yield this.importKey(s)}catch(t){return console.error("Error authenticating passkey:",t),null}})}encryptPassword(r,e){return c(this,null,function*(){let t=crypto.getRandomValues(new Uint8Array(12)),n=new TextEncoder().encode(r),i=yield crypto.subtle.encrypt({name:"AES-GCM",iv:t},e,n);return{ciphertext:this.bufferToBase64(i),iv:this.bufferToBase64(t)}})}decryptPassword(r,e,t){return c(this,null,function*(){let n=this.base64ToBuffer(e),i=this.base64ToBuffer(r),o=yield crypto.subtle.decrypt({name:"AES-GCM",iv:n},t,i);return new TextDecoder().decode(o)})}savePasskeyMetadata(r,e){let t=this.getStore();t[r]=e,localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}getPasskeyMetadata(r){return this.getStore()[r]||null}getStore(){try{return JSON.parse(localStorage.getItem(this.STORAGE_KEY)||"{}")}catch{return{}}}importKey(r){return c(this,null,function*(){return yield crypto.subtle.importKey("raw",r,{name:"AES-GCM"},!1,["encrypt","decrypt"])})}bufferToBase64(r){let e=new Uint8Array(r),t="";for(let n=0;n<e.byteLength;n++)t+=String.fromCharCode(e[n]);return btoa(t)}base64ToBuffer(r){let e=atob(r),t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}base64UrlToBuffer(r){let e=r.replace(/-/g,"+").replace(/_/g,"/"),t=e.length%4,n=t?e+"=".repeat(4-t):e;return this.base64ToBuffer(n)}static{this.\u0275fac=function(e){return new(e||a)}}static{this.\u0275prov=v({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();export{j as a,q as b};
