import{a as Se,b as we,c as Me}from"./chunk-5A4CLC4T.js";import{a as Ce,b as be}from"./chunk-WMU4DVX2.js";import{a as Ae}from"./chunk-B7YMJF7I.js";import{a as Ee,c as ke}from"./chunk-EVPYPNUG.js";import{a as te,b as ie,c as ne}from"./chunk-7DWE4W2K.js";import"./chunk-MCJLLZNO.js";import"./chunk-GCWISREG.js";import{a as Ie}from"./chunk-NL2GQIJH.js";import"./chunk-LU5ZPOGU.js";import{b as Q,c as $,f as H,j as J,k as Z,m as _e,n as ve}from"./chunk-3GEO6YUQ.js";import{a as re}from"./chunk-QJBLCKSO.js";import"./chunk-JYHC2XGO.js";import{a as Ve}from"./chunk-U2XY4OSF.js";import{a as xe,b as ye}from"./chunk-BUIRSCSM.js";import{b as ae,d as _,f as le,g as se,l as me,o as ce,p as de,r as pe,s as ue,x as fe,y as ge,z as he}from"./chunk-VTBKW2GH.js";import{b as X,c as ee}from"./chunk-AWGMSRYJ.js";import{$ as G,fa as K,ha as W,ia as Y}from"./chunk-XLOSQDG4.js";import{c as oe}from"./chunk-HYCYVOWE.js";import"./chunk-2PUMVMOA.js";import"./chunk-VFSGURZL.js";import{b as j,d as O,e as U}from"./chunk-PANCWU5R.js";import"./chunk-BIZJNN6K.js";import"./chunk-4QULIMQU.js";import{Ab as h,Fc as m,Gc as c,Ib as p,Pb as f,Rb as k,Sb as V,Tb as r,Ub as o,Vb as g,Zb as A,dc as S,fc as x,ga as P,gb as n,hb as w,jc as F,kc as B,lc as T,pc as D,qc as l,ra as I,rc as u,sa as C,sc as b,ta as R,tc as N,ua as z,ub as q,zc as L}from"./chunk-J6ZWT2MN.js";import{a as M,b as E}from"./chunk-TSRGIXR5.js";var Te=["signInNgForm"],De=["biometricVerification"],Fe=(i,d)=>d.code,Ne=()=>["/sign-up"];function Pe(i,d){if(i&1){let e=A();r(0,"div",3)(1,"div",46)(2,"div",47)(3,"h2",48),l(4,"Biometric Verification"),o(),r(5,"button",49),S("click",function(){I(e);let t=x();return C(t.onBiometricCancel())}),r(6,"mat-icon"),l(7,"close"),o()()(),r(8,"div",50)(9,"p",51),l(10," Please verify your identity to complete your sign-in process "),r(11,"strong",52),l(12),o()(),r(13,"app-data-biometrics",53,2),S("biometricsSuccess",function(t){I(e);let s=x();return C(s.onBiometricSuccess(t))})("biometricsCancel",function(){I(e);let t=x();return C(t.onBiometricCancel())}),o()()()()}if(i&2){let e=x();n(12),b(" ",(e.userData==null?null:e.userData.email)||(e.userData==null?null:e.userData.phone)||"Account"," "),n(),p("userData",e.userData)("isModalContext",!1)}}function Re(i,d){if(i&1&&(r(0,"fuse-alert",12),l(1),o()),i&2){let e=x();p("appearance","outline")("showIcon",!1)("type",e.alert.type)("@shake",e.alert.type==="error"),n(),b(" ",e.alert.message," ")}}function ze(i,d){i&1&&(r(0,"mat-error"),l(1),m(2,"transloco"),o()),i&2&&(n(),u(c(2,1,"signIn.emailRequired")))}function qe(i,d){i&1&&(r(0,"mat-error"),l(1),m(2,"transloco"),o()),i&2&&(n(),u(c(2,1,"signIn.emailInvalid")))}function Le(i,d){if(i&1&&(r(0,"mat-form-field",18)(1,"mat-label"),l(2),m(3,"transloco"),o(),g(4,"input",54),h(5,ze,3,3,"mat-error")(6,qe,3,3,"mat-error"),o()),i&2){let e=x();n(2),u(c(3,4,"signIn.emailAddress")),n(2),p("formControlName","email"),n(),f(e.signInForm.get("email").hasError("required")?5:-1),n(),f(e.signInForm.get("email").hasError("email")?6:-1)}}function je(i,d){if(i&1&&(r(0,"mat-option",45),l(1),o()),i&2){let e=d.$implicit;p("value",e.code),n(),N("",e.flag," ",e.code,"")}}function Oe(i,d){i&1&&(r(0,"mat-error"),l(1),m(2,"transloco"),o()),i&2&&(n(),u(c(2,1,"signIn.countryRequired")))}function Ue(i,d){i&1&&(r(0,"mat-error"),l(1),m(2,"transloco"),o()),i&2&&(n(),u(c(2,1,"signIn.phoneRequired")))}function Ge(i,d){i&1&&(r(0,"mat-error"),l(1),m(2,"transloco"),o()),i&2&&(n(),u(c(2,1,"signIn.phonePattern")))}function Qe(i,d){if(i&1&&(r(0,"div",19)(1,"mat-form-field",55)(2,"mat-label"),l(3),m(4,"transloco"),o(),r(5,"mat-select",56),k(6,je,2,3,"mat-option",45,Fe),o(),h(8,Oe,3,3,"mat-error"),o(),r(9,"mat-form-field",57)(10,"mat-label"),l(11),m(12,"transloco"),o(),g(13,"input",58),h(14,Ue,3,3,"mat-error")(15,Ge,3,3,"mat-error"),o()()),i&2){let e=x();n(3),u(c(4,7,"signIn.country")),n(2),p("formControlName","countryCode"),n(),V(e.countryCodes),n(2),f(e.signInForm.get("countryCode").hasError("required")?8:-1),n(3),u(c(12,9,"signIn.phoneNumber")),n(2),p("formControlName","phone"),n(),f(e.signInForm.get("phone").hasError("required")?14:-1),n(),f(e.signInForm.get("phone").hasError("pattern")?15:-1)}}function $e(i,d){i&1&&g(0,"mat-icon",22),i&2&&p("svgIcon","heroicons_solid:eye")}function He(i,d){i&1&&g(0,"mat-icon",22),i&2&&p("svgIcon","heroicons_solid:eye-slash")}function Je(i,d){i&1&&(r(0,"mat-error"),l(1),m(2,"transloco"),o()),i&2&&(n(),u(c(2,1,"signIn.masterPasswordRequired")))}function Ze(i,d){i&1&&(r(0,"span"),l(1),m(2,"transloco"),o()),i&2&&(n(),u(c(2,1,"signIn.signInButton")))}function Ke(i,d){i&1&&g(0,"mat-progress-spinner",29),i&2&&p("diameter",24)("mode","indeterminate")}function We(i,d){if(i&1&&(r(0,"option",45),l(1),o()),i&2){let e=d.$implicit;p("value",e.code),n(),N("",e.flag," ",e.name,"")}}var Be=(()=>{class i{constructor(e,a,t,s){this._activatedRoute=e,this._authService=a,this._formBuilder=t,this._router=s,this.alert={type:"success",message:""},this.showAlert=!1,this.showBiometricVerification=!1,this.userData={},this.availableLanguages=[{code:"en",name:"English",flag:"\u{1F1FA}\u{1F1F8}"},{code:"es",name:"Espa\xF1ol",flag:"\u{1F1EA}\u{1F1F8}"},{code:"fr",name:"Fran\xE7ais",flag:"\u{1F1EB}\u{1F1F7}"},{code:"zh",name:"\u4E2D\u6587",flag:"\u{1F1E8}\u{1F1F3}"},{code:"ja",name:"\u65E5\u672C\u8A9E",flag:"\u{1F1EF}\u{1F1F5}"},{code:"ko",name:"\uD55C\uAD6D\uC5B4",flag:"\u{1F1F0}\u{1F1F7}"}],this.currentLanguage="en",this.countryCodes=Ae,this._translocoService=P(te)}ngOnInit(){this.signInForm=this._formBuilder.group({identificationMethod:["email",_.required],email:["",[_.required,_.email]],countryCode:["+1"],phone:[""],masterPassword:["",_.required],rememberMe:[""]}),this.signInForm.get("identificationMethod")?.valueChanges.subscribe(e=>{this.updateValidation(e)}),this.updateValidation("email"),this.loadRememberedData(),this.currentLanguage=this._translocoService.getActiveLang()||"en"}updateValidation(e){let a=this.signInForm.get("email"),t=this.signInForm.get("countryCode"),s=this.signInForm.get("phone");e==="email"?(a?.setValidators([_.required,_.email]),t?.clearValidators(),s?.clearValidators()):e==="phone"&&(a?.clearValidators(),t?.setValidators([_.required]),s?.setValidators([_.required,_.pattern(/^[0-9]{8,12}$/)])),a?.updateValueAndValidity(),t?.updateValueAndValidity(),s?.updateValueAndValidity()}signIn(){if(this.signInForm.invalid)return;this.saveRememberedData();let e=this.signInForm.value,a=e.identificationMethod;a==="email"?this.userData={email:e.email,masterPassword:e.masterPassword,identificationMethod:"email"}:a==="phone"&&(this.userData={countryCode:e.countryCode,phone:e.phone,masterPassword:e.masterPassword,identificationMethod:"phone"}),this._authService.verifyClientExists(this.userData).subscribe(t=>{let s=t.data?.publicData;if(this.userData=E(M({},this.userData),{email:s?.accountEmail,phone:s?.accountPhone,countryCode:s?.accountCountryCode}),s?.accountEmail){this.showBiometricVerification=!0,this.showAlert=!1;return}this.showAlert=!0,this.alert={type:"error",message:this.getErrorMessage({message:"Client not found"})}},t=>{console.error("Verify client exists error:",t),this.showAlert=!0,this.alert={type:"error",message:this.getErrorMessage(t)}})}onBiometricSuccess(e){this.signInForm.disable();let a=E(M({},this.userData),{masterPassword:e.password,faceBase64:e.faceBase64});console.info({signInData:a,biometricData:e}),this._authService.signIn(a).then(t=>{t.data?.token&&t.data?.zelfProof&&t.data?.zelfAccount?(this._authService.setSession({zelfProof:t.data.zelfProof,zelfAccount:t.data.zelfAccount}),this._authService.setAccessToken(t.data.token),this._router.navigateByUrl("/analytics")):(console.error("Sign in response missing required authentication data:",t),this.alert={type:"error",message:this.getErrorMessage({message:"Incomplete authentication data received"})},this.showAlert=!0,this.signInForm.enable(),this.showBiometricVerification=!1)},t=>{if(console.error("Sign in error:",t),t?.message&&(t.message.includes("Multiple face were detected")||t.message.includes("No face detected")||t.message.includes("Face not recognized")||t.message.includes("biometric")||t.message.includes("face")||t.message.includes("LIVENESS")||t.message.includes("liveness"))){this.biometricVerification&&this.biometricVerification.handleApiError(t);return}this.signInForm.enable(),this.signInNgForm.resetForm(),this.showBiometricVerification=!1;let s=this.getErrorMessage(t);this.alert={type:"error",message:s},this.showAlert=!0})}onBiometricCancel(){this.showBiometricVerification=!1,this.userData={},this.clearRememberedData()}getErrorMessage(e){let a=e?.error?.code||e?.code||e?.error?.message||e?.message||"unknown_error",t=e?.error?.message||e?.message||"",s={client_not_found:"errors.client_not_found",client_invalid_api_key:"errors.client_invalid_api_key","403:client_not_found":"errors.client_not_found","403:client_invalid_api_key":"errors.client_invalid_api_key",Forbidden:"errors.unknown_error",Conflict:"errors.unknown_error",BadRequest:"errors.validation_error",UnprocessableEntity:"errors.validation_error",InternalServerError:"errors.unknown_error",Timeout:"errors.network_error",unknown_error:"errors.unknown_error",network_error:"errors.network_error",validation_error:"errors.validation_error"};if(t){if(t.includes("client_not_found"))return this._translocoService.translate("errors.client_not_found");if(t.includes("client_invalid_api_key"))return this._translocoService.translate("errors.client_invalid_api_key");if(t.includes("Incomplete authentication data received"))return this._translocoService.translate("errors.incomplete_auth_data")}let y=s[a]||"errors.unknown_error";return this._translocoService.translate(y)}loadRememberedData(){try{let e=localStorage.getItem("zelf_remembered_signin");if(e){let a=JSON.parse(e);a.identificationMethod&&(this.signInForm.patchValue({identificationMethod:a.identificationMethod}),this.updateValidation(a.identificationMethod)),a.email&&this.signInForm.patchValue({email:a.email}),a.countryCode&&this.signInForm.patchValue({countryCode:a.countryCode}),a.phone&&this.signInForm.patchValue({phone:a.phone}),a.rememberMe&&this.signInForm.patchValue({rememberMe:a.rememberMe})}}catch(e){console.error("Error loading remembered data:",e)}}saveRememberedData(){let e=this.signInForm.value;if(e.rememberMe)try{let t={identificationMethod:e.identificationMethod,rememberMe:!0};e.identificationMethod==="email"&&e.email?t.email=e.email:e.identificationMethod==="phone"&&(e.countryCode&&(t.countryCode=e.countryCode),e.phone&&(t.phone=e.phone)),localStorage.setItem("zelf_remembered_signin",JSON.stringify(t))}catch(t){console.error("Error saving remembered data:",t)}else localStorage.removeItem("zelf_remembered_signin")}clearRememberedData(){localStorage.removeItem("zelf_remembered_signin")}onLanguageChange(e){this.currentLanguage=e,this._translocoService.setActiveLang(e)}static{this.\u0275fac=function(a){return new(a||i)(w(j),w(oe),w(fe),w(O))}}static{this.\u0275cmp=q({type:i,selectors:[["auth-sign-in"]],viewQuery:function(a,t){if(a&1&&(F(Te,5),F(De,5)),a&2){let s;B(s=T())&&(t.signInNgForm=s.first),B(s=T())&&(t.biometricVerification=s.first)}},decls:80,vars:52,consts:[["signInNgForm","ngForm"],["masterPasswordField",""],["biometricVerification",""],[1,"fixed","inset-0","bg-black","bg-opacity-80","flex","items-center","justify-center","z-50"],[1,"flex","min-w-0","flex-auto","flex-col","items-center","sm:flex-row","sm:justify-center","md:items-start","md:justify-start"],[1,"w-full","px-4","py-8","sm:bg-card","sm:w-auto","sm:rounded-2xl","sm:p-12","sm:shadow","md:flex","md:h-full","md:w-1/2","md:items-center","md:justify-end","md:rounded-none","md:p-16","md:shadow-none"],[1,"mx-auto","w-full","max-w-80","sm:mx-0","sm:w-80"],[1,"w-12"],["src","images/logo/logo.svg"],[1,"mt-8","text-4xl","font-extrabold","leading-tight","tracking-tight"],[1,"mt-0.5","flex","items-baseline","font-medium"],[1,"ml-1","text-primary-500","hover:underline",3,"routerLink"],[1,"mt-8",3,"appearance","showIcon","type"],[1,"mt-8",3,"formGroup"],[1,"mb-4"],[1,"flex","gap-4",3,"formControlName"],["value","email"],["value","phone"],[1,"w-full"],[1,"flex","w-full","gap-2"],["id","masterPassword","matInput","","type","password",3,"formControlName"],["mat-icon-button","","type","button","matSuffix","",3,"click"],[1,"icon-size-5",3,"svgIcon"],[1,"mt-1.5","inline-flex","w-full","items-center","justify-start"],[1,"-ml-2",3,"color","formControlName"],[1,"mt-4","text-sm","text-gray-600","dark:text-gray-400"],["href","https://docs.zelf.world/zelf-legal/terms-of-use","target","_blank","rel","noopener noreferrer",1,"text-primary-500","hover:underline"],["href","https://docs.zelf.world/zelf-legal/privacy-policy","target","_blank","rel","noopener noreferrer",1,"text-primary-500","hover:underline"],["mat-flat-button","",1,"fuse-mat-button-large","mt-6","w-full",3,"click","color","disabled"],[3,"diameter","mode"],[1,"relative","hidden","h-full","w-1/2","flex-auto","items-center","justify-center","overflow-hidden","bg-gray-800","p-16","dark:border-l","md:flex","lg:px-28"],["viewBox","0 0 960 540","width","100%","height","100%","preserveAspectRatio","xMidYMax slice","xmlns","http://www.w3.org/2000/svg",1,"absolute","inset-0","pointer-events-none"],["fill","none","stroke","currentColor","stroke-width","100",1,"text-gray-700","opacity-25"],["r","234","cx","196","cy","23"],["r","234","cx","790","cy","491"],["viewBox","0 0 220 192","width","220","height","192","fill","none",1,"absolute","-top-16","-right-16","text-gray-700"],["id","837c3e70-6c3a-44e6-8854-cc48c737b659","x","0","y","0","width","20","height","20","patternUnits","userSpaceOnUse"],["x","0","y","0","width","4","height","4","fill","currentColor"],["width","220","height","192","fill","url(#837c3e70-6c3a-44e6-8854-cc48c737b659)"],[1,"relative","z-10","w-full","max-w-2xl"],[1,"text-7xl","font-bold","leading-none","text-gray-100"],[1,"text-primary-400"],[1,"mt-6","text-lg","leading-6","tracking-tight","text-gray-400"],[1,"relative","pt-4"],[1,"px-3","py-2","text-sm","font-medium","text-gray-700","bg-white","border","border-gray-300","rounded-md","hover:bg-gray-50","focus:outline-none","focus:ring-2","focus:ring-primary-500","focus:border-transparent","dark:bg-gray-800","dark:text-gray-300","dark:border-gray-600","dark:hover:bg-gray-700",3,"change","value"],[3,"value"],[1,"bg-white","dark:bg-gray-800","rounded-lg","w-full","max-w-4xl","max-h-[90vh]","overflow-hidden","shadow-2xl"],[1,"flex","items-center","justify-between","p-6","border-b","border-gray-200","dark:border-gray-700"],[1,"text-xl","font-semibold","text-gray-900","dark:text-white"],["mat-icon-button","",1,"text-gray-600","dark:text-gray-300","hover:text-gray-800","dark:hover:text-gray-100",3,"click"],[1,"p-6"],[1,"text-sm","text-gray-600","dark:text-gray-300","mb-6","text-center"],[1,"text-gray-900","dark:text-white","block","mt-1"],[3,"biometricsSuccess","biometricsCancel","userData","isModalContext"],["id","email","matInput","",3,"formControlName"],[1,"w-32"],[3,"formControlName"],[1,"flex-1"],["id","phone","matInput","","type","tel","placeholder","1234567890",3,"formControlName"]],template:function(a,t){if(a&1){let s=A();h(0,Pe,15,3,"div",3),r(1,"div",4)(2,"div",5)(3,"div",6)(4,"div",7),g(5,"img",8),o(),r(6,"div",9),l(7),m(8,"transloco"),o(),r(9,"div",10)(10,"div"),l(11),m(12,"transloco"),o(),r(13,"a",11),l(14),m(15,"transloco"),o()(),h(16,Re,2,5,"fuse-alert",12),r(17,"form",13,0)(19,"div",14)(20,"mat-radio-group",15)(21,"mat-radio-button",16),l(22),m(23,"transloco"),o(),r(24,"mat-radio-button",17),l(25),m(26,"transloco"),o()()(),h(27,Le,7,6,"mat-form-field",18)(28,Qe,16,11,"div",19),r(29,"mat-form-field",18)(30,"mat-label"),l(31),m(32,"transloco"),o(),g(33,"input",20,1),r(35,"button",21),S("click",function(){I(s);let v=D(34);return C(v.type==="password"?v.type="text":v.type="password")}),h(36,$e,1,1,"mat-icon",22)(37,He,1,1,"mat-icon",22),o(),h(38,Je,3,3,"mat-error"),o(),r(39,"div",23)(40,"mat-checkbox",24),l(41),m(42,"transloco"),o()(),r(43,"div",25),l(44),m(45,"transloco"),r(46,"a",26),l(47),m(48,"transloco"),o(),l(49),m(50,"transloco"),r(51,"a",27),l(52),m(53,"transloco"),o(),l(54,". "),o(),r(55,"button",28),S("click",function(){return I(s),C(t.signIn())}),h(56,Ze,3,3,"span")(57,Ke,1,2,"mat-progress-spinner",29),o()()()(),r(58,"div",30),R(),r(59,"svg",31)(60,"g",32),g(61,"circle",33)(62,"circle",34),o()(),r(63,"svg",35)(64,"defs")(65,"pattern",36),g(66,"rect",37),o()(),g(67,"rect",38),o(),z(),r(68,"div",39)(69,"div",40)(70,"div"),l(71,"Welcome to"),o(),r(72,"div",41),l(73,"Zelf"),o()(),r(74,"div",42),l(75," Access your secure dashboard to monitor encryption/decryption operations, manage your Zelf license, and track your biometric authentication usage across all your applications. "),o(),r(76,"div",43)(77,"select",44),S("change",function(v){return I(s),C(t.onLanguageChange(v.target.value))}),k(78,We,2,3,"option",45,Fe),o()()()()()}if(a&2){let s,y,v=D(34);f(t.showBiometricVerification?0:-1),n(7),u(c(8,29,"signIn.title")),n(4),u(c(12,31,"signIn.dontHaveAccount")),n(2),p("routerLink",L(51,Ne)),n(),b("",c(15,33,"signIn.signUp")," "),n(2),f(t.showAlert?16:-1),n(),p("formGroup",t.signInForm),n(3),p("formControlName","identificationMethod"),n(2),u(c(23,35,"signIn.email")),n(3),u(c(26,37,"signIn.phone")),n(2),f(((s=t.signInForm.get("identificationMethod"))==null?null:s.value)==="email"?27:-1),n(),f(((y=t.signInForm.get("identificationMethod"))==null?null:y.value)==="phone"?28:-1),n(3),u(c(32,39,"signIn.masterPassword")),n(2),p("formControlName","masterPassword"),n(3),f(v.type==="password"?36:-1),n(),f(v.type==="text"?37:-1),n(),f(t.signInForm.get("masterPassword").hasError("required")?38:-1),n(2),p("color","primary")("formControlName","rememberMe"),n(),b(" ",c(42,41,"signIn.rememberMe")," "),n(3),b(" ",c(45,43,"signIn.termsAgreement")," "),n(3),u(c(48,45,"signIn.termsOfUse")),n(2),b(" ",c(50,47,"signIn.and")," "),n(3),u(c(53,49,"signIn.privacyPolicy")),n(3),p("color","primary")("disabled",t.signInForm.disabled),n(),f(t.signInForm.disabled?-1:56),n(),f(t.signInForm.disabled?57:-1),n(20),p("value",t.currentLanguage),n(),V(t.availableLanguages)}},dependencies:[U,Ie,ge,me,pe,ue,ae,le,se,he,ce,de,Z,J,Q,$,H,ve,_e,Y,K,W,ee,X,be,Ce,ye,xe,Me,Se,we,ke,Ee,G,Ve,ne,ie],encapsulation:2,data:{animation:re}})}}return i})();var Dt=[{path:"",component:Be}];export{Dt as default};
